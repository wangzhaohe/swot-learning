<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.23">
<title>@path spring-boot-ketang/general-manager</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ul.square{list-style-type:square}
ul.circle ul:not([class]),ul.disc ul:not([class]),ul.square ul:not([class]){list-style:inherit}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child{border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:30em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:first-child,.sidebarblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child,.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
/* table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7} */
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#9e9e9e}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active,#footnotes .footnote a:first-of-type:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,td.hdlist1,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}

/* 自定义输出 HTML 样式 */
/* 固定按钮在左上角 */
#toggleButton {
    position: fixed;
    top: 10px;
    left: 10px;
    z-index: 1000;
    /*background-color: lightgrey;*/
    color: #AB2C21;
    border: none;
    /*padding: 6px 10px;*/
    cursor: pointer;
}
/*#toc.toc2{width:40em}*/
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:85em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}

body.toc2.toc-right {
    padding-left: 0;
    padding-right: 0em;
}
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.pygments .hll { background-color: #ffffcc }
pre.pygments { background: #f8f8f8; }
pre.pygments .tok-c { color: #3D7B7B; font-style: italic } /* Comment */
pre.pygments .tok-err { border: 1px solid #FF0000 } /* Error */
pre.pygments .tok-k { color: #008000; font-weight: bold } /* Keyword */
pre.pygments .tok-o { color: #666666 } /* Operator */
pre.pygments .tok-ch { color: #3D7B7B; font-style: italic } /* Comment.Hashbang */
pre.pygments .tok-cm { color: #3D7B7B; font-style: italic } /* Comment.Multiline */
pre.pygments .tok-cp { color: #9C6500 } /* Comment.Preproc */
pre.pygments .tok-cpf { color: #3D7B7B; font-style: italic } /* Comment.PreprocFile */
pre.pygments .tok-c1 { color: #3D7B7B; font-style: italic } /* Comment.Single */
pre.pygments .tok-cs { color: #3D7B7B; font-style: italic } /* Comment.Special */
pre.pygments .tok-gd { color: #A00000 } /* Generic.Deleted */
pre.pygments .tok-ge { font-style: italic } /* Generic.Emph */
pre.pygments .tok-ges { font-weight: bold; font-style: italic } /* Generic.EmphStrong */
pre.pygments .tok-gr { color: #E40000 } /* Generic.Error */
pre.pygments .tok-gh { color: #000080; font-weight: bold } /* Generic.Heading */
pre.pygments .tok-gi { color: #008400 } /* Generic.Inserted */
pre.pygments .tok-go { color: #717171 } /* Generic.Output */
pre.pygments .tok-gp { color: #000080; font-weight: bold } /* Generic.Prompt */
pre.pygments .tok-gs { font-weight: bold } /* Generic.Strong */
pre.pygments .tok-gu { color: #800080; font-weight: bold } /* Generic.Subheading */
pre.pygments .tok-gt { color: #0044DD } /* Generic.Traceback */
pre.pygments .tok-kc { color: #008000; font-weight: bold } /* Keyword.Constant */
pre.pygments .tok-kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
pre.pygments .tok-kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
pre.pygments .tok-kp { color: #008000 } /* Keyword.Pseudo */
pre.pygments .tok-kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
pre.pygments .tok-kt { color: #B00040 } /* Keyword.Type */
pre.pygments .tok-m { color: #666666 } /* Literal.Number */
pre.pygments .tok-s { color: #BA2121 } /* Literal.String */
pre.pygments .tok-na { color: #687822 } /* Name.Attribute */
pre.pygments .tok-nb { color: #008000 } /* Name.Builtin */
pre.pygments .tok-nc { color: #0000FF; font-weight: bold } /* Name.Class */
pre.pygments .tok-no { color: #880000 } /* Name.Constant */
pre.pygments .tok-nd { color: #AA22FF } /* Name.Decorator */
pre.pygments .tok-ni { color: #717171; font-weight: bold } /* Name.Entity */
pre.pygments .tok-ne { color: #CB3F38; font-weight: bold } /* Name.Exception */
pre.pygments .tok-nf { color: #0000FF } /* Name.Function */
pre.pygments .tok-nl { color: #767600 } /* Name.Label */
pre.pygments .tok-nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
pre.pygments .tok-nt { color: #008000; font-weight: bold } /* Name.Tag */
pre.pygments .tok-nv { color: #19177C } /* Name.Variable */
pre.pygments .tok-ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
pre.pygments .tok-w { color: #bbbbbb } /* Text.Whitespace */
pre.pygments .tok-mb { color: #666666 } /* Literal.Number.Bin */
pre.pygments .tok-mf { color: #666666 } /* Literal.Number.Float */
pre.pygments .tok-mh { color: #666666 } /* Literal.Number.Hex */
pre.pygments .tok-mi { color: #666666 } /* Literal.Number.Integer */
pre.pygments .tok-mo { color: #666666 } /* Literal.Number.Oct */
pre.pygments .tok-sa { color: #BA2121 } /* Literal.String.Affix */
pre.pygments .tok-sb { color: #BA2121 } /* Literal.String.Backtick */
pre.pygments .tok-sc { color: #BA2121 } /* Literal.String.Char */
pre.pygments .tok-dl { color: #BA2121 } /* Literal.String.Delimiter */
pre.pygments .tok-sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
pre.pygments .tok-s2 { color: #BA2121 } /* Literal.String.Double */
pre.pygments .tok-se { color: #AA5D1F; font-weight: bold } /* Literal.String.Escape */
pre.pygments .tok-sh { color: #BA2121 } /* Literal.String.Heredoc */
pre.pygments .tok-si { color: #A45A77; font-weight: bold } /* Literal.String.Interpol */
pre.pygments .tok-sx { color: #008000 } /* Literal.String.Other */
pre.pygments .tok-sr { color: #A45A77 } /* Literal.String.Regex */
pre.pygments .tok-s1 { color: #BA2121 } /* Literal.String.Single */
pre.pygments .tok-ss { color: #19177C } /* Literal.String.Symbol */
pre.pygments .tok-bp { color: #008000 } /* Name.Builtin.Pseudo */
pre.pygments .tok-fm { color: #0000FF } /* Name.Function.Magic */
pre.pygments .tok-vc { color: #19177C } /* Name.Variable.Class */
pre.pygments .tok-vg { color: #19177C } /* Name.Variable.Global */
pre.pygments .tok-vi { color: #19177C } /* Name.Variable.Instance */
pre.pygments .tok-vm { color: #19177C } /* Name.Variable.Magic */
pre.pygments .tok-il { color: #666666 } /* Literal.Number.Integer.Long */
</style>
</head>
<body class="article toc2 toc-right">
<div id="header">
<h1>@path spring-boot-ketang/general-manager</h1>
<div id="toc" class="toc2">
<div id="toctitle">目录</div>
<ul class="sectlevel1">
<li><a href="#_spring_boot_综合项目案例">Spring Boot 综合项目案例</a>
<ul class="sectlevel2">
<li><a href="#_1_创建模块_general_manager">1. 创建模块 general-manager</a></li>
<li><a href="#_2_导入自己创建的_spring_boot_模块">2. 导入自己创建的 Spring Boot 模块</a></li>
<li><a href="#_3_检查所有依赖版本">3. 检查所有依赖版本</a></li>
<li><a href="#_4_编写_application_properties">4. 编写 application.properties</a>
<ul class="sectlevel3">
<li><a href="#_file_srcmainresourcesapplication_properties">file &#8594; src/main/resources/application.properties</a></li>
</ul>
</li>
<li><a href="#_5_创建数据库_general_manager">5. 创建数据库 general_manager</a></li>
<li><a href="#_6_创建数据库表_dept_并插入数据">6. 创建数据库表 dept 并插入数据</a></li>
<li><a href="#_7_创建数据库表_emp_并插入数据">7. 创建数据库表 emp  并插入数据</a></li>
<li><a href="#_8_创建数据库表_dept_对应实体类">8. 创建数据库表 dept 对应实体类</a>
<ul class="sectlevel3">
<li><a href="#_file_srcmainjavacomtjisepojodept_java">file &#8594; src/main/java/com/tjise/pojo/Dept.java</a></li>
</ul>
</li>
<li><a href="#_9_创建数据库表_emp_对应的实体类">9. 创建数据库表 emp  对应的实体类</a>
<ul class="sectlevel3">
<li><a href="#_file_srcmainjavacomtjisepojoemp_java">file &#8594; src/main/java/com/tjise/pojo/Emp.java</a></li>
</ul>
</li>
<li><a href="#_10_创建统一响应结果_result_实体类">10. 创建统一响应结果 Result 实体类</a>
<ul class="sectlevel3">
<li><a href="#_file_srcmainjavacomtjisepojoresult_java">file &#8594; src/main/java/com/tjise/pojo/Result.java</a></li>
</ul>
</li>
<li><a href="#_11_准备对应的三层架构包_controller_service_mapper">11. 准备对应的三层架构包 Controller Service Mapper</a>
<ul class="sectlevel3">
<li><a href="#_部门三层架构">部门三层架构</a></li>
<li><a href="#_员工三层架构">员工三层架构</a></li>
</ul>
</li>
<li><a href="#_12_restful_风格介绍">12. Restful 风格介绍</a></li>
<li><a href="#_13_api_接口文档的书写">13. API 接口文档的书写</a></li>
<li><a href="#_14_启动前端准备联调">14. 启动前端准备联调</a></li>
<li><a href="#_15_部门管理_crud">15. 部门管理 CRUD</a>
<ul class="sectlevel3">
<li><a href="#_15_1_查询部门列表">15.1 查询部门列表</a></li>
<li><a href="#_15_2_跨域处理">15.2 跨域处理</a></li>
<li><a href="#_15_3_删除单个部门">15.3 删除单个部门</a></li>
<li><a href="#_15_4_新增部门">15.4 新增部门</a></li>
<li><a href="#_15_5_注解优化">15.5 注解优化</a></li>
<li><a href="#_15_6_删除部门逻辑增强">15.6 删除部门逻辑增强</a></li>
<li><a href="#_15_7_获取单个部门">15.7 获取单个部门</a></li>
<li><a href="#_15_8_修改部门">15.8 修改部门</a></li>
</ul>
</li>
<li><a href="#_16_员工管理_crud">16. 员工管理 CRUD</a>
<ul class="sectlevel3">
<li><a href="#_16_1_查询员工列表">16.1 查询员工列表</a></li>
<li><a href="#_16_2_删除员工单个和多个删除功能合一">16.2 删除员工(单个和多个删除功能合一)</a></li>
<li><a href="#_16_3_新增员工">16.3 新增员工</a></li>
<li><a href="#_16_4_文件上传员工头像">16.4 文件上传员工头像</a></li>
<li><a href="#_16_5_文件上传至阿里云_oss">16.5 文件上传至阿里云 OSS</a></li>
<li><a href="#_16_6_查询单个员工">16.6 查询单个员工</a></li>
<li><a href="#_16_7_修改单个员工">16.7 修改单个员工</a></li>
</ul>
</li>
<li><a href="#_17_登录校验">17. 登录校验</a>
<ul class="sectlevel3">
<li><a href="#_api_登录文档">api 登录文档</a></li>
<li><a href="#_httpie_测试">httpie 测试</a></li>
<li><a href="#_创建后端登录代码">创建后端登录代码</a></li>
<li><a href="#_jwt_简介">JWT 简介</a></li>
<li><a href="#_pom_xml_新增依赖_jwt">pom.xml 新增依赖 JWT</a></li>
<li><a href="#_测试_jwt_的创建与解析">测试 JWT 的创建与解析</a></li>
<li><a href="#_封装_jwt_类">封装 JWT 类</a></li>
<li><a href="#_登录接口调用_jwt_类生成_token_返回给前端">登录接口调用 JWT 类生成 token 返回给前端</a></li>
</ul>
</li>
<li><a href="#_18_统一拦截二选一">18. 统一拦截（二选一）</a>
<ul class="sectlevel3">
<li><a href="#_fastjson2_pom_xml_新增依赖">fastjson2 pom.xml 新增依赖</a></li>
<li><a href="#_过滤器_filter_介绍一下以后使用_interceptor">过滤器 Filter （介绍一下，以后使用 Interceptor）</a></li>
<li><a href="#_拦截器_interceptorspringboot_使用">拦截器 Interceptor（SpringBoot 使用）</a></li>
<li><a href="#_同时存在_filter_interceptor_的执行顺序">同时存在 Filter &amp; interceptor 的执行顺序</a></li>
</ul>
</li>
<li><a href="#_19_异常处理">19. 异常处理</a>
<ul class="sectlevel3">
<li><a href="#_方案一在_controller_方法中进行_trycatch_处理">方案一：在 Controller 方法中进行 try…catch 处理</a></li>
<li><a href="#_方案二全局异常处理器">方案二：全局异常处理器</a></li>
</ul>
</li>
<li><a href="#_20_事务管理">20. 事务管理</a>
<ul class="sectlevel3">
<li><a href="#_transactional">@Transactional</a></li>
<li><a href="#_transactionalrollbackfor">@Transactional(rollbackFor)</a></li>
<li><a href="#_transactionalpropagation">@Transactional(propagation)</a></li>
</ul>
</li>
<li><a href="#_21_面向切面_aop">21. 面向切面 AOP</a>
<ul class="sectlevel3">
<li><a href="#_引子_记录业务层方法的执行耗时并输出到控制台">引子 &#8594; 记录业务层方法的执行耗时，并输出到控制台</a></li>
<li><a href="#_面向切面_aop_基础">面向切面 AOP 基础</a></li>
<li><a href="#_面向切面_aop_进阶">面向切面 AOP 进阶</a></li>
<li><a href="#_面向切面_aop_案例">面向切面 AOP 案例</a></li>
</ul>
</li>
<li><a href="#_22_redis_数据库应用">22. Redis 数据库应用</a>
<ul class="sectlevel3">
<li><a href="#_了解知识点_jedis">了解知识点 jedis</a></li>
<li><a href="#_登录时将_token_放入_redis_数据库">登录时将 token 放入 Redis 数据库</a></li>
<li><a href="#_前端请求进行_token_对比">前端请求进行 token 对比</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="_spring_boot_综合项目案例">Spring Boot 综合项目案例</h2>
<div class="sectionbody">
<button id="toggleButton">目录</button>
<script>
    // 获取按钮和 div 元素
    const toggleButton = document.getElementById('toggleButton');
    const contentDiv = document.getElementById('toc');

    // 添加点击事件监听器
    toggleButton.addEventListener('click', () => {
        // 切换 div 的显示状态
        // if (contentDiv.style.display === 'none' || contentDiv.style.display === '') {
        if (contentDiv.style.display === 'none') {
            contentDiv.style.display = 'block';
        } else {
            contentDiv.style.display = 'none';
        }
    });
</script>
<div class="sect2">
<h3 id="_1_创建模块_general_manager">1. 创建模块 general-manager</h3>
<div class="paragraph">
<p>使用 <a href="https://start.spring.io/" class="bare">https://start.spring.io/</a> 创建 Spring Boot 工程 (后面会将该工程作为模块导入到整体项目 spring-boot-ketang 中)，如下所示。</p>
</div>
<div class="paragraph">
<p>注：给工程命名为 general-manager ，在创建工程时选择对应的起步依赖 web, mybatis, mysql, lombok。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/general_manager_spring_initializr.png" alt="general manager spring initializr">
</div>
</div>
<div class="paragraph">
<p><strong>下面引用之前学过的文档内容，请注意项目名称更改为 general-manager 即可</strong></p>
</div>
<details>
<summary class="title">Spring Boot 项目元数据字段解释</summary>
<div class="content">
<div class="paragraph">
<p>在 Spring Boot 项目创建过程中，这些概念确实容易混淆。让我来详细解释它们的区别和作用：</p>
</div>
<h4 id="_1_group_id" class="discrete">1. Group ID</h4>
<div class="ulist">
<ul>
<li>
<p><strong>作用</strong>：通常是组织或公司的唯一标识符</p>
</li>
<li>
<p><strong>命名规范</strong>：采用反向域名约定（如 <code>com.example</code>）</p>
</li>
<li>
<p><strong>示例</strong>：<code>com.company.project</code>、<code>org.springframework</code></p>
</li>
</ul>
</div>
<h4 id="_2_artifact_id" class="discrete">2. Artifact ID</h4>
<div class="ulist">
<ul>
<li>
<p><strong>作用</strong>：项目在组织内的唯一标识符</p>
</li>
<li>
<p><strong>命名规范</strong>：通常是项目名称，使用小写字母和连字符</p>
</li>
<li>
<p><strong>示例</strong>：<code>my-web-app</code>、<code>user-service</code>、<code>spring-boot-demo</code></p>
</li>
</ul>
</div>
<h4 id="_3_name" class="discrete">3. Name</h4>
<div class="ulist">
<ul>
<li>
<p><strong>作用</strong>：项目的可读名称，用于显示目的</p>
</li>
<li>
<p><strong>特点</strong>：可以包含空格和特殊字符</p>
</li>
<li>
<p><strong>示例</strong>：<code>My Web Application</code>、<code>用户服务</code>、<code>Spring Boot Demo Project</code></p>
</li>
</ul>
</div>
<h4 id="_4_package_name" class="discrete">4. Package Name</h4>
<div class="ulist">
<ul>
<li>
<p><strong>作用</strong>：Java项目的根包名</p>
</li>
<li>
<p><strong>命名规范</strong>：通常基于Group ID，遵循Java包命名约定</p>
</li>
<li>
<p><strong>示例</strong>：<code>com.example.myproject</code>、<code>com.company.app</code></p>
</li>
</ul>
</div>
<h4 id="_实际应用示例" class="discrete">实际应用示例</h4>
<div class="paragraph">
<p>假设你要创建一个电商项目的用户服务模块：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>Group:     com.ecommerce.platform
Artifact:  user-service
Name:      User Management Service
Package:   com.ecommerce.platform.userservice</code></pre>
</div>
</div>
<h4 id="_关系总结" class="discrete">关系总结</h4>
<div class="ulist">
<ul>
<li>
<p><strong>Group ID + Artifact ID</strong> 组合必须唯一，类似Maven坐标</p>
</li>
<li>
<p><strong>Package Name</strong> 通常基于 Group ID，但需要符合 Java 包命名规则</p>
</li>
<li>
<p><strong>Name</strong> 是面向用户的友好显示名称</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>这些信息在项目生成后会体现在 <a href="file:///Users/swot/swot-learn/java/springboot/spring-boot-ketang/general-manager/pom.xml">pom.xml</a>（Maven）配置文件中。</p>
</div>
</div>
</details>
</div>
<div class="sect2">
<h3 id="_2_导入自己创建的_spring_boot_模块">2. 导入自己创建的 Spring Boot 模块</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>解压下载的 Spring Boot 代码，如 general-manager.zip，可以发现就是一个 Maven 模块的目录结构。</p>
</li>
<li>
<p>使用 IDEA 导入 general-manager 模块</p>
<div class="ulist">
<ul>
<li>
<p>进入 File &#8594; Project Structure 对话框，选择 Modules</p>
</li>
<li>
<p>点击 <code>+</code> 号，选择要导入的模块目录，如 general-manager</p>
<div class="imageblock">
<div class="content">
<img src="img/import_module_0.png" alt="import module 0" width="400">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>在导入时有两个选项：</p>
<div class="ulist">
<ul>
<li>
<p>Create module from existing sources（从现有源创建模块）用于导入没有使用构建工具如 maven 的项目</p>
</li>
<li>
<p>Import module from external model（从外部模型导入模块）用于导入使用构建工具如 maven 创建的项目。因为我们是用 maven 来管理代码的，所以选择 <code>Import module from external model</code></p>
<div class="imageblock thumb">
<div class="content">
<img src="img/import_module_1.png" alt="import module 1" width="640">
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>然后会看见 IDEA 自动安装了依赖。</p>
</li>
<li>
<p>更改 general-manager 中的 pom.xml 文件中的 Spring Boot 和 JDK 版本号。</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nt">&lt;parent&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-parent<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="hll"><span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>2.7.18<span class="tok-nt">&lt;/version&gt;</span>
</span><span class="tok-w">    </span><span class="tok-nt">&lt;relativePath/&gt;</span><span class="tok-w"> </span><span class="tok-cm">&lt;!-- lookup parent from repository --&gt;</span>
<span class="tok-nt">&lt;/parent&gt;</span>
<span class="tok-nt">&lt;properties&gt;</span>
<span class="hll"><span class="tok-w">    </span><span class="tok-nt">&lt;java.version&gt;</span>1.8<span class="tok-nt">&lt;/java.version&gt;</span>
</span><span class="tok-nt">&lt;/properties&gt;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="_3_检查所有依赖版本">3. 检查所有依赖版本</h3>
<div class="listingblock">
<div class="title">将 mbatis 依赖的版本调整为支持 JDK1.8，然后刷新 Maven。</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="hll"><span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>2.3.0<span class="tok-nt">&lt;/version&gt;</span>
</span><span class="tok-nt">&lt;/dependency&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.mybatis.spring.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>mybatis-spring-boot-starter-test<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="hll"><span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>2.3.0<span class="tok-nt">&lt;/version&gt;</span>
</span><span class="tok-w">    </span><span class="tok-nt">&lt;scope&gt;</span>test<span class="tok-nt">&lt;/scope&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_4_编写_application_properties">4. 编写 application.properties</h3>
<div class="sect3">
<h4 id="_file_srcmainresourcesapplication_properties">file &#8594; src/main/resources/application.properties</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1"># 配置文件行最后不能有空格</span>
<span class="tok-na">spring.application.name</span><span class="tok-o">=</span><span class="tok-s">general-manager</span>

<span class="tok-c1"># --- 数据库 ---</span>
<span class="tok-c1"># 驱动类名称</span>
<span class="tok-na">spring.datasource.driver-class-name</span><span class="tok-o">=</span><span class="tok-s">com.mysql.cj.jdbc.Driver</span>
<span class="tok-c1"># 数据库连接的 url</span>
<span class="tok-na">spring.datasource.url</span><span class="tok-o">=</span><span class="tok-s">jdbc:mysql://localhost:3307/general_manager</span>
<span class="tok-c1"># 连接数据库的用户名</span>
<span class="tok-na">spring.datasource.username</span><span class="tok-o">=</span><span class="tok-s">root</span>
<span class="tok-c1"># 连接数据库的密码</span>
<span class="tok-na">spring.datasource.password</span><span class="tok-o">=</span><span class="tok-s">root</span>

<span class="tok-c1"># --- mybatis ---</span>
<span class="tok-c1"># 指定mybatis输出日志的位置, 输出控制台</span>
<span class="tok-na">mybatis.configuration.log-impl</span><span class="tok-o">=</span><span class="tok-s">org.apache.ibatis.logging.stdout.StdOutImpl</span>
<span class="tok-c1">#开启驼峰命名自动映射，即从经典数据库列名 a_column 映射到经典 Java 属性 名 aColumn。</span>
<span class="tok-na">mybatis.configuration.map-underscore-to-camel-case</span><span class="tok-o">=</span><span class="tok-s">true</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_5_创建数据库_general_manager">5. 创建数据库 general_manager</h3>
<div class="paragraph">
<p>创建一个名为 <code>general_manager</code> 的 MySQL 数据库，并设置字符集为 <code>utf8</code> 和排序规则为 <code>utf8_general_ci</code>，可以使用以下 SQL 语句：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">CREATE</span><span class="tok-w"> </span><span class="tok-k">DATABASE</span><span class="tok-w"> </span><span class="tok-n">general_manager</span>
<span class="tok-nb">CHARACTER</span><span class="tok-w"> </span><span class="tok-k">SET</span><span class="tok-w"> </span><span class="tok-n">utf8</span>
<span class="tok-k">COLLATE</span><span class="tok-w"> </span><span class="tok-n">utf8_general_ci</span><span class="tok-p">;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这条语句会创建一个新的数据库，确保它支持 UTF-8 字符集并使用 <code>utf8_general_ci</code> 的排序规则。</p>
</div>
</div>
<div class="sect2">
<h3 id="_6_创建数据库表_dept_并插入数据">6. 创建数据库表 dept 并插入数据</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">-- 创建部门表</span>
<span class="tok-k">create</span><span class="tok-w"> </span><span class="tok-k">table</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">id</span><span class="tok-w">          </span><span class="tok-nb">int</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">primary</span><span class="tok-w"> </span><span class="tok-k">key</span><span class="tok-w"> </span><span class="tok-n">auto_increment</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;主键ID&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">name</span><span class="tok-w">        </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">unique</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;部门名称&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">create_time</span><span class="tok-w"> </span><span class="tok-n">datetime</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;创建时间&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">update_time</span><span class="tok-w"> </span><span class="tok-n">datetime</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;修改时间&#39;</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;部门表&#39;</span><span class="tok-p">;</span>

<span class="tok-c1">-- 插入记录</span>
<span class="tok-k">insert</span><span class="tok-w"> </span><span class="tok-k">into</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">create_time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">update_time</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-k">values</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;学工部&#39;</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">                  </span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;教研部&#39;</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">                  </span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-s1">&#39;咨询部&#39;</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">                  </span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-s1">&#39;就业部&#39;</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">                  </span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-s1">&#39;人事部&#39;</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">());</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_7_创建数据库表_emp_并插入数据">7. 创建数据库表 emp  并插入数据</h3>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">-- 创建员工表(带约束)</span>
<span class="tok-k">create</span><span class="tok-w"> </span><span class="tok-k">table</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-w"> </span><span class="tok-p">(</span>
<span class="tok-w">  </span><span class="tok-n">id</span><span class="tok-w">          </span><span class="tok-nb">int</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">primary</span><span class="tok-w"> </span><span class="tok-k">key</span><span class="tok-w"> </span><span class="tok-n">auto_increment</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;ID&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">username</span><span class="tok-w">    </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">20</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">unique</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;用户名&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">password</span><span class="tok-w">    </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">32</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">default</span><span class="tok-w"> </span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;密码&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">name</span><span class="tok-w">        </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;姓名&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">gender</span><span class="tok-w">      </span><span class="tok-n">tinyint</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;性别, 说明: 1 男, 2 女&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">image</span><span class="tok-w">       </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">300</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;图像&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">job</span><span class="tok-w">         </span><span class="tok-n">tinyint</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">entrydate</span><span class="tok-w">   </span><span class="tok-nb">date</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;入职时间&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">dept_id</span><span class="tok-w">     </span><span class="tok-nb">int</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;部门ID&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">create_time</span><span class="tok-w"> </span><span class="tok-n">datetime</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;创建时间&#39;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-n">update_time</span><span class="tok-w"> </span><span class="tok-n">datetime</span><span class="tok-w"> </span><span class="tok-k">not</span><span class="tok-w"> </span><span class="tok-k">null</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;修改时间&#39;</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;员工表&#39;</span><span class="tok-p">;</span>

<span class="tok-c1">-- 插入记录</span>
<span class="tok-k">INSERT</span><span class="tok-w"> </span><span class="tok-k">INTO</span><span class="tok-w"> </span><span class="tok-n">emp</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">username</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">image</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">job</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">entrydate</span><span class="tok-p">,</span><span class="tok-n">dept_id</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">create_time</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">update_time</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">VALUES</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;jinyong&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;金庸&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;1.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-s1">&#39;2000-01-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;zhangwuji&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;张无忌&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;2.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2015-01-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-s1">&#39;yangxiao&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;杨逍&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;3.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2008-05-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">4</span><span class="tok-p">,</span><span class="tok-s1">&#39;weiyixiao&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;韦一笑&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;4.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2007-01-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-s1">&#39;changyuchun&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;常遇春&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;5.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2012-12-05&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">6</span><span class="tok-p">,</span><span class="tok-s1">&#39;xiaozhao&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;小昭&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;6.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-s1">&#39;2013-09-05&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">7</span><span class="tok-p">,</span><span class="tok-s1">&#39;jixiaofu&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;纪晓芙&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;7.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;2005-08-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">8</span><span class="tok-p">,</span><span class="tok-s1">&#39;zhouzhiruo&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;周芷若&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;8.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;2014-11-09&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">9</span><span class="tok-p">,</span><span class="tok-s1">&#39;dingminjun&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;丁敏君&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;9.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;2011-03-11&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">10</span><span class="tok-p">,</span><span class="tok-s1">&#39;zhaomin&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;赵敏&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;10.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;2013-09-05&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">11</span><span class="tok-p">,</span><span class="tok-s1">&#39;luzhangke&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;鹿杖客&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;11.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-s1">&#39;2007-02-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">12</span><span class="tok-p">,</span><span class="tok-s1">&#39;hebiweng&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;鹤笔翁&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;12.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-s1">&#39;2008-08-18&#39;</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">13</span><span class="tok-p">,</span><span class="tok-s1">&#39;fangdongbai&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;方东白&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;13.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">5</span><span class="tok-p">,</span><span class="tok-s1">&#39;2012-11-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">3</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">14</span><span class="tok-p">,</span><span class="tok-s1">&#39;zhangsanfeng&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;张三丰&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;14.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2002-08-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">15</span><span class="tok-p">,</span><span class="tok-s1">&#39;yulianzhou&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;俞莲舟&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;15.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2011-05-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">16</span><span class="tok-p">,</span><span class="tok-s1">&#39;songyuanqiao&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;宋远桥&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;16.jpg&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-s1">&#39;2007-01-01&#39;</span><span class="tok-p">,</span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">()),</span>
<span class="tok-w">	</span><span class="tok-p">(</span><span class="tok-mi">17</span><span class="tok-p">,</span><span class="tok-s1">&#39;chenyouliang&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;123456&#39;</span><span class="tok-p">,</span><span class="tok-s1">&#39;陈友谅&#39;</span><span class="tok-p">,</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-s1">&#39;17.jpg&#39;</span><span class="tok-p">,</span><span class="tok-k">NULL</span><span class="tok-p">,</span><span class="tok-s1">&#39;2015-03-21&#39;</span><span class="tok-p">,</span><span class="tok-k">NULL</span><span class="tok-p">,</span><span class="tok-n">now</span><span class="tok-p">(),</span><span class="tok-n">now</span><span class="tok-p">());</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_8_创建数据库表_dept_对应实体类">8. 创建数据库表 dept 对应实体类</h3>
<div class="sect3">
<h4 id="_file_srcmainjavacomtjisepojodept_java">file &#8594; src/main/java/com/tjise/pojo/Dept.java</h4>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/pojo/Dept.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.AllArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.NoArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>

<span class="tok-nd">@Data</span>
<span class="tok-nd">@NoArgsConstructor</span>
<span class="tok-nd">@AllArgsConstructor</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">Dept</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">createTime</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">updateTime</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_9_创建数据库表_emp_对应的实体类">9. 创建数据库表 emp  对应的实体类</h3>
<div class="sect3">
<h4 id="_file_srcmainjavacomtjisepojoemp_java">file &#8594; src/main/java/com/tjise/pojo/Emp.java</h4>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/pojo/emp.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.AllArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.NoArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>

<span class="tok-nd">@Data</span>
<span class="tok-nd">@NoArgsConstructor</span>
<span class="tok-nd">@AllArgsConstructor</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">Emp</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">username</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">password</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">image</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">job</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">entrydate</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">createTime</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">updateTime</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_10_创建统一响应结果_result_实体类">10. 创建统一响应结果 Result 实体类</h3>
<div class="sect3">
<h4 id="_file_srcmainjavacomtjisepojoresult_java">file &#8594; src/main/java/com/tjise/pojo/Result.java</h4>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/pojo/Result.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.AllArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.NoArgsConstructor</span><span class="tok-p">;</span>

<span class="tok-nd">@Data</span>
<span class="tok-nd">@NoArgsConstructor</span>
<span class="tok-nd">@AllArgsConstructor</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">Result</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">code</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 响应码, 1 代码成功; 0 代表失败</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w">  </span><span class="tok-n">msg</span><span class="tok-p">;</span><span class="tok-w">   </span><span class="tok-c1">// 响应码描述字符串</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w">  </span><span class="tok-n">data</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 返回的数据</span>

<span class="tok-w">    </span><span class="tok-c1">// 增删改 成功响应 没有返回数据 null</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">success</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;success&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 查询 成功响应 有返回数据 data</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">success</span><span class="tok-p">(</span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;success&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">data</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 失败响应</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">error</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">msg</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">(</span><span class="tok-mi">0</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">msg</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_11_准备对应的三层架构包_controller_service_mapper">11. 准备对应的三层架构包 Controller Service Mapper</h3>
<div class="sect3">
<h4 id="_部门三层架构">部门三层架构</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.impl</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.DeptService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Service</span><span class="tok-p">;</span>


<span class="tok-nd">@Service</span><span class="tok-w">  </span><span class="tok-c1">// 把该类的对象交给 IOC 容器管理</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptServiceImpl</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_员工三层架构">员工三层架构</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerempcontroller_java">file &#8594; src/main/java/com/tjise/controller/EmpController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceempservice_java">file &#8594; src/main/java/com/tjise/service/EmpService.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Service</span><span class="tok-p">;</span>

<span class="tok-nd">@Service</span><span class="tok-w">  </span><span class="tok-c1">// 把该类的对象交给 IOC 容器管理</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpServiceImpl</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperempmapper_java">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_12_restful_风格介绍">12. Restful 风格介绍</h3>
<div class="paragraph">
<p>RESTful 风格的网站开发遵循 <strong>REST（Representational State Transfer）</strong> 架构风格，旨在构建可扩展的、基于网络的系统。REST 主要通过 HTTP 协议来传输资源，并使用其标准方法（如 GET、POST、PUT、DELETE 等）来执行操作。</p>
</div>
<div class="paragraph">
<p>RESTful API 使用标准的 HTTP 方法来操作资源，每个方法具有特定的语义：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>GET: 用于读取资源数据（不会更改资源状态）。</p>
<div class="ulist">
<ul>
<li>
<p>示例1：<code>GET /users</code> 获取所有用户</p>
</li>
<li>
<p>示例2: <code>GET /users/123</code> 获取 ID 为 123 的用户。</p>
</li>
</ul>
</div>
</li>
<li>
<p>POST: 创建新的资源。</p>
<div class="ulist">
<ul>
<li>
<p>示例：<code>POST /users</code> 创建一个新用户。</p>
</li>
</ul>
</div>
</li>
<li>
<p>PUT: 更新现有资源，通常是替换资源的全部内容。</p>
<div class="ulist">
<ul>
<li>
<p>示例：<code>PUT /users/123</code> 更新 ID 为 123 的用户数据。</p>
</li>
</ul>
</div>
</li>
<li>
<p>PATCH: 局部更新资源。</p>
<div class="ulist">
<ul>
<li>
<p>示例：<code>PATCH /users/123</code> 更新 ID 为 123 的用户的部分信息。</p>
</li>
</ul>
</div>
</li>
<li>
<p>DELETE: 删除资源。</p>
<div class="ulist">
<ul>
<li>
<p>示例：<code>DELETE /users/123</code> 删除 ID 为 123 的用户。</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>上述行为是风格，是约定方式，约定不是规范，可以打破，所以称为 RESTful 风格，而不是 RESTful 规范。</p>
</li>
<li>
<p>描述模块的功能通常使用复数，也就是加 s 的格式来描述，表示此类资源，而非单个资源。如：depts、emps、users、books 等等。</p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>“资源清晰、读为主、多端开放、无状态、可缓存、赶进度” 六个关键词只要命中四个，就别犹豫，直接上 REST；</p>
</li>
<li>
<p>其余情况不适合使用 REST，如 二进制 RPC、消息、流式或 GraphQL 等等。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_13_api_接口文档的书写">13. API 接口文档的书写</h3>
<div class="paragraph">
<p>API 接口文档主要由项目的主导者来书写，可以是后端开发人员，也可以是前端开发人员。</p>
</div>
</div>
<div class="sect2">
<h3 id="_14_启动前端准备联调">14. 启动前端准备联调</h3>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>进入前端项目路径: <code>cd vue-admin-template-master</code></p>
</li>
<li>
<p>确定本地 Node.js 版本: <code>node -v</code> &#8594; v16.20.2</p>
</li>
<li>
<p>安装项目依赖: <code>npm install</code></p>
</li>
<li>
<p>启动前端项目: <code>npm run dev</code></p>
</li>
<li>
<p>浏览器访问地址: <code><a href="http://localhost:9528/#/system/dept" class="bare">http://localhost:9528/#/system/dept</a></code> 可以看到部门列表页面</p>
</li>
</ol>
</div>
<div class="imageblock thumb">
<div class="content">
<img src="img/dept_list.png" alt="dept list">
</div>
</div>
</div>
<div class="sect2">
<h3 id="_15_部门管理_crud">15. 部门管理 CRUD</h3>
<div class="sect3">
<h4 id="_15_1_查询部门列表">15.1 查询部门列表</h4>
<div class="paragraph">
<p>查询部门的全部数据（由于部门数据比较少，不考虑分页）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/depts</p>
</li>
<li>
<p>请求方式：GET</p>
</li>
<li>
<p>接口描述：该接口用于部门列表数据查询</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数: 无</p>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object[ ]</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- createTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建时间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- updateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">修改时间</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">    </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;学工部&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span>
<span class="tok-w">    </span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;教研部&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span><span class="tok-p">,</span>
<span class="tok-w">      </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">]</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>开发流程</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/develope_flow.png" alt="develope flow">
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>测试接口: 使用 http <a href="http://localhost:8080/depts" class="bare">http://localhost:8080/depts</a></p>
</li>
<li>
<p>测试接口: 使用浏览器测试 <a href="http://localhost:9528/#/system/dept" class="bare">http://localhost:9528/#/system/dept</a></p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_2">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.DeptService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.CrossOrigin</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.GetMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-c1">// 如果是浏览器访问，会有跨域问题，参下面节点的解决方式</span>
<span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span><span class="tok-w">        </span><span class="tok-c1">// DI 注入 IOC 容器中的 DeptService Bean 对象，默认名称为 deptService</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">;</span>

<span class="tok-c1">//  @RequestMapping(&quot;/depts&quot;)                                        // 所有方法都可以请求</span>
<span class="tok-c1">//  @RequestMapping(value = &quot;/depts&quot;, method = {RequestMethod.GET})  // 完整写法</span>
<span class="tok-w">    </span><span class="tok-nd">@GetMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span><span class="tok-w">                                            </span><span class="tok-c1">// 更加简洁的方式</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">(){</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">deptList</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_2">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_2">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.impl</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper.DeptMapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.DeptService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Service</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Service</span><span class="tok-w">  </span><span class="tok-c1">// 把该类的对象交给 IOC 容器管理</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptServiceImpl</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// DI 注入 DeptMapper 实现类对象给变量 deptMapper</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">DeptMapper</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@Override</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_2">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>


<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_2_跨域处理">15.2 跨域处理</h4>
<div class="sect4">
<h5 id="_临时_后端在_controller_中解决跨域问题">临时-后端在 controller 中解决跨域问题</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_3">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.DeptService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.CrossOrigin</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.GetMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@CrossOrigin</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">originPatterns</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">allowedHeaders</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">methods</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-n">org</span><span class="tok-p">.</span><span class="tok-na">springframework</span><span class="tok-p">.</span><span class="tok-na">web</span><span class="tok-p">.</span><span class="tok-na">bind</span><span class="tok-p">.</span><span class="tok-na">annotation</span><span class="tok-p">.</span><span class="tok-na">RequestMethod</span><span class="tok-p">.</span><span class="tok-na">GET</span><span class="tok-p">,</span>
<span class="tok-w">               </span><span class="tok-n">org</span><span class="tok-p">.</span><span class="tok-na">springframework</span><span class="tok-p">.</span><span class="tok-na">web</span><span class="tok-p">.</span><span class="tok-na">bind</span><span class="tok-p">.</span><span class="tok-na">annotation</span><span class="tok-p">.</span><span class="tok-na">RequestMethod</span><span class="tok-p">.</span><span class="tok-na">POST</span><span class="tok-p">,</span>
<span class="tok-w">               </span><span class="tok-n">org</span><span class="tok-p">.</span><span class="tok-na">springframework</span><span class="tok-p">.</span><span class="tok-na">web</span><span class="tok-p">.</span><span class="tok-na">bind</span><span class="tok-p">.</span><span class="tok-na">annotation</span><span class="tok-p">.</span><span class="tok-na">RequestMethod</span><span class="tok-p">.</span><span class="tok-na">PUT</span><span class="tok-p">,</span>
<span class="tok-w">               </span><span class="tok-n">org</span><span class="tok-p">.</span><span class="tok-na">springframework</span><span class="tok-p">.</span><span class="tok-na">web</span><span class="tok-p">.</span><span class="tok-na">bind</span><span class="tok-p">.</span><span class="tok-na">annotation</span><span class="tok-p">.</span><span class="tok-na">RequestMethod</span><span class="tok-p">.</span><span class="tok-na">DELETE</span><span class="tok-p">,</span>
<span class="tok-w">               </span><span class="tok-n">org</span><span class="tok-p">.</span><span class="tok-na">springframework</span><span class="tok-p">.</span><span class="tok-na">web</span><span class="tok-p">.</span><span class="tok-na">bind</span><span class="tok-p">.</span><span class="tok-na">annotation</span><span class="tok-p">.</span><span class="tok-na">RequestMethod</span><span class="tok-p">.</span><span class="tok-na">OPTIONS</span><span class="tok-p">},</span>
<span class="tok-w">    </span><span class="tok-n">allowCredentials</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;true&quot;</span>
<span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span><span class="tok-w">        </span><span class="tok-c1">// DI 注入 IOC 容器中的 DeptService Bean 对象，默认名称为 deptService</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">;</span>

<span class="tok-c1">//  @RequestMapping(&quot;/depts&quot;)                                        // 所有方法都可以请求</span>
<span class="tok-c1">//  @RequestMapping(value = &quot;/depts&quot;, method = {RequestMethod.GET})  // 完整写法</span>
<span class="tok-w">    </span><span class="tok-nd">@GetMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span><span class="tok-w">                                            </span><span class="tok-c1">// 更加简洁的方式</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">(){</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">deptList</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_掌握_后端在全局解决跨域问题">掌握-后端在全局解决跨域问题</h5>
<div class="paragraph">
<p>创建了一个全局跨域配置类，这样就不需要在每个 Controller 上单独添加 @CrossOrigin 注解了。</p>
</div>
<div class="paragraph">
<p>让我详细解释一下 Spring Boot 是如何处理我们通过 @Bean 注册的 CorsFilter 的：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>注册过程：</p>
<div class="ulist">
<ul>
<li>
<p>当 Spring Boot 应用启动时，它会扫描所有带有 @Configuration 注解的类</p>
</li>
<li>
<p>在 CorsConfig 类中，@Bean 注解的方法 corsFilter() 会被 Spring 容器调用</p>
</li>
<li>
<p>Spring 会将返回的 CorsFilter 实例注册为一个 Bean，并自动将其添加到过滤器链中</p>
</li>
<li>
<p>这个过程不需要我们手动注册，Spring Boot 会自动处理</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求处理过程：</p>
<div class="ulist">
<ul>
<li>
<p>当前端发送请求时，请求会经过 Servlet 容器的过滤器链</p>
</li>
<li>
<p>CorsFilter 位于过滤器链的较早位置，会首先处理请求</p>
</li>
<li>
<p>对于简单请求（GET、POST等），CorsFilter 会直接处理并添加相应的 CORS 响应头</p>
</li>
<li>
<p>对于复杂请求（带有自定义头、PUT/DELETE 方法等），浏览器会先发送预检请求（OPTIONS）</p>
</li>
<li>
<p>CorsFilter 会处理这个预检请求，检查是否允许实际请求的跨域访问</p>
</li>
<li>
<p>如果预检通过，浏览器才会发送实际请求，CorsFilter 再次处理并添加 CORS 响应头</p>
</li>
<li>
<p>最后请求才会到达我们的 Controller 方法</p>
</li>
</ul>
</div>
</li>
<li>
<p>为什么这种方式有效：</p>
<div class="ulist">
<ul>
<li>
<p>CorsFilter 是 Spring 框架专门为处理跨域问题设计的过滤器</p>
</li>
<li>
<p>它会在响应中添加必要的 CORS 头，如 Access-Control-Allow-Origin、Access-Control-Allow-Methods 等</p>
</li>
<li>
<p>这些响应头告诉浏览器服务器允许哪些跨域请求，从而避免了跨域错误</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>这种方式比使用 @WebFilter 更简洁，因为 Spring Boot 会自动处理过滤器的注册和配置，而不需要我们手动管理。</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseconfigcorsconfig_java">file &#8594; src/main/java/com/tjise/config/CorsConfig.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.config</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.context.annotation.Bean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.context.annotation.Configuration</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.cors.CorsConfiguration</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.cors.UrlBasedCorsConfigurationSource</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.filter.CorsFilter</span><span class="tok-p">;</span>

<span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">CorsConfig</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Bean</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">CorsFilter</span><span class="tok-w"> </span><span class="tok-nf">corsFilter</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">CorsConfiguration</span><span class="tok-w"> </span><span class="tok-n">config</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">CorsConfiguration</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-c1">// 允许所有域名进行跨域调用</span>
<span class="tok-w">        </span><span class="tok-n">config</span><span class="tok-p">.</span><span class="tok-na">addAllowedOriginPattern</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-c1">// 允许所有请求头</span>
<span class="tok-w">        </span><span class="tok-n">config</span><span class="tok-p">.</span><span class="tok-na">addAllowedHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-c1">// 允许所有方法（POST、GET...）</span>
<span class="tok-w">        </span><span class="tok-n">config</span><span class="tok-p">.</span><span class="tok-na">addAllowedMethod</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-c1">// 允许携带 Cookie</span>
<span class="tok-w">        </span><span class="tok-n">config</span><span class="tok-p">.</span><span class="tok-na">setAllowCredentials</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-n">UrlBasedCorsConfigurationSource</span><span class="tok-w"> </span><span class="tok-n">source</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">UrlBasedCorsConfigurationSource</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-n">source</span><span class="tok-p">.</span><span class="tok-na">registerCorsConfiguration</span><span class="tok-p">(</span><span class="tok-s">&quot;/**&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">config</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">CorsFilter</span><span class="tok-p">(</span><span class="tok-n">source</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_了解_在开发时前端自己处理跨域问题">了解-在开发时前端自己处理跨域问题</h5>

</div>
<div class="sect4">
<h5 id="_了解_运维在部署时通过_nginx_反向代理解决跨域">了解-运维在部署时通过 Nginx 反向代理解决跨域</h5>

</div>
</div>
<div class="sect3">
<h4 id="_15_3_删除单个部门">15.3 删除单个部门</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/depts/{id}</p>
</li>
<li>
<p>请求方式：DELETE</p>
</li>
<li>
<p>接口描述：该接口用于根据 ID 删除部门数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：路径参数</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门ID</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>请求参数样例：<code>/depts/1</code> (删除 id=1 的记录)</p>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/dept_delete.png" alt="开发流程" width="960">
</div>
<div class="title">Figure 1. 开发流程</div>
</div>
<div class="ulist">
<ul>
<li>
<p>测试接口: http DELETE <a href="http://localhost:8080/depts/1" class="bare">http://localhost:8080/depts/1</a></p>
</li>
<li>
<p>测试使用浏览器删除一条记录。</p>
</li>
<li>
<p>查看数据库中是否删除了相应 id 的记录。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_4">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid">deleteDeptById</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts/{id}&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 路径参数</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-c1">// 调用 service 层去删除数据库记录</span>
<span class="tok-w">    </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_3">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增抽象方法：无返回值，只传入要删除记录的数据库 id 即可。</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_3">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_2">deleteDeptById</h6>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/service/impl/DeptServiceImpl.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 方法调用不用写类型 Integer</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_3">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Delete</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>


<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增删除部门</span>
<span class="tok-w">    </span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from dept where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_4_新增部门">15.4 新增部门</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/depts</p>
</li>
<li>
<p>请求方式：POST</p>
</li>
<li>
<p>接口描述：该接口用于添加部门数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门名称</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>请求参数样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span><span class="tok-w"> </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;教研部&quot;</span><span class="tok-w"> </span><span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>测试接口: 使用 http POST <a href="http://localhost:8080/depts" class="bare">http://localhost:8080/depts</a> name="教研部"</p>
</li>
<li>
<p>在浏览器中测试新增部门功能。</p>
</li>
<li>
<p>测试在前端新增部门，查看数据库是否有新增记录。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_5">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_insertdept">insertDept</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-c1">// 调用 service 层去删除数据库记录</span>
<span class="tok-w">    </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_4">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 抽象方法：无返回值，只传入要删除记录的数据库 id 即可。</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增抽象方法：新增部门</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_4">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_insertdept_2">insertDept</h6>
<div class="paragraph">
<p>数据库表 dept 字段 对应的 java 实体类中有 4 个属性</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">Dept</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">createTime</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">updateTime</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>id 是数据库自增长字段</p>
</li>
<li>
<p>name 是前端传送来的</p>
</li>
<li>
<p>createTime 需要后端指定</p>
</li>
<li>
<p>updateTime 需要后端指定</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 指定 createTime &amp; updateTime</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setCreateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-c1">// 方法调用不用写类型 Dept</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_4">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Delete</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Insert</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>


<span class="tok-w">    </span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from dept where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增部门</span>
<span class="tok-w">    </span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;INSERT INTO dept (name, create_time, update_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">            </span><span class="tok-s">&quot;VALUES (#{name}, #{createTime}, #{updateTime})&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_5_注解优化">15.5 注解优化</h4>
<div class="paragraph">
<p>前面 controller/DeptController.java 文件的方法注解中有重复的字符串 "/depts"，现抽取到类的注解中，以减少重复的字符串。</p>
</div>
<div class="listingblock">
<div class="title">三行代码中都有 /depts</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@GetMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{...}</span>

<span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{...}</span>

<span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{...}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">抽取到类的注解上精减代码</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span><span class="tok-w">       </span><span class="tok-c1">// 抽取到类的注解上</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@GetMapping</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{...}</span>

<span class="tok-w">    </span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{...}</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{...}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
一个完整的请求路径，应该是类上的 @RequestMapping 的 value 属性 + 方法上的 @RequestMapping 的 value 属性。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>注解优化后再次使用 httpie 或者浏览器进行测试，依然是正常的。</p>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_6">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.DeptService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/depts&quot;</span><span class="tok-p">)</span><span class="tok-w">                         </span><span class="tok-c1">// 抽取到类的注解上</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="hll"><span class="tok-w">    </span><span class="tok-c1">// DI 注入 IOC 容器中的 DeptService Bean 对象，默认名称为 deptService</span>
</span><span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@GetMapping</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="hll">
</span><span class="tok-w">        </span><span class="tok-c1">// 调用 service 层</span>
<span class="tok-w">        </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 把数据封装成统一的响应格式进行返回</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">deptList</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="hll">
</span><span class="tok-w">        </span><span class="tok-c1">// 调用 service 层</span>
<span class="tok-w">        </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">// 把数据封装成统一的响应格式进行返回</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="hll">
</span><span class="tok-w">        </span><span class="tok-c1">// 前端传入 JSON 数据 { &quot;name&quot;: &quot;人事部&quot; }，打印封装的数据只有 name，如下</span>
<span class="tok-w">        </span><span class="tok-c1">// Dept(id=null, name=人事部, createTime=null, updateTime=null)</span>
<span class="tok-w">        </span><span class="tok-c1">// System.out.println(dept);</span>

<span class="tok-w">        </span><span class="tok-c1">// 调用 service 层</span>
<span class="tok-w">        </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">// 把数据封装成统一的响应格式进行返回</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>http GET :8080/depts</p>
</li>
<li>
<p>http DELETE :8080/depts/1</p>
</li>
<li>
<p>HTTP POST :8080/depts name="开发部"</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_6_删除部门逻辑增强">15.6 删除部门逻辑增强</h4>
<div class="paragraph">
<p>总结下面所做的修改：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>修改了DeptMapper接口中的deleteDeptById方法，使其返回int类型表示影响的行数，而不是void。</p>
</li>
<li>
<p>修改了DeptService接口中的deleteDeptById方法签名，使其返回int类型。</p>
</li>
<li>
<p>修改了DeptServiceImpl实现类中的deleteDeptById方法，使其返回mapper方法的返回值。</p>
</li>
<li>
<p>修改了DeptController中的deleteDeptById方法，根据删除操作的结果返回统一的响应格式：</p>
<div class="ulist">
<ul>
<li>
<p>如果删除成功（影响行数&gt;0），返回成功的响应</p>
</li>
<li>
<p>如果删除失败（影响行数=0），返回错误信息"部门ID不存在"</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>这些修改确保了当尝试删除不存在的部门ID时，前端会收到统一格式的错误响应，而不是默认的成功响应。</p>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_5">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Delete</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Insert</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 更改返回值为整形 int</span>
<span class="tok-w">    </span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from dept where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增部门</span>
<span class="tok-w">    </span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;INSERT INTO dept (name, create_time, update_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">            </span><span class="tok-s">&quot;VALUES (#{name}, #{createTime}, #{updateTime})&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_5">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 抽象方法：返回删除的影响行数 int，用于判断是否删除成功</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_5">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_3">deleteDeptById</h6>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/service/impl/DeptServiceImpl.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 方法调用不用写类型 Integer</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_7">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_4">deleteDeptById</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 调用 service 层</span>
<span class="tok-w">    </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">rowsAffected</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 根据删除结果返回统一的响应格式</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">rowsAffected</span><span class="tok-w"> </span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 删除成功</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 删除失败，ID不存在</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;部门ID不存在&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_7_获取单个部门">15.7 获取单个部门</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/depts/{id}</p>
</li>
<li>
<p>请求方式：GET</p>
</li>
<li>
<p>接口描述：该接口用于根据ID查询部门数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：路径参数</p>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">参数说明：</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门ID</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请求参数样例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>/depts/1</code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">参数说明</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门名称</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- createTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建时间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- updateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">修改时间</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;学工部&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:29&quot;</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
<li>
<p>测试接口: http :8080/depts/1</p>
</li>
<li>
<p>测试在浏览器获取单个部门。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_8">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_getdeptbyid">getDeptById</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@GetMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">getDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_6">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 抽象方法：返回删除的影响行数 int，用于判断是否删除成功</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增获取单个部门</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_6">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_getdeptbyid_2">getDeptById</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">getDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_6">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Delete</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Insert</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 更改返回值为整形 int</span>
<span class="tok-w">    </span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from dept where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;INSERT INTO dept (name, create_time, update_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">            </span><span class="tok-s">&quot;VALUES (#{name}, #{createTime}, #{updateTime})&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增获取单个部门</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept where id = #{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_15_8_修改部门">15.8 修改部门</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/depts（不是 REST 风格了，因为实体对象 Dept 包含了 id）</p>
</li>
<li>
<p>请求方式：PUT</p>
</li>
<li>
<p>接口描述：该接口用于修改部门数据</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门ID （用于获取单个部门）</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门名称（要更改的部门名称）</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>请求参数样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;教研部&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kc">null</span></code></pre>
</div>
</div>
</li>
<li>
<p>测试接口: http PUT <a href="http://localhost:8080/depts" class="bare">http://localhost:8080/depts</a> id:=1 name="教研部"</p>
</li>
<li>
<p>测试在前端修改部门，查看数据库是否有更新记录。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_9">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_updatedept">updateDept</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@PutMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">updateDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// 这儿的逻辑有些粗糙，应该判断修改是否成功（此处省略）</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_7">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="paragraph">
<p>定义该接口目的是为了用类的多态实现 controller 层左边解耦。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 抽象方法：返回删除的影响行数 int，用于判断是否删除成功</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增更新单个部门</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_7">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deptserviceimpl_实现接口">DeptServiceImpl &#8594; 实现接口</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 补全属性</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">updateDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperdeptmapper_java_7">file &#8594; src/main/java/com/tjise/mapper/DeptMapper.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.*</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span><span class="tok-w">  </span><span class="tok-c1">// 1. 让 mybatis 识别 2. 将该接口的实现类对象放入 IOC 容器中</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 更改返回值为整形 int</span>
<span class="tok-w">    </span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from dept where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;INSERT INTO dept (name, create_time, update_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">            </span><span class="tok-s">&quot;VALUES (#{name}, #{createTime}, #{updateTime})&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from dept where id = #{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 新增更新单个部门</span>
<span class="tok-w">    </span><span class="tok-nd">@Update</span><span class="tok-p">(</span><span class="tok-s">&quot;update dept set name = #{name}, update_time=#{updateTime} where id=#{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_16_员工管理_crud">16. 员工管理 CRUD</h3>
<div class="sect3">
<h4 id="_16_1_查询员工列表">16.1 查询员工列表</h4>
<div class="paragraph">
<p>查询员工的全部数据（由于员工数据比较多，需要分页显示）</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/emps</p>
</li>
<li>
<p>请求方式：GET</p>
</li>
<li>
<p>接口描述：该接口用于员工列表数据的 <mark>条件分页查询</mark></p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：queryString</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">示例</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">张</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">性别 , 1 男 , 2 女</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">begin</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2010-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">范围匹配的开始时间(入职日期)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">end</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">否</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">2020-01-01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">范围匹配的结束时间(入职日期)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">page</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分页查询的页码，如果未指定，默认为1</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">pageSize</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">10</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">分页查询的每页记录数，如果未指定，默认为10</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>GET 请求数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span>http://localhost:8080/emps?name<span class="tok-o">=</span>张<span class="tok-p">&amp;</span><span class="tok-nv">gender</span><span class="tok-o">=</span><span class="tok-m">1</span><span class="tok-p">&amp;</span><span class="tok-nv">begin</span><span class="tok-o">=</span><span class="tok-m">2007</span>-09-01<span class="tok-p">&amp;</span><span class="tok-nv">end</span><span class="tok-o">=</span><span class="tok-m">2022</span>-09-01<span class="tok-p">&amp;</span><span class="tok-nv">page</span><span class="tok-o">=</span><span class="tok-m">1</span><span class="tok-p">&amp;</span><span class="tok-nv">pageSize</span><span class="tok-o">=</span><span class="tok-m">10</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">备注</th>
<th class="tableblock halign-left valign-top">其他信息</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码, 1 成功 , 0 失败</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- total</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">总记录数</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- rows</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object []</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数据列表</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">item 类型: object</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户名</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓名</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">密码</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- entrydate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入职日期</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- gender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">性别 , 1 男 ; 2 女</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">图像</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- deptId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门id</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- createTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建时间</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|-- updateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新时间</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;total&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;rows&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">[</span>
<span class="tok-w">       </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;jinyong&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;123456&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;金庸&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;gender&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;image&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;job&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;entrydate&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2015-01-01&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;deptId&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:30&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-02T00:29:04&quot;</span>
<span class="tok-w">      </span><span class="tok-p">},</span>
<span class="tok-w">      </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;zhangwuji&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;123456&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;张无忌&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;gender&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;image&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;job&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;entrydate&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2015-01-01&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;deptId&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:30&quot;</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-02T00:29:04&quot;</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">]</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_先实现分页查询">先实现分页查询</h5>
<div class="paragraph">
<p>分析实现分页查询的逻辑如下。</p>
</div>
<div class="paragraph">
<p>前端传递给后端的参数</p>
</div>
<div class="ulist">
<ul>
<li>
<p>当前页码: page</p>
</li>
<li>
<p>每页展示记录数: pageSize</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>后端给前端返回的数据</p>
</div>
<div class="ulist">
<ul>
<li>
<p>总记录数: total (前端用来计算总页数)</p>
</li>
<li>
<p>数据列表: rows</p>
<div class="ulist">
<ul>
<li>
<p><code>select * from emp limit 起始索引, 每页记录数</code></p>
</li>
<li>
<p>起始索引 = (页码 - 1) * 每页记录数</p>
</li>
</ul>
</div>
</li>
</ul>
</div>
<hr>
<div class="listingblock">
<div class="title">写个类 class PageBean 封装 total 和 rows</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Data</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">PageBean</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">total</span><span class="tok-p">;</span><span class="tok-w">      </span><span class="tok-c1">// 总记录数 select count(*) from emp;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">rows</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 当前页数据列表 select * from emp limit ?,?;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>返回 Result 对象给前端</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">pageBean</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
<div class="imageblock">
<div class="content">
<img src="img/emp_list_flow.png" alt="emp list flow" width="1000">
</div>
<div class="title">Figure 2. 开发流程</div>
</div>
<div class="ulist">
<ul>
<li>
<p>使用 httpie 测试 http ":8080/emps?page=2&amp;pageSize=5"</p>
</li>
<li>
<p>使用 httpie 测试 http ":8080/emps"</p>
</li>
<li>
<p>使用浏览器测试 <a href="http://localhost:9528/#/system/emp" class="bare">http://localhost:9528/#/system/emp</a></p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisepojopagebean_java">file &#8594; src/main/java/com/tjise/pojo/PageBean.java</h6>
<div class="paragraph">
<p>package com.tjise.pojo;</p>
</div>
<div class="paragraph">
<p>import lombok.Data;
import lombok.AllArgsConstructor;
import lombok.NoArgsConstructor;
import java.util.List;</p>
</div>
<div class="paragraph">
<p>@Data
@NoArgsConstructor
@AllArgsConstructor
public class PageBean {
    // 总记录数 select count(*) from emp;
    private long total;
    // 当前页数据列表 select * from emp limit ?,?;
    private List rows;
}</p>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisecontrollerempcontroller_java_2">file &#8594; src/main/java/com/tjise/controller/EmpController.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.EmpService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.GetMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestParam</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/emps&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_selectpage">selectPage</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@GetMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-n">defaultValue</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;1&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-n">defaultValue</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;10&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-n">pageBean</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">selectPage</span><span class="tok-p">(</span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">pageBean</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>分页查询，先不考虑条件查询。</p>
</li>
<li>
<p>@RequestParam(default) 设置 page 和 pageSize 默认值。</p>
</li>
<li>
<p>若不设默认值，且前端又没传递参数 page 和 pageSize，则在 service 层对 page 做运算时会报空值异常(NullPointerException)。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceempservice_java_2">file &#8594; src/main/java/com/tjise/service/EmpService.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_2">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper.EmpMapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Emp</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Service</span><span class="tok-w">  </span><span class="tok-c1">// 把该类的对象交给 IOC 容器管理</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpServiceImpl</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpMapper</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_selectpage_2">selectPage</h6>
<div class="paragraph">
<p>获取总记录数和当前页数据，封装成 PageBean 返回。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 获取总记录数</span>
<span class="tok-w">    </span><span class="tok-n">Long</span><span class="tok-w"> </span><span class="tok-n">total</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">selectCount</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 获取当前页数据</span>
<span class="tok-w">    </span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">offset</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">page</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">;</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">selectPage</span><span class="tok-p">(</span><span class="tok-n">offset</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 封装成 PageBean</span>
<span class="tok-w">    </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-n">pageBean</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-p">(</span><span class="tok-n">total</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">pageBean</span><span class="tok-p">;</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在 controller 层对 page 设置了默认值，所以即使前端没传递 page 和 pageSize，此处也不会报 NullPointerException。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisemapperempmapper_java_2">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Emp</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Select</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_selectcount_selectpage">selectCount &amp; selectpage</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 查询记录总数</span>
<span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select count(*) from emp&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Long</span><span class="tok-w"> </span><span class="tok-nf">selectCount</span><span class="tok-p">();</span>

<span class="tok-c1">// 查询分页数据</span>
<span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from emp LIMIT #{offset}, #{pageSize}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span><span class="tok-kt">int</span><span class="tok-w"> </span><span class="tok-n">offset</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_分页插件_pagehelper">分页插件 PageHelper</h5>
<div class="paragraph">
<p>当数据量大时, 所有的业务模块，只要涉及到分页 , 都需要指定上述的固定步骤，而且代码繁琐。</p>
</div>
<div class="paragraph">
<p>所以 MyBatis 提供了分页插件 PageHelper <a href="https://pagehelper.github.io/" class="bare">https://pagehelper.github.io/</a></p>
</div>
<div class="paragraph">
<p>PageHelper 分页插件支持任何复杂的单表、多表分页。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/pagehelper_flow.png" alt="pagehelper flow" width="1000">
</div>
<div class="title">Figure 3. 使用 PageHelper 开发流程</div>
</div>
<div class="sect5">
<h6 id="_file_pom_xml">file &#8594; pom.xml</h6>

</div>
<div class="sect5">
<h6 id="_pom_xml_增加依赖_pagehelper">pom.xml 增加依赖 pagehelper</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>com.github.pagehelper<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>pagehelper-spring-boot-starter<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>1.4.2<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisemapperempmapper_java_3">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h6>

</div>
<div class="sect5">
<h6 id="_list_要使用_pagehelper_select_所有记录即可">list &#8594; 要使用 PageHelper select 所有记录即可</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 使用 PageHelper 后查询语句更简单</span>
<span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from emp&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">list</span><span class="tok-p">();</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_3">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h6>

</div>
<div class="sect5">
<h6 id="_selectpage_3">selectPage</h6>
<div class="paragraph">
<p>获取总记录数和当前页数据，封装成 PageBean 返回。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-cm">/*</span>
<span class="tok-cm">    // 获取总记录数</span>
<span class="tok-cm">    Long total = empMapper.selectCount();</span>

<span class="tok-cm">    // 获取当前页数据</span>
<span class="tok-cm">    int offset = (page - 1) * pageSize;  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-cm">    List&lt;Emp&gt; empList = empMapper.selectPage(offset, pageSize);</span>

<span class="tok-cm">    // 封装成 PageBean</span>
<span class="tok-cm">    PageBean pageBean = new PageBean(total, empList);</span>
<span class="tok-cm">    return pageBean;</span>
<span class="tok-cm">    */</span>
<span class="tok-w">    </span><span class="tok-c1">// 下面节点内容放在此处</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在 controller 层对 page 设置了默认值，所以即使前端没传递 page 和 pageSize，此处也不会报 NullPointerException。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_使用_pagehelper_的逻辑">使用 PageHelper 的逻辑</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 设置分页查询参数 page: 页码, pageSize: 每页显示数量</span>
<span class="tok-n">PageHelper</span><span class="tok-p">.</span><span class="tok-na">startPage</span><span class="tok-p">(</span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// 紧跟着的第一个 select 方法会被分页 </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">list</span><span class="tok-p">();</span><span class="tok-w">   </span><span class="tok-c1">// 执行查询  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-n">Page</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Page</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-p">;</span><span class="tok-w">      </span><span class="tok-c1">// 获取分页结果，将 empList 转成 Page 类型</span>

<span class="tok-c1">// 封装成 PageBean 对象返回</span>
<span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-na">getTotal</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-na">getResult</span><span class="tok-p">());</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>必须紧跟着！！！</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>PageHelper 已经帮你做了物理分页，不必担心一次性查全表的问题。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_再实现多条件分页查询">再实现多条件分页查询</h5>
<div class="paragraph">
<p>条件分页查询流程</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/condition_page_flow.png" alt="condition page flow" width="1000">
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisecontrollerempcontroller_java_3">file &#8594; src/main/java/com/tjise/controller/EmpController.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.EmpService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.format.annotation.DateTimeFormat</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.GetMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestParam</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/emps&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_selectpage_4">selectPage</h6>
<div class="listingblock">
<div class="title">多条件分页查询</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-cm">/* @RequestParam(default) 设置默认值</span>
<span class="tok-cm">   若不设默认值，且前端又没传递参数 page 和 pageSize</span>
<span class="tok-cm">   则在 service 层对 page 做运算时会报空值异常(NullPointerException) */</span>
<span class="tok-nd">@GetMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-n">defaultValue</span><span class="tok-o">=</span><span class="tok-s">&quot;1&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-n">defaultValue</span><span class="tok-o">=</span><span class="tok-s">&quot;10&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-c1">// 多传递了 4 个参数</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nd">@DateTimeFormat</span><span class="tok-p">(</span><span class="tok-n">pattern</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;yyyy-MM-dd&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-nd">@DateTimeFormat</span><span class="tok-p">(</span><span class="tok-n">pattern</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;yyyy-MM-dd&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 打印看是否可以取到前端传递的参数，也可以使用 IDEA debug 模式查看</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">printf</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-s">&quot;page=%s, pageSize=%s, name=%s, gender=%s, begin=%s, end=%s%n&quot;</span><span class="tok-p">,</span>
<span class="tok-w">         </span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-n">pageBean</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">selectPage</span><span class="tok-p">(</span>
<span class="tok-w">                        </span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">pageBean</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceempservice_java_3">file &#8594; src/main/java/com/tjise/service/EmpService.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_4">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h6>

</div>
<div class="sect5">
<h6 id="_多条件查询传递多个参数">多条件查询传递多个参数</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-w"> </span><span class="tok-nf">selectPage</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">page</span><span class="tok-p">,</span>
<span class="tok-w">                           </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">,</span>
<span class="tok-w">                           </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span>
<span class="tok-w">                           </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span>
<span class="tok-w">                           </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span>
<span class="tok-w">                           </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">)</span>
<span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 设置分页查询参数 pageNum: 页码, pageSize: 每页显示数量</span>
<span class="tok-w">    </span><span class="tok-n">PageHelper</span><span class="tok-p">.</span><span class="tok-na">startPage</span><span class="tok-p">(</span><span class="tok-n">page</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">pageSize</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// 紧跟着的第一个select方法会被分页</span>
<span class="tok-w">    </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">list</span><span class="tok-p">(</span><span class="tok-n">name</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// 执行查询</span>
<span class="tok-w">    </span><span class="tok-n">Page</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Page</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">empList</span><span class="tok-p">;</span><span class="tok-w">      </span><span class="tok-c1">// 获取分页结果，将 empList 转成 Page 类型</span>

<span class="tok-w">    </span><span class="tok-c1">// 封装成 PageBean 对象返回</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">PageBean</span><span class="tok-p">(</span><span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-na">getTotal</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">p</span><span class="tok-p">.</span><span class="tok-na">getResult</span><span class="tok-p">());</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>必须紧跟着！！！</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>PageHelper 已经帮你做了物理分页，不必担心一次性查全表的问题。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisemapperempmapper_java_4">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h6>

</div>
<div class="sect5">
<h6 id="_多条件查询传递多个参数_2">多条件查询传递多个参数</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 使用 PageHelper 并配合条件查询，使用 xml 动态 sql 来实现</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Emp</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">list</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">name</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">Short</span><span class="tok-w"> </span><span class="tok-n">gender</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">LocalDate</span><span class="tok-w"> </span><span class="tok-n">end</span>
<span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainresourcescomtjisemapperempmapper_xml">file &#8594; src/main/resources/com/tjise/mapper/empMapper.xml</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;!</span><span class="tok-nt">DOCTYPE</span><span class="tok-w"> </span><span class="tok-nt">mapper</span>
<span class="tok-w">  </span><span class="tok-nt">PUBLIC</span><span class="tok-w"> </span><span class="tok-s2">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="tok-w">  </span><span class="tok-s2">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="tok-o">&gt;</span>

<span class="tok-o">&lt;</span><span class="tok-nt">mapper</span><span class="tok-w"> </span><span class="tok-nt">namespace</span><span class="tok-o">=</span><span class="tok-s2">&quot;com.tjise.mapper.EmpMapper&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">  </span><span class="tok-o">&lt;</span><span class="tok-nt">select</span><span class="tok-w"> </span><span class="tok-nt">id</span><span class="tok-o">=</span><span class="tok-s2">&quot;list&quot;</span><span class="tok-w"> </span><span class="tok-nt">resultType</span><span class="tok-o">=</span><span class="tok-s2">&quot;com.tjise.pojo.Emp&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">select</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-nt">from</span><span class="tok-w"> </span><span class="tok-nt">emp</span>
<span class="tok-w">        </span><span class="tok-o">&lt;</span><span class="tok-nt">where</span><span class="tok-o">&gt;</span>
<span class="tok-w">            </span><span class="tok-o">&lt;</span><span class="tok-nt">if</span><span class="tok-w"> </span><span class="tok-nt">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;name != null&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">name</span><span class="tok-w"> </span><span class="tok-nt">like</span><span class="tok-w"> </span><span class="tok-nt">concat</span><span class="tok-o">(</span><span class="tok-s1">&#39;%&#39;</span><span class="tok-o">,</span><span class="tok-w"> </span><span class="tok-nn">#</span><span class="tok-p">{</span><span class="tok-nt">name</span><span class="tok-p">}</span><span class="tok-o">,</span><span class="tok-w"> </span><span class="tok-s1">&#39;%&#39;</span><span class="tok-o">)</span>
<span class="tok-w">            </span><span class="tok-o">&lt;/</span><span class="tok-nt">if</span><span class="tok-o">&gt;</span>
<span class="tok-w">            </span><span class="tok-o">&lt;</span><span class="tok-nt">if</span><span class="tok-w"> </span><span class="tok-nt">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;gender != null&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">and</span><span class="tok-w"> </span><span class="tok-nt">gender</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-nn">#</span><span class="tok-p">{</span><span class="tok-nt">gender</span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-o">&lt;/</span><span class="tok-nt">if</span><span class="tok-o">&gt;</span>
<span class="tok-w">            </span><span class="tok-o">&lt;</span><span class="tok-nt">if</span><span class="tok-w"> </span><span class="tok-nt">test</span><span class="tok-o">=</span><span class="tok-s2">&quot;begin != null and end != null&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">                </span><span class="tok-nt">and</span><span class="tok-w"> </span><span class="tok-nt">entrydate</span><span class="tok-w"> </span><span class="tok-nt">between</span><span class="tok-w"> </span><span class="tok-nn">#</span><span class="tok-p">{</span><span class="tok-nt">begin</span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-nt">and</span><span class="tok-w"> </span><span class="tok-nn">#</span><span class="tok-p">{</span><span class="tok-nt">end</span><span class="tok-p">}</span>
<span class="tok-w">            </span><span class="tok-o">&lt;/</span><span class="tok-nt">if</span><span class="tok-o">&gt;</span>
<span class="tok-w">        </span><span class="tok-o">&lt;/</span><span class="tok-nt">where</span><span class="tok-o">&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">order</span><span class="tok-w"> </span><span class="tok-nt">by</span><span class="tok-w"> </span><span class="tok-nt">update_time</span><span class="tok-w"> </span><span class="tok-nt">desc</span>
<span class="tok-w">  </span><span class="tok-o">&lt;/</span><span class="tok-nt">select</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">mapper</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_测试查询员工列表">测试查询员工列表</h5>
<div class="paragraph">
<p>测试查询员工列表 api，假设本地服务端口为 8080，上下文路径为 /emps</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>不传 page 和 pageSize，验证默认值：page=1，pageSize=10</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>:8080/emps</code></pre>
</div>
</div>
</li>
<li>
<p>只传 page：<strong>预期：page=2，pageSize=10</strong></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>GET<span class="tok-w"> </span>:8080/emps<span class="tok-w"> </span><span class="tok-nv">page</span><span class="tok-o">==</span><span class="tok-m">2</span></code></pre>
</div>
</div>
</li>
<li>
<p>只传 pageSize：<strong>预期：page=1，pageSize=5</strong></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>GET<span class="tok-w"> </span>:8080/emps<span class="tok-w"> </span><span class="tok-nv">pageSize</span><span class="tok-o">==</span><span class="tok-m">5</span></code></pre>
</div>
</div>
</li>
<li>
<p>同时指定 page 和 pageSize：<strong>预期：page=3，pageSize=20</strong></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>GET<span class="tok-w"> </span>:8080/emps<span class="tok-w"> </span><span class="tok-nv">page</span><span class="tok-o">==</span><span class="tok-m">3</span><span class="tok-w"> </span><span class="tok-nv">pageSize</span><span class="tok-o">==</span><span class="tok-m">20</span></code></pre>
</div>
</div>
</li>
<li>
<p>把参数放在 URL 路径里（这样写也是可以的）</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>GET<span class="tok-w"> </span><span class="tok-s2">&quot;:8080/emps?page=4&amp;pageSize=15&quot;</span></code></pre>
</div>
</div>
</li>
<li>
<p>如果想看完整响应头，可加 <code>-v</code></p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="bash"><span></span>http<span class="tok-w"> </span>-v<span class="tok-w"> </span>:8080/emps<span class="tok-w"> </span><span class="tok-nv">page</span><span class="tok-o">==</span><span class="tok-m">2</span><span class="tok-w"> </span><span class="tok-nv">pageSize</span><span class="tok-o">==</span><span class="tok-m">5</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_2_删除员工单个和多个删除功能合一">16.2 删除员工(单个和多个删除功能合一)</h4>
<div class="paragraph">
<p>批量删除员工包含删除<strong>一条和多条</strong>记录的功能。</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/emps/{ids}</p>
</li>
<li>
<p>请求方式：DELETE</p>
</li>
<li>
<p>接口描述：该接口用于批量删除员工的数据信息</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：路径参数</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">示例</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ids</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">数组 array</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">1,2,3</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">员工的id数组</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>请求参数样例： <code>/emps/1,2,3</code></p>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>删除员工开发流程</p>
<div class="imageblock thumb">
<div class="content">
<img src="img/delete_emp_flow.png" alt="delete emp flow" width="1000">
</div>
</div>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerempcontroller_java_4">file &#8594; src/main/java/com/tjise/controller/EmpController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.EmpService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.format.annotation.DateTimeFormat</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.*</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/emps&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_deleteemp">deleteEmp</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{ids}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteEmp</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ids</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">ids</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceempservice_java_4">file &#8594; src/main/java/com/tjise/service/EmpService.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_deleteempbyids">deleteEmpByIds</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ids</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_5">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deleteempbyids_2">deleteEmpByIds</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ids</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">ids</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperempmapper_java_5">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h5>
<div class="sect5">
<h6 id="_deleteempbyids_3">deleteEmpByIds</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ids</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainresourcescomtjisemapperempmapper_xml_2">file &#8594; src/main/resources/com/tjise/mapper/empMapper.xml</h5>
<div class="sect5">
<h6 id="_empmapper_xml_动态sql">EmpMapper.xml &#8594; 动态SQL</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;!</span><span class="tok-nt">DOCTYPE</span><span class="tok-w"> </span><span class="tok-nt">mapper</span>
<span class="tok-w">  </span><span class="tok-nt">PUBLIC</span><span class="tok-w"> </span><span class="tok-s2">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span>
<span class="tok-w">  </span><span class="tok-s2">&quot;https://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span><span class="tok-o">&gt;</span>

<span class="tok-o">&lt;</span><span class="tok-nt">mapper</span><span class="tok-w"> </span><span class="tok-nt">namespace</span><span class="tok-o">=</span><span class="tok-s2">&quot;com.tjise.mapper.EmpMapper&quot;</span><span class="tok-o">&gt;</span>
<span class="tok-w">  </span><span class="tok-o">@</span><span class="tok-nt">others</span>

<span class="tok-o">&lt;/</span><span class="tok-nt">mapper</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deleteempbyids_4">deleteEmpByIds</h6>
<div class="paragraph">
<p>sql: delete from emp where id in (1, 2, 3);</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>&lt;delete id=&quot;deleteEmpByIds&quot;&gt;
    delete from emp where id in
    &lt;foreach collection=&quot;ids&quot; item=&quot;id&quot; open=&quot;(&quot; close=&quot;)&quot; separator=&quot;,&quot;&gt;
        #{id}
    &lt;/foreach&gt;
&lt;/delete&gt;</code></pre>
</div>
</div>
<div class="paragraph">
<p>在 MyBatis 解析后，上面这段 XML 最终会变成一条<strong>完整、可直接执行的 SQL 语句</strong>发送到数据库。
以接口传入 <code>List&lt;Integer&gt; ids = Arrays.asList(1,2,3)</code> 为例，解析结果等价于：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">DELETE</span><span class="tok-w"> </span><span class="tok-k">FROM</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-w"> </span><span class="tok-k">WHERE</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-w"> </span><span class="tok-k">IN</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-mi">1</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">3</span><span class="tok-p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>具体过程
1. <code>&lt;foreach&gt;</code> 把集合 <code>ids</code> 展开成 <code>(1,2,3)</code> 这一段文本。
2. 整个 SQL 模板被替换成：
   <code>DELETE FROM emp WHERE id IN ( ?, ?, ? )</code>
   并生成对应的 <code>PreparedStatement</code> 参数列表 <code>[1,2,3]</code>。
3. JDBC 驱动收到的是带占位符的预编译 SQL 和三个参数值，<strong>不会</strong>出现 <code>"in ('1,2,3')"</code> 这种字符串拼接错误。</p>
</div>
<div class="paragraph">
<p>所以，无论你把 <code>item</code> 取名 <code>"id"</code> 还是 <code>"aaa"</code>，最终 SQL 形态都一样：
<code>… IN ( ?, ?, … )</code>，参数按顺序逐个绑定。</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
item 的值要和 #{} 中的值一样！
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_3_新增员工">16.3 新增员工</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/emps</p>
</li>
<li>
<p>请求方式：POST</p>
</li>
<li>
<p>接口描述：该接口用于添加员工的信息</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">性别, 说明: 1 男, 2 女</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">头像</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deptId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entrydate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入职日期</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>请求数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;image&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;linpingzhi&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;林平之&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;gender&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;job&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;entrydate&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-18&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;deptId&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stripes-even stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>测试新增员工 api</p>
</div>
<div class="ulist">
<ul>
<li>
<p>在浏览器的管理端进行新增员工测试。</p>
</li>
<li>
<p>使用 httpie 进行 post 测试。</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre>http POST :8080/emps \
  image='' \
  username='wanglin' \
  name='王林' \
  gender:=1 \
  job:=1 \
  entrydate='2025-09-23' \
  deptId:=16</pre>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerempcontroller_java_5">file &#8594; src/main/java/com/tjise/controller/EmpController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Emp</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service.EmpService</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.format.annotation.DateTimeFormat</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.*</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-nd">@RequestMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/emps&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">EmpController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_insertemp">insertEmp</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@PostMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertEmp</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">insertEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceempservice_java_5">file &#8594; src/main/java/com/tjise/service/EmpService.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Emp</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.PageBean</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDate</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpService</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_insertemp_2">insertEmp</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_6">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_insertemp_3">insertEmp</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-c1">// 业务逻辑补全属性</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setCreateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">insertEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperempmapper_java_6">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h5>
<div class="sect5">
<h6 id="_insertemp_4">insertEmp</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;insert into emp (username, name, gender, image, job, entrydate, dept_id, create_time, update_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">        </span><span class="tok-s">&quot;values (#{username}, #{name}, #{gender}, #{image}, #{job}, #{entrydate}, #{deptId}, #{createTime}, #{updateTime})&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_4_文件上传员工头像">16.4 文件上传员工头像</h4>
<div class="sect4">
<h5 id="_16_4_1_文件上传接口信息描述">16.4.1 文件上传接口信息描述</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>基本信息</p>
<div class="ulist">
<ul>
<li>
<p>请求路径：/upload</p>
</li>
<li>
<p>请求方式：POST</p>
</li>
<li>
<p>接口描述：上传图片接口</p>
</li>
</ul>
</div>
</li>
<li>
<p>请求参数</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：multipart/form-data 这种格式可以上传文件</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名称</th>
<th class="tableblock halign-left valign-top">参数类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">示例</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">file</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">是</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">N/A</p></td>
</tr>
</tbody>
</table>
</li>
</ul>
</div>
</li>
<li>
<p>响应数据</p>
<div class="ulist">
<ul>
<li>
<p>参数格式：application/json</p>
</li>
<li>
<p>参数说明：</p>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据，上传图片的访问路径，前端根据此路径 URL 显示图片</p></td>
</tr>
</tbody>
</table>
</li>
<li>
<p>响应数据样例</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-0400.jpg&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_16_4_2_文件上传至本地开发目录">16.4.2 文件上传至本地开发目录</h5>
<div class="paragraph">
<p>在 Spring Boot 中接收前端上传的图片并存储在可以通过 URL 访问的目录下。</p>
</div>
<div class="paragraph">
<p>通常 <mark>不要</mark> 将图片存储在 <code>src/main/resources/static</code> 目录下。这是因为 Spring Boot 默认会在重新编译后才能将 static 目录下的文件作为静态资源提供。也就是说需要重新启动开发环境才能在浏览器中访问上传的资源文件。这样在开发时很不方便，还有在服务器上部署以后，客户端上传的文件也不能实时更新。</p>
</div>
<div class="paragraph">
<p>下面将前端上传的资源存储在指定的目录 UPLOAD_DIR 下，并且使用前缀 uploads 进行访问。</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisecontrolleruploadcontroller_java">file &#8594; src/main/java/com/tjise/controller/UploadController.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.PostMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestParam</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.File</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.IOException</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.UUID</span><span class="tok-p">;</span>

<span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">UploadController</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 别忘记创建目录: mkdir uploads</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kd">final</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">UPLOAD_DIR</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/Users/swot/swot-learning/java/springboot/spring-boot-ketang/general-manager/uploads/&quot;</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/upload&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-s">&quot;image&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">image</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 可以使用 IDEA 的 debug 模式查看变量</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">filename</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-na">getOriginalFilename</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 获取上传的文件名</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">names</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">filename</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;\\.&quot;</span><span class="tok-p">);</span><span class="tok-w">         </span><span class="tok-c1">// 以点切割文件名</span>
<span class="tok-w">        </span><span class="tok-c1">// \\. 中的第一个 \ 是为了让 Java 编译器理解这是一个反斜杠</span>
<span class="tok-w">        </span><span class="tok-c1">// \\. 中的第二个 \ 则是在正则表达式中表示字面量的点</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">extName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">names</span><span class="tok-o">[</span><span class="tok-n">names</span><span class="tok-p">.</span><span class="tok-na">length</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-p">;</span><span class="tok-w">       </span><span class="tok-c1">// 获取文件扩展名</span>
<span class="tok-w">        </span><span class="tok-n">UUID</span><span class="tok-w"> </span><span class="tok-n">randomString</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">UUID</span><span class="tok-p">.</span><span class="tok-na">randomUUID</span><span class="tok-p">();</span><span class="tok-w">          </span><span class="tok-c1">// 生成随机字符串</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">randomFilename</span><span class="tok-w">  </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">randomString</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">extName</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">image</span><span class="tok-p">.</span><span class="tok-na">transferTo</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">File</span><span class="tok-p">(</span><span class="tok-n">UPLOAD_DIR</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">randomFilename</span><span class="tok-p">));</span>
<span class="tok-w">        </span><span class="tok-c1">// 前缀路由 uploads 参节点配置内容</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-s">&quot;http://localhost:8080/uploads/&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">randomFilename</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_4_3_文件上传目录映射指本地目录映射成url前缀">16.4.3 文件上传目录映射（指本地目录映射成url前缀）</h5>
<div class="paragraph">
<p>要想实现上传功能，需要定义一个 spring 的配置类，来指定将哪个目录映射成哪个前缀。
如在 config 包中书写实现接口 WebMvcConfigurer 的类 MyMvcConfig.java。</p>
</div>
<div class="paragraph">
<p>创建 config 包: <code>mkdir config</code></p>
</div>
<div class="paragraph">
<p>下面代码中的 <code>MyMvcConfig</code> 之所以会被“自动注册”，是因为它被放在 <strong>启动类所在的包或其子包</strong> 里（<code>com.tjise</code> 或其子包），Spring Boot 启动时会自动扫描到它的 <code>@Configuration</code>，进而把它里面对 <code>WebMvcConfigurer</code> 的实现（<code>addResourceHandlers</code>）合并进 Spring MVC 的全局配置。</p>
</div>
<div class="paragraph">
<p>详细过程如下：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>你项目的主启动类（<code>@SpringBootApplication</code>）通常长这样：</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-w">  </span><span class="tok-nd">@SpringBootApplication</span><span class="tok-w">   </span><span class="tok-c1">// 里面包含 @ComponentScan</span>
<span class="tok-w">  </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">Application</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">      </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">          </span><span class="tok-n">SpringApplication</span><span class="tok-p">.</span><span class="tok-na">run</span><span class="tok-p">(</span><span class="tok-n">Application</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">);</span>
<span class="tok-w">      </span><span class="tok-p">}</span>
<span class="tok-w">  </span><span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>默认 <code>@SpringBootApplication</code> 的 <code>@ComponentScan</code> 从该类所在包（<code>com.tjise.xxx</code>）开始，向下递归扫描所有子包。</p>
</div>
</li>
<li>
<p><code>MyMvcConfig</code> 的包名是 <code>com.tjise.config</code>，恰好是启动类所在包的<strong>子包</strong>，所以被扫描到。</p>
</li>
<li>
<p>扫描到后发现这个类上有 <code>@Configuration</code>，于是被注册为 Spring 容器里的一个 <strong>配置 Bean</strong>。</p>
</li>
<li>
<p>Spring Boot 在容器初始化阶段，会拿到<strong>所有</strong>实现了 <code>WebMvcConfigurer</code> 接口的 Bean，依次调用它们的回调方法（<code>addResourceHandlers</code>、<code>addViewControllers</code>…），把各个配置“叠加”到最终的 Spring MVC 配置中。</p>
</li>
<li>
<p>最终，<code>/uploads/**</code> 到本地磁盘目录 的映射就生效了。</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>因此：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>只要你没改 <code>@SpringBootApplication</code> 的扫描路径，也没在启动类上加额外的 <code>@ComponentScan(excludeFilters=&#8230;&#8203;)</code>，放在 <code>com.tjise.config</code> 里的 <code>MyMvcConfig</code> 天然就会被自动注册。</p>
</li>
<li>
<p>如果你把 <code>MyMvcConfig</code> 放到和启动类<strong>平级或更外层</strong>的包，例如 <code>com.other.config</code>，而又没手动 <code>@ComponentScan("com.other")</code>，就不会被扫描到。</p>
</li>
</ul>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseconfigmymvcconfig_java">file &#8594; src/main/java/com/tjise/config/MyMvcConfig.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.config</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.context.annotation.Configuration</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.servlet.config.annotation.ResourceHandlerRegistry</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="tok-p">;</span>

<span class="tok-c1">// 此注解表明该类是 Spring 配置类。Spring 会自动扫描并注册该类，使其可以作为应用上下文的一部分。</span>
<span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">MyMvcConfig</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">WebMvcConfigurer</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// WebMvcConfigurer 是一个接口，允许用户自定义 Spring MVC 的配置。通过实现这个接口，你可以覆盖默认配置或添加自定义配置。</span>

<span class="tok-w">    </span><span class="tok-c1">// 配置虚拟路径映射访问</span>
<span class="tok-w">    </span><span class="tok-nd">@Override</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">addResourceHandlers</span><span class="tok-p">(</span><span class="tok-n">ResourceHandlerRegistry</span><span class="tok-w"> </span><span class="tok-n">registry</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 映射图片保存地址</span>
<span class="tok-w">        </span><span class="tok-n">registry</span><span class="tok-p">.</span><span class="tok-na">addResourceHandler</span><span class="tok-p">(</span><span class="tok-s">&quot;/uploads/**&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 增加 url 前缀</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">addResourceLocations</span><span class="tok-p">(</span><span class="tok-s">&quot;file:/Users/swot/swot-learning/java/springboot/spring-boot-ketang/general-manager/uploads/&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 获取图片的路径</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_4_4_测试图片上传功能">16.4.4 测试图片上传功能</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>运行后台服务程序</p>
</li>
<li>
<p>使用 httpie 或者在网页中测试图片上传</p>
<div class="listingblock">
<div class="title">上传单个文件</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">http -f POST :8080/upload image@/Users/swot/Downloads/xianni/1.jpg</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_16_4_5_文件上传大小限制">16.4.5 文件上传大小限制</h5>
<div class="paragraph">
<p>上传文件默认大小为 1M (1048576 bytes)，如果上传超限，则会报错:</p>
</div>
<div class="literalblock">
<div class="content">
<pre>org.apache.tomcat.util.http.fileupload.impl.FileSizeLimitExceededException: The field image exceeds its maximum permitted size of 1048576 bytes.</pre>
</div>
</div>
<div class="listingblock">
<div class="title">在配置文件 application.properties 中加入配置信息</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><span></span><span class="tok-c1"># 指定单个文件上传的大小，默认为 1M</span>
<span class="tok-na">spring.servlet.multipart.max-file-size</span><span class="tok-o">=</span><span class="tok-s">10MB</span>

<span class="tok-c1"># 指定单次请求上传文件的总大小</span>
<span class="tok-na">spring.servlet.multipart.max-request-size</span><span class="tok-o">=</span><span class="tok-s">100MB</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainresourcesapplication_properties_2">file &#8594; src/main/resources/application.properties</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1"># 配置文件行最后不能有空格</span>
<span class="tok-na">spring.application.name</span><span class="tok-o">=</span><span class="tok-s">general-manager</span>

<span class="tok-c1"># --- 数据库 ---</span>
<span class="tok-c1"># 驱动类名称</span>
<span class="tok-na">spring.datasource.driver-class-name</span><span class="tok-o">=</span><span class="tok-s">com.mysql.cj.jdbc.Driver</span>
<span class="tok-c1"># 数据库连接的 url</span>
<span class="tok-na">spring.datasource.url</span><span class="tok-o">=</span><span class="tok-s">jdbc:mysql://localhost:3307/general_manager</span>
<span class="tok-c1"># 连接数据库的用户名</span>
<span class="tok-na">spring.datasource.username</span><span class="tok-o">=</span><span class="tok-s">root</span>
<span class="tok-c1"># 连接数据库的密码</span>
<span class="tok-na">spring.datasource.password</span><span class="tok-o">=</span><span class="tok-s">root</span>

<span class="tok-c1"># --- mybatis ---</span>
<span class="tok-c1"># 指定mybatis输出日志的位置, 输出控制台</span>
<span class="tok-na">mybatis.configuration.log-impl</span><span class="tok-o">=</span><span class="tok-s">org.apache.ibatis.logging.stdout.StdOutImpl</span>
<span class="tok-c1">#开启驼峰命名自动映射，即从经典数据库列名 a_column 映射到经典 Java 属性 名 aColumn。</span>
<span class="tok-na">mybatis.configuration.map-underscore-to-camel-case</span><span class="tok-o">=</span><span class="tok-s">true</span>

<span class="tok-c1"># --- New Added ---</span>
<span class="tok-c1"># 指定单个文件上传的大小，默认为 1M</span>
<span class="tok-na">spring.servlet.multipart.max-file-size</span><span class="tok-o">=</span><span class="tok-s">10MB</span>
<span class="tok-c1"># 指定单次请求上传文件的总大小</span>
<span class="tok-na">spring.servlet.multipart.max-request-size</span><span class="tok-o">=</span><span class="tok-s">100MB</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_5_文件上传至阿里云_oss">16.5 文件上传至阿里云 OSS</h4>
<div class="sect4">
<h5 id="_16_5_1_阿里云_oss_简介">16.5.1 阿里云 OSS 简介</h5>
<div class="paragraph">
<p>​阿里云对象存储服务（Object Storage Service，简称OSS）为您提供基于网络的数据存取服务。使用 OSS，您可以通过网络随时存储和调用包括文本、图片、音频和视频等在内的各种非结构化数据文件。</p>
</div>
<div class="paragraph">
<p>阿里云OSS将数据文件以对象（object）的形式上传到存储空间（bucket）中。</p>
</div>
<div class="paragraph">
<p>​您可以进行以下操作：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>创建一个或者多个存储空间，向每个存储空间中添加一个或多个文件。</p>
</li>
<li>
<p>通过获取已上传文件的地址进行文件的分享和下载。</p>
</li>
<li>
<p>通过修改存储空间或文件的属性或元信息来设置相应的访问权限。</p>
</li>
<li>
<p>在阿里云管理控制台执行基本和高级OSS任务。</p>
</li>
<li>
<p>使用阿里云开发工具包或直接在应用程序中进行 RESTful API 调用执行基本和高级 OSS 任务</p>
</li>
</ul>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_2_阿里云_oss_开通">16.5.2 阿里云 OSS 开通</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>打开 <a href="https://www.aliyun.com/" class="bare">https://www.aliyun.com/</a> ，申请阿里云账号并完成实名认证。</p>
</li>
<li>
<p>充值（有试用流量）</p>
</li>
<li>
<p>开通OSS:</p>
<div class="ulist">
<ul>
<li>
<p>登录阿里云官网。将鼠标移至产品找到并单击对象存储 OSS 打开 OSS 产品详情页面。在 OSS 产品详情页中的单击立即开通。</p>
</li>
<li>
<p>开通服务后，在 OSS 产品详情页面单击管理控制台直接进入 OSS 管理控制台界面。</p>
</li>
<li>
<p>您也可以单击位于官网首页右上方菜单栏的控制台，进入阿里云管理控制台首页，然后单击左侧的对象存储OSS菜单进入 <a href="https://oss.console.aliyun.com/overview">OSS管理控制台界面</a>。</p>
</li>
</ul>
</div>
</li>
<li>
<p>创建存储空间</p>
<div class="ulist">
<ul>
<li>
<p>新建 Bucket，自己命名 ，读写权限为<strong>公共读</strong></p>
<div class="imageblock thumb">
<div class="content">
<img src="img/aliyun_oss_create_bucket0.png" alt="aliyun oss create bucket0">
</div>
</div>
<div class="imageblock thumb">
<div class="content">
<img src="img/aliyun_oss_create_bucket1.png" alt="aliyun oss create bucket1" width="1000">
</div>
</div>
</li>
</ul>
</div>
</li>
</ol>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_3_获取访问密钥">16.5.3 获取访问密钥</h5>
<div class="paragraph">
<p>在阿里云右上角主帐号下拉菜单中，可以操作访问密钥 AccessKey</p>
</div>
<div class="imageblock thumb">
<div class="content">
<img src="img/oss_AccessKey.png" alt="oss AccessKey">
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_4_引入阿里云_oss_依赖">16.5.4 引入阿里云 OSS 依赖</h5>
<div class="paragraph">
<p><a href="https://help.aliyun.com/document_detail/32009.html?spm=a2c4g.11186623.6.919.7c264562C2Fjfs">参考文档官方</a>
创建测试工程，引入依赖</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>com.aliyun.oss<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>aliyun-sdk-oss<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>3.15.1<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_file_pom_xml_2">file &#8594; pom.xml</h6>

</div>
<div class="sect5">
<h6 id="_aliyun_sdk_oss">aliyun-sdk-oss</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">com</span><span class="tok-nc">.aliyun.oss</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">aliyun-sdk-oss</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span><span class="tok-nt">3</span><span class="tok-nc">.15.1</span><span class="tok-o">&lt;/</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_5_oss_明文文本密钥测试本地文件上传也叫静态凭证仅用于测试环境">16.5.5 OSS 明文文本密钥测试本地文件上传&#8201;&#8212;&#8201;也叫静态凭证（仅用于测试环境）</h5>
<div class="paragraph">
<p><a href="https://help.aliyun.com/zh/oss/developer-reference/oss-java-sdk/?spm=a2c4g.11186623.help-menu-31815.d_19_2_0.2c3914acgyNzrF&amp;scm=20140722.H_32008._.OR_help-T_cn~zh-V_1#bd4a905a056cr">静态凭证文档 2025-08-14 16:10:58</a></p>
</div>
<div class="sect5">
<h6 id="_下面是在_main_函数中使用_ossclientbuilder_create_方式的测试最新方式">下面是在 main 函数中使用 OSSClientBuilder.create() 方式的测试&#8201;&#8212;&#8201;最新方式</h6>

</div>
<div class="sect5">
<h6 id="_file_srctestjavacomtjiseakdemotest_java">file &#8594; src/test/java/com/tjise/AkDemoTest.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-err">&gt;&gt;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AkDemoTest</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nd">@others</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_import">&lt;&lt; import &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.junit.jupiter.api.Test</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.FileInputStream</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.InputStream</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.ClientException</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSException</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.ClientBuilderConfiguration</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.common.auth.CredentialsProvider</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.common.auth.DefaultCredentialProvider</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.common.comm.SignVersion</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_上传配置">上传配置</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span><span class="tok-p">;</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">region</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;cn-beijing&quot;</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 具体与 endpoint 不同的对应，请搜索 aliyun 官网</span>

<span class="tok-c1">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="tok-c1">// 在阿里云控制台左上角帐号下拉菜单中点击 「AccessKey管理」获取密钥</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写Bucket名称，例如examplebucket。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;swot-learn&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写Object完整路径，完整路径中不能包含Bucket名称，例如 exampledir/exampleobject.txt。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;xian_ni_01.jpg&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写本地文件的完整路径，例如D:\\localpath\\examplefile.txt。</span>
<span class="tok-c1">// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">filePath</span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/Users/swot/Downloads/xianni/1.jpg&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 使用DefaultCredentialProvider方法直接设置AK和SK</span>
<span class="tok-n">CredentialsProvider</span><span class="tok-w"> </span><span class="tok-n">credentialsProvider</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">DefaultCredentialProvider</span><span class="tok-p">(</span><span class="tok-n">accessKeyId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">);</span>

<span class="tok-c1">// 创建配置</span>
<span class="tok-n">ClientBuilderConfiguration</span><span class="tok-w"> </span><span class="tok-n">clientBuilderConfiguration</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ClientBuilderConfiguration</span><span class="tok-p">();</span>
<span class="tok-c1">// 显式声明使用 V4 签名算法</span>
<span class="tok-n">clientBuilderConfiguration</span><span class="tok-p">.</span><span class="tok-na">setSignatureVersion</span><span class="tok-p">(</span><span class="tok-n">SignVersion</span><span class="tok-p">.</span><span class="tok-na">V4</span><span class="tok-p">);</span>
<span class="tok-c1">// 创建OSSClient实例。</span>
<span class="tok-c1">// 当OSSClient实例不再使用时，调用shutdown方法以释放资源。</span>
<span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">.</span><span class="tok-na">create</span><span class="tok-p">()</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-na">endpoint</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-na">credentialsProvider</span><span class="tok-p">(</span><span class="tok-n">credentialsProvider</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-na">clientConfiguration</span><span class="tok-p">(</span><span class="tok-n">clientBuilderConfiguration</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-na">region</span><span class="tok-p">(</span><span class="tok-n">region</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-p">.</span><span class="tok-na">build</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_开始上传">开始上传</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">FileInputStream</span><span class="tok-p">(</span><span class="tok-n">filePath</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// 创建PutObject请求。</span>
<span class="tok-w">    </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">OSSException</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;but was rejected with an error response for some reason.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorMessage</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Code:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorCode</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Request ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getRequestId</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Host ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getHostId</span><span class="tok-p">());</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an ClientException, which means the client encountered &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;such as not being able to access the network.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">());</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">finally</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_下面是在_test_中使用_test_注解的_ossclientbuilder_build_方式的测试">下面是在 test 中使用 @Test 注解的 OSSClientBuilder().build() 方式的测试</h6>

</div>
<div class="sect5">
<h6 id="_file_srctestjavacomtjisealiosstest_java">file &#8594; src/test/java/com/tjise/AliOssTest.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-err">&gt;&gt;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOssTest</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Test</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">testOss</span><span class="tok-p">(){</span>
<span class="tok-w">        </span><span class="tok-nd">@others</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_import_2">&lt;&lt; import &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.junit.jupiter.api.Test</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.ClientException</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSException</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.FileInputStream</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.InputStream</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_上传配置_2">上传配置</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 阿里云账号AccessKey拥有所有API的访问权限，风险很高。强烈建议您创建并使用RAM用户进行API访问或日常运维，请登录RAM控制台创建RAM用户。</span>
<span class="tok-c1">// 在阿里云控制台左上角帐号下拉菜单中点击 「AccessKey管理」获取密钥</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写Bucket名称，例如examplebucket。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;swot-learn&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写Object完整路径，完整路径中不能包含Bucket名称，例如 exampledir/exampleobject.txt。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;xian_ni_01.jpg&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 填写本地文件的完整路径，例如D:\\localpath\\examplefile.txt。</span>
<span class="tok-c1">// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">filePath</span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/Users/swot/Downloads/xianni/1.jpg&quot;</span><span class="tok-p">;</span>

<span class="tok-c1">// 创建 OSSClient 实例</span>
<span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">().</span><span class="tok-na">build</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_开始上传_2">开始上传</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">FileInputStream</span><span class="tok-p">(</span><span class="tok-n">filePath</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// 创建PutObject请求。</span>
<span class="tok-w">    </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">OSSException</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;but was rejected with an error response for some reason.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorMessage</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Code:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorCode</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Request ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getRequestId</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Host ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getHostId</span><span class="tok-p">());</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an ClientException, which means the client encountered &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span>
<span class="tok-w">            </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;such as not being able to access the network.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">());</span>
<span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">finally</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_6_oss_环境变量密钥测试本地文件上传适用于生产环境使用环境变量的情况">16.5.6 OSS 环境变量密钥测试本地文件上传&#8201;&#8212;&#8201;适用于生产环境使用环境变量的情况</h5>
<div class="paragraph">
<p><a href="https://help.aliyun.com/zh/oss/developer-reference/oss-java-sdk/?spm=a2c4g.11186623.help-menu-31815.d_19_2_0.2c3914acgyNzrF&amp;scm=20140722.H_32008._.OR_help-T_cn~zh-V_1#9c8e8849706wp">配置访问凭证</a></p>
</div>
<div class="listingblock">
<div class="title">在操作系统中导出两个环境变量，分别是:</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="shell"><span></span><span class="tok-c1"># 设置阿里云 OSS 这是 macos 的设置，其他操作系统参考上面官方文档</span>
<span class="tok-nb">export</span><span class="tok-w"> </span><span class="tok-nv">OSS_ACCESS_KEY_ID</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">[</span>REMOVED<span class="tok-o">]</span>
<span class="tok-nb">export</span><span class="tok-w"> </span><span class="tok-nv">OSS_ACCESS_KEY_SECRET</span><span class="tok-o">=</span><span class="tok-s2">&quot;&quot;</span><span class="tok-o">[</span>REMOVED<span class="tok-o">]</span>

<span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-nv">$OSS_ACCESS_KEY_ID</span>
<span class="tok-nb">echo</span><span class="tok-w"> </span><span class="tok-nv">$OSS_ACCESS_KEY_SECRET</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_file_srctestjavacomtjisealiossenvtest_java">file &#8594; src/test/java/com/tjise/AliOssEnvTest.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.common.auth.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.common.comm.SignVersion</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.model.PutObjectRequest</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.model.PutObjectResult</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.FileInputStream</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.InputStream</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOssEnvTest</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// Endpoint以华东1（杭州）为例，其它Region请按实际情况填写。</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1">// 从环境变量中获取访问凭证。运行本代码示例之前，请确保已设置环境变量 OSS_ACCESS_KEY_ID 和OSS_ACCESS_KEY_SECRET。</span>
<span class="tok-w">        </span><span class="tok-n">EnvironmentVariableCredentialsProvider</span><span class="tok-w"> </span><span class="tok-n">credentialsProvider</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">CredentialsProviderFactory</span><span class="tok-p">.</span><span class="tok-na">newEnvironmentVariableCredentialsProvider</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-c1">// 填写Bucket名称，例如examplebucket。</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;swot-learn&quot;</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1">// 填写Object完整路径，完整路径中不能包含Bucket名称，例如exampledir/exampleobject.txt。</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;xian_ni_03.jpg&quot;</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1">// 填写本地文件的完整路径，例如D:\\localpath\\examplefile.txt。</span>
<span class="tok-w">        </span><span class="tok-c1">// 如果未指定本地路径，则默认从示例程序所属项目对应本地路径中上传文件流。</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">filePath</span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/Users/swot/Downloads/xianni/2.jpg&quot;</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1">// 填写Bucket所在地域。以华东1（杭州）为例，Region填写为cn-hangzhou。</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">region</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;cn-beijing&quot;</span><span class="tok-p">;</span>

<span class="tok-w">        </span><span class="tok-c1">// 创建OSSClient实例。</span>
<span class="tok-w">        </span><span class="tok-n">ClientBuilderConfiguration</span><span class="tok-w"> </span><span class="tok-n">clientBuilderConfiguration</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">ClientBuilderConfiguration</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-n">clientBuilderConfiguration</span><span class="tok-p">.</span><span class="tok-na">setSignatureVersion</span><span class="tok-p">(</span><span class="tok-n">SignVersion</span><span class="tok-p">.</span><span class="tok-na">V4</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">.</span><span class="tok-na">create</span><span class="tok-p">()</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">endpoint</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">credentialsProvider</span><span class="tok-p">(</span><span class="tok-n">credentialsProvider</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">clientConfiguration</span><span class="tok-p">(</span><span class="tok-n">clientBuilderConfiguration</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">region</span><span class="tok-p">(</span><span class="tok-n">region</span><span class="tok-p">)</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">build</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">FileInputStream</span><span class="tok-p">(</span><span class="tok-n">filePath</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-c1">// 创建PutObjectRequest对象。</span>
<span class="tok-w">            </span><span class="tok-n">PutObjectRequest</span><span class="tok-w"> </span><span class="tok-n">putObjectRequest</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">PutObjectRequest</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">objectName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-c1">// 创建PutObject请求。</span>
<span class="tok-w">            </span><span class="tok-n">PutObjectResult</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">putObjectRequest</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">OSSException</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an OSSException, which means your request made it to OSS, &quot;</span>
<span class="tok-w">                             </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;but was rejected with an error response for some reason.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorMessage</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Code:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getErrorCode</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Request ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getRequestId</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Host ID:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">oe</span><span class="tok-p">.</span><span class="tok-na">getHostId</span><span class="tok-p">());</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ClientException</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Caught an ClientException, which means the client encountered &quot;</span>
<span class="tok-w">                             </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;a serious internal problem while trying to communicate with OSS, &quot;</span>
<span class="tok-w">                             </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;such as not being able to access the network.&quot;</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Error Message:&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">ce</span><span class="tok-p">.</span><span class="tok-na">getMessage</span><span class="tok-p">());</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">finally</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">!=</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">                </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-p">}</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_7_oss_封装工具类">16.5.7 OSS 封装工具类</h5>
<div class="paragraph">
<p>upload 是非静态方法，需要类的对象去调用。可以将 IOC 控制反转容器中的 bean 对象去做 DI 依赖注入对象后，来调用 upload 方法。</p>
</div>
<details>
<summary class="title">详细解释，先把概念拆成三块。</summary>
<div class="content">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>非静态方法</p>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-n">utils</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">AliOSSUtils</span><span class="tok-p">();</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">utils</span><span class="tok-p">.</span><span class="tok-na">upload</span><span class="tok-p">(</span><span class="tok-n">file</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// 必须 new 一个对象才能用 upload</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>如果方法声明成 <code>static</code>，就可以 <code>AliOSSUtils.upload(file)</code>，但这里没有 <code>static</code>，所以只能“用对象去调用”。</p>
</div>
</li>
<li>
<p>IOC/DI</p>
<div class="paragraph">
<p>在 Spring 里，类上加了 <code>@Component</code>，Spring 会把它放进 IOC 容器（一个“对象池”）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Autowired</span><span class="tok-w">          </span><span class="tok-c1">// 依赖注入</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-n">aliOSSUtils</span><span class="tok-p">;</span><span class="tok-w">   </span><span class="tok-c1">// Spring 把容器里的那个对象塞进来</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>这一步就叫 <strong>DI（Dependency Injection）</strong>，你不用自己 <code>new</code>，Spring 帮你把对象准备好并注入到需要它的地方。</p>
</div>
</li>
<li>
<p>三者关系</p>
<div class="ulist">
<ul>
<li>
<p>upload 不是 static，所以<strong>一定</strong>要某个实例才能调用。</p>
</li>
<li>
<p>这个实例从哪里来？可以让 Spring 帮你管理——先让 Spring 把 <code>AliOSSUtils</code> 变成 bean（IOC），再在需要的地方 <code>@Autowired</code> 进来（DI）。</p>
</li>
<li>
<p>注入进来以后，直接 <code>aliOSSUtils.upload(&#8230;&#8203;)</code> 就能用。</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>一句话总结：<br>
因为 <code>upload</code> 不是静态的，所以我们得先拿到一个 <code>AliOSSUtils</code> 对象；最方便的办法就是让 Spring 容器生成并注入这个对象，然后调用它的 <code>upload</code> 方法。</p>
</div>
</div>
</details>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseutilsaliossutils_java">file &#8594; src/main/java/com/tjise/utils/AliOSSUtils.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.format.DateTimeFormatter</span><span class="tok-p">;</span>

<span class="tok-c1">// 阿里云 OSS 工具类</span>
<span class="tok-c1">// 放入IOC 容器中，不属于 控制层@Controller、业务层@Service、持久层@Repository，所以就用 @Component 吧</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Data</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 这儿的参数是写死的，后面再解决</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;swot-learn&quot;</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-c1">// 实现上传图片到OSS</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 获取上传的文件的输入流</span>
<span class="tok-w">        </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 避免文件覆盖</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">().</span><span class="tok-na">format</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">DateTimeFormatter</span><span class="tok-p">.</span><span class="tok-na">ofPattern</span><span class="tok-p">(</span><span class="tok-s">&quot;yyyy-MM-dd-HH-mm-ss&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getOriginalFilename</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">//上传文件到 OSS（没有使用 region，还是老的方式，建议使用新方式 create，不使用 build）</span>
<span class="tok-w">        </span><span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">().</span><span class="tok-na">build</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">//文件访问路径</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;//&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 关闭 ossClient</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-p">;</span><span class="tok-w">            </span><span class="tok-c1">// 把上传到 oss 的路径返回</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_8_oss_封装工具类的使用_重写图片上传控制类">16.5.8 OSS 封装工具类的使用 &#8594; 重写图片上传控制类</h5>
<div class="paragraph">
<p>使用 httpie 测试上传图片:<br>
http -f POST <a href="http://localhost:8080/upload" class="bare">http://localhost:8080/upload</a> image@/Users/swot/Downloads/uifaces-cartoon-image-8.jpg</p>
</div>
<div class="literalblock">
<div class="title">图片上传成功</div>
<div class="content">
<pre>HTTP/1.1 200
Connection: keep-alive
Content-Type: application/json
Date: Thu, 14 Aug 2025 14:09:22 GMT
Keep-Alive: timeout=60
Transfer-Encoding: chunked

{
    "code": 1,
    "data": "https://swot-learn.oss-cn-beijing.aliyuncs.com/2025-08-14-22-09-21uifaces-cartoon-image-8.jpg",
    "msg": "success"
}</pre>
</div>
</div>
<div class="paragraph">
<p>测试图片是否可以访问：仅检查图片信息（不下载）<br>
http --headers HEAD "https://swot-learn.oss-cn-beijing.aliyuncs.com/2025-08-14-22-09-21uifaces-cartoon-image-8.jpg"</p>
</div>
<div class="literalblock">
<div class="content">
<pre>HTTP/1.1 200 OK
Accept-Ranges: bytes
Connection: keep-alive
Content-Disposition: attachment
Content-Length: 67981
Content-MD5: g3/DB4SnghE4ej6NRAnAdQ==
Content-Type: image/jpeg
Date: Thu, 14 Aug 2025 14:12:41 GMT
ETag: "837FC30784A78211387A3E8D4409C075"
Last-Modified: Thu, 14 Aug 2025 14:09:22 GMT
Server: AliyunOSS
x-oss-ec: 0048-00000104
x-oss-force-download: true
x-oss-hash-crc64ecma: 18445195312415737345
x-oss-object-type: Normal
x-oss-request-id: 689DEED90AD0713530AB2907
x-oss-server-time: 18
x-oss-storage-class: Standard</pre>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisecontrolleruploadcontroller_java_2">file &#8594; src/main/java/com/tjise/controller/UploadController.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.controller</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils.AliOSSUtils</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.PostMapping</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RequestParam</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestController</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.IOException</span><span class="tok-p">;</span>


<span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">UploadController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// DI 注入阿里云 OSS AliOSSUtils 的对象</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-n">aliOSSUtils</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/upload&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-nd">@RequestParam</span><span class="tok-p">(</span><span class="tok-s">&quot;image&quot;</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">image</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 把图片直接上传到阿里云 OSS 服务中</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">aliOSSUtils</span><span class="tok-p">.</span><span class="tok-na">upload</span><span class="tok-p">(</span><span class="tok-n">image</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-c1">// 返回 url 地址给前端</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">url</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_9_使用_value_注解从配置文件引入阿里云_oss_参数">16.5.9 使用 @Value 注解从配置文件引入阿里云 OSS 参数</h5>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>在配置文件 application.properties 中增加 4个 aliyun.oss.xxx</p>
</li>
<li>
<p>为了不用在 AliOSSUtils.java 文件中硬编码配置，给 AliOssUtils 中的私有变量加 @Value 注解，以读取 application.properties 中的配置。</p>
</li>
<li>
<p>httpie 测试上传</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>http -f POST <a href="http://localhost:8080/upload" class="bare">http://localhost:8080/upload</a> image@/Users/swot/Downloads/uifaces-cartoon-image-8.jpg</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainresourcesapplication_properties_3">file &#8594; src/main/resources/application.properties</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="properties"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1"># 配置文件行最后不能有空格</span>
<span class="tok-na">spring.application.name</span><span class="tok-o">=</span><span class="tok-s">general-manager</span>

<span class="tok-c1"># --- 数据库 ---</span>
<span class="tok-c1"># 驱动类名称</span>
<span class="tok-na">spring.datasource.driver-class-name</span><span class="tok-o">=</span><span class="tok-s">com.mysql.cj.jdbc.Driver</span>
<span class="tok-c1"># 数据库连接的 url</span>
<span class="tok-na">spring.datasource.url</span><span class="tok-o">=</span><span class="tok-s">jdbc:mysql://localhost:3307/general_manager</span>
<span class="tok-c1"># 连接数据库的用户名</span>
<span class="tok-na">spring.datasource.username</span><span class="tok-o">=</span><span class="tok-s">root</span>
<span class="tok-c1"># 连接数据库的密码</span>
<span class="tok-na">spring.datasource.password</span><span class="tok-o">=</span><span class="tok-s">root</span>

<span class="tok-c1"># --- mybatis ---</span>
<span class="tok-c1"># 指定mybatis输出日志的位置, 输出控制台</span>
<span class="tok-na">mybatis.configuration.log-impl</span><span class="tok-o">=</span><span class="tok-s">org.apache.ibatis.logging.stdout.StdOutImpl</span>
<span class="tok-c1">#开启驼峰命名自动映射，即从经典数据库列名 a_column 映射到经典 Java 属性 名 aColumn。</span>
<span class="tok-na">mybatis.configuration.map-underscore-to-camel-case</span><span class="tok-o">=</span><span class="tok-s">true</span>

<span class="tok-c1"># --- 文件上传大小 ---</span>
<span class="tok-c1">#指定单个文件上传的大小，默认为 1M</span>
<span class="tok-na">spring.servlet.multipart.max-file-size</span><span class="tok-o">=</span><span class="tok-s">10MB</span>
<span class="tok-c1">#指定单次请求上传文件的总大小</span>
<span class="tok-na">spring.servlet.multipart.max-request-size</span><span class="tok-o">=</span><span class="tok-s">100MB</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_新增阿里云_oss_参数">新增阿里云 OSS 参数</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-c1"># 在封装的工具类 AliOSSUtils.java 中，与之对应引用为 @Vaule(&quot;${aliyun.oss.endpoint}&quot;)</span>
<span class="tok-n">aliyun</span><span class="tok-o">.</span><span class="tok-n">oss</span><span class="tok-o">.</span><span class="tok-n">endpoint</span><span class="tok-o">=</span><span class="tok-n">https</span><span class="tok-p">:</span><span class="tok-o">//</span><span class="tok-n">oss</span><span class="tok-o">-</span><span class="tok-n">cn</span><span class="tok-o">-</span><span class="tok-n">beijing</span><span class="tok-o">.</span><span class="tok-n">aliyuncs</span><span class="tok-o">.</span><span class="tok-n">com</span>
<span class="tok-n">aliyun</span><span class="tok-o">.</span><span class="tok-n">oss</span><span class="tok-o">.</span><span class="tok-n">accessKeyId</span><span class="tok-o">=</span><span class="tok-p">[</span><span class="tok-n">REMOVED</span><span class="tok-p">]</span>
<span class="tok-n">aliyun</span><span class="tok-o">.</span><span class="tok-n">oss</span><span class="tok-o">.</span><span class="tok-n">accessKeySecret</span><span class="tok-o">=</span><span class="tok-p">[</span><span class="tok-n">REMOVED</span><span class="tok-p">]</span>
<span class="tok-n">aliyun</span><span class="tok-o">.</span><span class="tok-n">oss</span><span class="tok-o">.</span><span class="tok-n">bucketName</span><span class="tok-o">=</span><span class="tok-n">swot</span><span class="tok-o">-</span><span class="tok-n">learn</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseutilsaliossutils_java_2">file &#8594; src/main/java/com/tjise/utils/AliOSSUtils.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Value</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.format.DateTimeFormatter</span><span class="tok-p">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 阿里云 OSS 工具类</span>
<span class="tok-cm"> */</span>

<span class="tok-c1">// 放入IOC 容器中，不属于 控制层@Controller、业务层@Service、持久层@Repository，所以就用 @Component 吧</span>
<span class="tok-nd">@Component</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-w">    </span><span class="tok-cm">/**</span>
<span class="tok-cm">     * 实现上传图片到OSS</span>
<span class="tok-cm">     */</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 获取上传的文件的输入流</span>
<span class="tok-w">        </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 避免文件覆盖</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">().</span><span class="tok-na">format</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">DateTimeFormatter</span><span class="tok-p">.</span><span class="tok-na">ofPattern</span><span class="tok-p">(</span><span class="tok-s">&quot;yyyy-MM-dd-HH-mm-ss&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getOriginalFilename</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">//上传文件到 OSS（没有使用 region，还是老的方式，建议使用新方式 create，不使用 build）</span>
<span class="tok-w">        </span><span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">().</span><span class="tok-na">build</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">//文件访问路径</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;//&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-c1">// 关闭ossClient</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-p">;</span><span class="tok-c1">// 把上传到oss的路径返回</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_原来下面_4_个参数值是写死的现在使用_value_读取配置">原来下面 4 个参数值是写死的，现在使用 @Value 读取配置</h6>
<div class="paragraph">
<p>@Value("${aliyun.oss.endpoint}")
private String endpoint;</p>
</div>
<div class="paragraph">
<p>@Value("${aliyun.oss.accessKeyId}")
private String accessKeyId;</p>
</div>
<div class="paragraph">
<p>@Value("${aliyun.oss.accessKeySecret}")
private String accessKeySecret;</p>
</div>
<div class="paragraph">
<p>@Value("${aliyun.oss.bucketName}")
private String bucketName;</p>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_10_application_ymlapplication_yaml_配置文件推荐替换_application_properties_配置文件">16.5.10 application.yml/application.yaml 配置文件(推荐替换 application.properties 配置文件)</h5>
<div class="paragraph">
<p>yml 文件语法</p>
</div>
<div class="ulist">
<ul>
<li>
<p>大小写敏感</p>
</li>
<li>
<p>值前边必须有空格，作为分隔符</p>
</li>
<li>
<p>使用缩进表示层级关系，缩进时，不允许使用 Tab 键，只能用空格（idea 中会自动将 Tab 转换为空格）</p>
</li>
<li>
<p>缩进的空格数目不重要，只要相同层级的元素左侧对齐即可</p>
</li>
<li>
<p># 表示注释，从这个字符一直到行尾，都会被解析器忽略</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">对象/Map集合</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="yml"><span></span>user:
   name: zhangsan
   age: 18
   password: 123456</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">数组/List/Set集合</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="yml"><span></span>hobby:
    - java
    - game
    - sport</code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainresourcesapplication_yml">file &#8594; src/main/resources/application.yml</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nt">spring</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">application</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-nt">name</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">mybatis_quickstart-crud</span>
<span class="tok-w">    </span><span class="tok-nt">datasource</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-nt">driver-class-name</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">com.mysql.cj.jdbc.Driver</span>
<span class="tok-w">        </span><span class="tok-nt">url</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">jdbc:mysql://localhost:3307/tjise</span>
<span class="tok-w">        </span><span class="tok-nt">username</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">root</span>
<span class="tok-w">        </span><span class="tok-nt">password</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">root</span>
<span class="tok-w">    </span><span class="tok-nt">servlet</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-nt">multipart</span><span class="tok-p">:</span><span class="tok-w">                  </span><span class="tok-c1"># 上传文件</span>
<span class="tok-w">            </span><span class="tok-nt">max-file-size</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">10MB</span><span class="tok-w">     </span><span class="tok-c1"># 指定单个文件上传的大小</span>
<span class="tok-w">            </span><span class="tok-nt">max-request-size</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">100MB</span><span class="tok-w">  </span><span class="tok-c1"># 指定单次请求上传文件的总大小</span>

<span class="tok-nt">mybatis</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">configuration</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-c1"># 指定mybatis输出日志的位置, 输出控制台</span>
<span class="tok-w">        </span><span class="tok-nt">log-impl</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">org.apache.ibatis.logging.stdout.StdOutImpl</span>
<span class="tok-w">        </span><span class="tok-c1">#开启驼峰命名自动映射，即从经典数据库列名 a_column 映射到经典 Java 属性 名 aColumn</span>
<span class="tok-w">        </span><span class="tok-nt">map-underscore-to-camel-case</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">true</span>

<span class="tok-c1"># --- 阿里云 OSS ---</span>
<span class="tok-c1"># 与之对应引用为 @Vaule(&quot;${aliyun.oss.endpoint}&quot;)</span>
<span class="tok-c1"># noinspection undefined</span>
<span class="tok-nt">aliyun</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">oss</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-nt">endpoint</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;https://oss-cn-beijing.aliyuncs.com&quot;</span>
<span class="tok-w">        </span><span class="tok-nt">accessKeyId</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span>
<span class="tok-w">        </span><span class="tok-nt">accessKeySecret</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;[REMOVED]&quot;</span>
<span class="tok-w">        </span><span class="tok-nt">bucketName</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s">&quot;swot-learn&quot;</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_11_每个属性都写_value_太麻烦了使用_configurationproperties_直接匹配配置文件中的键">16.5.11 每个属性都写 @Value 太麻烦了，使用 @ConfigurationProperties 直接匹配配置文件中的键</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseutilsaliossutils_java_3">file &#8594; src/main/java/com/tjise/utils/AliOSSUtils.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.format.DateTimeFormatter</span><span class="tok-p">;</span>

<span class="tok-c1">// 阿里云 OSS 工具类</span>
<span class="tok-c1">// 放入IOC 容器中，不属于 控制层 @Controller、业务层 @Service、持久层 @Repository，所以就用 @Component 吧</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@ConfigurationProperties</span><span class="tok-p">(</span><span class="tok-n">prefix</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;aliyun.oss&quot;</span><span class="tok-p">)</span>
<span class="tok-nd">@Data</span><span class="tok-w">  </span><span class="tok-c1">// 内部需要使用 setter 来设置属性值，所以要使用 lombok 来自动生成 setter</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-c1">// 实现上传图片到OSS</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 获取上传的文件的输入流</span>
<span class="tok-w">        </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 避免文件覆盖</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">().</span><span class="tok-na">format</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">DateTimeFormatter</span><span class="tok-p">.</span><span class="tok-na">ofPattern</span><span class="tok-p">(</span><span class="tok-s">&quot;yyyy-MM-dd-HH-mm-ss&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getOriginalFilename</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">//上传文件到 OSS</span>
<span class="tok-w">        </span><span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">().</span><span class="tok-na">build</span><span class="tok-p">(</span><span class="tok-n">endpoint</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span><span class="tok-n">bucketName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">//文件访问路径</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;//&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">.</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 关闭 ossClient</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-p">;</span><span class="tok-w">            </span><span class="tok-c1">// 把上传到 oss 的路径返回</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_16_5_12_抽出一个类来解决多个类可能会共用相同属性问题">16.5.12 抽出一个类来解决多个类可能会共用相同属性问题</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseutilsaliossutilsproperties_java">file &#8594; src/main/java/com/tjise/utils/AliOSSUtilsProperties.java</h6>
<div class="paragraph">
<p>假如还有几个别的类也想使用这 4 个属性该怎么办呢？所以最好再新建一个类用来存储这些需要被共用的配置属性。
用 @Component 将类的对象放到控制反转 IOC 容器中。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Component</span>
<span class="tok-nd">@ConfigurationProperties</span><span class="tok-p">(</span><span class="tok-n">prefix</span><span class="tok-o">=</span><span class="tok-s">&quot;aliyun.oss&quot;</span><span class="tok-p">)</span>
<span class="tok-nd">@Data</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOSSUtilsProperties</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 下面属性值的内容会从配置文件中被自动获取到</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">endpoint</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeyId</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">accessKeySecret</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">bucketName</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseutilsaliossutils_java_4">file &#8594; src/main/java/com/tjise/utils/AliOSSUtils.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSS</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.aliyun.oss.OSSClientBuilder</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.context.properties.ConfigurationProperties</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.multipart.MultipartFile</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.format.DateTimeFormatter</span><span class="tok-p">;</span>

<span class="tok-c1">// 阿里云 OSS 工具类</span>
<span class="tok-c1">// 放入IOC 容器中，不属于 控制层 @Controller、业务层 @Service、持久层 @Repository，所以就用 @Component 吧</span>
<span class="tok-c1">// @ConfigurationProperties(prefix = &quot;aliyun.oss&quot;)</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Data</span><span class="tok-w">  </span><span class="tok-c1">// 内部需要使用 setter 来设置属性值，所以要使用 lombok 来自动生成 setter</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AliOSSUtils</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">AliOSSUtilsProperties</span><span class="tok-w"> </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-c1">// 实现上传图片到OSS</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">upload</span><span class="tok-p">(</span><span class="tok-n">MultipartFile</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 获取上传的文件的输入流</span>
<span class="tok-w">        </span><span class="tok-n">InputStream</span><span class="tok-w"> </span><span class="tok-n">inputStream</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getInputStream</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 避免文件覆盖</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">().</span><span class="tok-na">format</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">DateTimeFormatter</span><span class="tok-p">.</span><span class="tok-na">ofPattern</span><span class="tok-p">(</span><span class="tok-s">&quot;yyyy-MM-dd-HH-mm-ss&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">multipartFile</span><span class="tok-p">.</span><span class="tok-na">getOriginalFilename</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">//上传文件到 OSS</span>
<span class="tok-w">        </span><span class="tok-n">OSS</span><span class="tok-w"> </span><span class="tok-n">ossClient</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OSSClientBuilder</span><span class="tok-p">().</span><span class="tok-na">build</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getEndpoint</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getAccessKeyId</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getAccessKeySecret</span><span class="tok-p">()</span>
<span class="tok-w">        </span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">putObject</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getBucketName</span><span class="tok-p">(),</span>
<span class="tok-w">            </span><span class="tok-n">fileName</span><span class="tok-p">,</span>
<span class="tok-w">            </span><span class="tok-n">inputStream</span>
<span class="tok-w">        </span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-c1">//文件访问路径</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getEndpoint</span><span class="tok-p">().</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">0</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;//&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">                     </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getBucketName</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;.&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">                     </span><span class="tok-n">aliOSSUtilsProperties</span><span class="tok-p">.</span><span class="tok-na">getEndpoint</span><span class="tok-p">().</span><span class="tok-na">split</span><span class="tok-p">(</span><span class="tok-s">&quot;//&quot;</span><span class="tok-p">)</span><span class="tok-o">[</span><span class="tok-mi">1</span><span class="tok-o">]</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-s">&quot;/&quot;</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">fileName</span><span class="tok-p">;</span>
<span class="tok-w">        </span><span class="tok-n">ossClient</span><span class="tok-p">.</span><span class="tok-na">shutdown</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 关闭 ossClient</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-p">;</span><span class="tok-w">            </span><span class="tok-c1">// 把上传到 oss 的路径返回</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_6_查询单个员工">16.6 查询单个员工</h4>
<div class="paragraph">
<p>根据 ID 查询基本信息</p>
</div>
<div class="ulist">
<ul>
<li>
<p>请求路径：/emps/{id}</p>
</li>
<li>
<p>请求方式：GET</p>
</li>
<li>
<p>接口描述：该接口用于根据主键ID查询员工的信息</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请求参数格式：路径参数</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">参数说明：</caption>
<colgroup>
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
<col style="width: 25%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门ID</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>请求参数样例：<code>/emps/1</code></p>
</div>
<hr>
<div class="paragraph">
<p>响应数据</p>
</div>
<div class="paragraph">
<p>参数格式：application/json</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">参数说明</caption>
<colgroup>
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 14.2857%;">
<col style="width: 42.8572%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码, 1 成功 , 0 失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">密码</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- entrydate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入职日期</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- gender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">性别 , 1 男 ; 2 女</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">图像</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- deptId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- createTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">创建时间</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">|- updateTime</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">更新时间</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">响应数据样例</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;zhangwuji&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;123456&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;张无忌&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;gender&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;image&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-02-00-27-53B.jpg&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;job&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;entrydate&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2015-01-01&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;deptId&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">2</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;createTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-01T23:06:30&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;updateTime&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-02T00:29:04&quot;</span>
<span class="tok-w">  </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_查询单个员工_empcontroller">查询单个员工 EmpController</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@GetMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-c1">// @PathVariable 获取路径参数</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">getEmpById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">getEmpById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>测试:
http -v :8080/emps/20</p>
</div>
</div>
<div class="sect4">
<h5 id="_查询单个员工_empservice">查询单个员工 EmpService</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">getEmpById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_查询单个员工_empserviceimpl">查询单个员工 EmpServiceImpl</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">getEmpById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">getEmpById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_查询单个员工_empmapper">查询单个员工 EmpMapper</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from emp where id = #{id}&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">getEmpById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_16_7_修改单个员工">16.7 修改单个员工</h4>
<div class="paragraph">
<p>基本信息</p>
</div>
<div class="ulist">
<ul>
<li>
<p>请求路径：/emps</p>
</li>
<li>
<p>请求方式：PUT</p>
</li>
<li>
<p>接口描述：该接口用于修改员工的数据信息</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>请求参数格式：application/json</p>
</div>
<table class="tableblock frame-all grid-all stripes-even stretch">
<caption class="title">参数说明</caption>
<colgroup>
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 20%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">name</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">姓名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">gender</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">性别, 说明: 1 男, 2 女</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">image</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">图像</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">deptId</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">部门id</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">entrydate</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">入职日期</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">job</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">职位, 说明: 1 班主任,2 讲师, 3 学工主管, 4 教研主管, 5 咨询师</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">请求数据样例</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;id&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;image&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;https://web-framework.oss-cn-hangzhou.aliyuncs.com/2022-09-03-07-37-38222.jpg&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;linpingzhi&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;name&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;林平之&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;gender&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;job&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;entrydate&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;2022-09-18&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;deptId&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>响应数据格式：application/json</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">参数说明</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">参数名</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 代表成功，0 代表失败</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">object</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据</p></td>
</tr>
</tbody>
</table>
<div class="paragraph">
<p>响应数据样例：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect4">
<h5 id="_修改单个员工_empcontroller">修改单个员工 EmpController</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@PutMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">updateEmp</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">updateEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_修改单个员工_empservice">修改单个员工 EmpService</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_修改单个员工_empserviceimpl">修改单个员工 EmpServiceImpl</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// emp 封装了要修改的数据</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 在前端提交的表单中没有更新时间，所以需要后台来补充此属性</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">updateEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_修改单个员工_empmapper">修改单个员工 EmpMapper</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 因为要判断值是否为空，所以要用到动态 SQL 了</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_修改单个员工_empmapper_xml">修改单个员工 EmpMapper.xml</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code><span></span>&lt;!-- id 绑定方法名 --&gt;
&lt;update id=&quot;updateEmp&quot;&gt;
    UPDATE emp
    &lt;!-- 自动加 set，自动去除多余的逗号 --&gt;
    &lt;set&gt;
        &lt;!--        Emp 成员变量名         数据库字段名    Emp 成员变量名 --&gt;
        &lt;if test = &quot;username!=null&quot;&gt;     username    = #{username}  , &lt;/if&gt;
        &lt;if test = &quot;name != null&quot;&gt;       name        = #{name}      , &lt;/if&gt;
        &lt;if test = &quot;gender != null&quot;&gt;     gender      = #{gender}    , &lt;/if&gt;
        &lt;if test = &quot;image != null&quot;&gt;      image       = #{image}     , &lt;/if&gt;
        &lt;if test = &quot;job != null&quot;&gt;        job         = #{job}       , &lt;/if&gt;
        &lt;if test = &quot;entrydate != null&quot;&gt;  entrydate   = #{entrydate} , &lt;/if&gt;
        &lt;if test = &quot;deptId != null&quot;&gt;     dept_id     = #{deptId}    , &lt;/if&gt;
        &lt;if test = &quot;updateTime != null&quot;&gt; update_time = #{updateTime}  &lt;/if&gt;
    &lt;/set&gt;
    WHERE id = #{id}
&lt;/update&gt;</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_17_登录校验">17. 登录校验</h3>
<div class="sect3">
<h4 id="_api_登录文档">api 登录文档</h4>
<h5 id="_基本信息" class="discrete">基本信息</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
请求路径
</td>
<td class="hdlist2">
<p><code>/login</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
请求方式
</td>
<td class="hdlist2">
<p><code>POST</code></p>
</td>
</tr>
<tr>
<td class="hdlist1">
接口描述
</td>
<td class="hdlist2">
<p>该接口用于员工登录系统，登录成功后，系统下发 JWT 令牌。</p>
</td>
</tr>
</table>
</div>
<h5 id="_请求参数" class="discrete">请求参数</h5>
<div class="hdlist">
<table>
<tr>
<td class="hdlist1">
参数格式
</td>
<td class="hdlist2">
<p><code>application/json</code></p>
</td>
</tr>
</table>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 1. 参数说明</caption>
<colgroup>
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 16.6666%;">
<col style="width: 50.0002%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">备注</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">username</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">用户名</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">password</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">密码</p></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">请求数据样例</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;username&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;jinyong&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;password&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;123456&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<h5 id="_响应数据" class="discrete">响应数据</h5>
<div class="paragraph">
<p><strong>参数格式</strong>： <code>application/json</code></p>
</div>
<table class="tableblock frame-all grid-all stretch">
<caption class="title">Table 2. 参数说明</caption>
<colgroup>
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 12.5%;">
<col style="width: 37.5%;">
<col style="width: 12.5%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">名称</th>
<th class="tableblock halign-left valign-top">类型</th>
<th class="tableblock halign-left valign-top">是否必须</th>
<th class="tableblock halign-left valign-top">默认值</th>
<th class="tableblock halign-left valign-top">备注</th>
<th class="tableblock halign-left valign-top">其他信息</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">code</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">number</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">响应码，1 成功；0 失败</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">msg</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">非必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">提示信息</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">data</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">string</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须</p></td>
<td class="tableblock halign-left valign-top"></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">返回的数据，JWT 令牌</p></td>
<td class="tableblock halign-left valign-top"></td>
</tr>
</tbody>
</table>
<div class="listingblock">
<div class="title">响应数据样例</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;success&quot;</span><span class="tok-p">,</span>
<span class="tok-w">  </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;eyJhbGciOiJIUzI1NiJ9.eyJuYW1lIjoi6YeR5bq4IiwiaWQiOjEsInVzZXJuYW1lIjoiamlueW9uZyIsImV4cCI6MTY2MjIwNzA0OH0.KkUc_CXJZJ8Dd063eImx4H9Ojfrr6XMJ-yVzaWCVZCo&quot;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<h5 id="_备注说明" class="discrete">备注说明</h5>
<div class="paragraph">
<p>用户登录成功后，系统会自动下发 JWT 令牌，然后在后续的每次请求中，都需要在请求头 header 中携带到服务端，请求头的名称为 <code>token</code>，值为登录时下发的 JWT 令牌。</p>
</div>
<div class="paragraph">
<p>如果检测到用户未登录，则会返回如下固定错误信息：</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="json"><span></span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;code&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;msg&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-s2">&quot;NOT_LOGIN&quot;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-nt">&quot;data&quot;</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-kc">null</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_httpie_测试">httpie 测试</h4>
<div class="dlist">
<dl>
<dt class="hdlist1">成功测试</dt>
<dd>
<p>http -v :8080/login username=limuwan password=123456</p>
</dd>
<dt class="hdlist1">失败测试</dt>
<dd>
<p>http -v :8080/login username=xxxxxx password=123456</p>
</dd>
</dl>
</div>
</div>
<div class="sect3">
<h4 id="_创建后端登录代码">创建后端登录代码</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerlogincontroller_java">file &#8594; src/main/java/com/tjise/controller/LoginController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/login&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 去数据库验证</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span>
<span class="tok-w">               </span><span class="tok-o">?</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;用户名或密码有误&quot;</span><span class="tok-p">)</span>
<span class="tok-w">               </span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceempservice_java_6">file &#8594; src/main/java/com/tjise/service/EmpService.java</h5>
<div class="sect5">
<h6 id="_login_新增">login 新增</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_7">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_员工登录功能_login_新增">员工登录功能 login &#8594; 新增</h6>
<div class="ulist">
<ul>
<li>
<p>@param emp 包含用户输入的用户名和密码的 Emp 对象</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperempmapper_java_7">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h5>
<div class="sect5">
<h6 id="_empmapper">EmpMapper</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Mapper</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">EmpMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-w">    </span><span class="tok-cm">/*</span>
<span class="tok-cm">    @Select(&quot;select count(*) from emp&quot;)</span>
<span class="tok-cm">    Long selectCount();</span>

<span class="tok-cm">    @Select(&quot;select * from emp LIMIT #{offset}, #{pageSize}&quot;)</span>
<span class="tok-cm">    List&lt;Emp&gt; selectPage(int offset, Integer pageSize);</span>
<span class="tok-cm">    */</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_login">login</h6>
<div class="listingblock">
<div class="title">同时查询用户名和密码，返回结果。</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Select</span><span class="tok-p">(</span><span class="tok-s">&quot;select * from emp where username=#{username} and password=#{password}&quot;</span><span class="tok-p">)</span>
<span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_jwt_简介">JWT 简介</h4>
<div class="paragraph">
<p>JSON Web Token（JWT）是一个开放的行业标准（RFC 7519），它定义了一种简洁的、自包含的协议格式，用于在通信双方传递json对象，传递的信息经过数字签名可以被验证和信任。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>官网： <a href="https://jwt.io/" class="bare">https://jwt.io/</a></p>
</li>
<li>
<p>标准： <a href="https://tools.ietf.org/html/rfc7519" class="bare">https://tools.ietf.org/html/rfc7519</a></p>
</li>
</ul>
</div>
<div class="literalblock">
<div class="title">JWT 示例内容</div>
<div class="content">
<pre>eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiYWRtaW4iOnRydWUsImlhdCI6MTUxNjIzOTAyMn0.KMUFsIDTnFmyG3nMiGM6H9FNFUROf3wh7SmqJp-QV30</pre>
</div>
</div>
<div class="paragraph">
<p>各部分解析:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>第一部分：Header(头）， 作用：记录令牌类型、签名算法等。 例如：{"alg":"HS256","type","JWT}</p>
</li>
<li>
<p>第二部分：Payload(有效载荷），作用：携带一些用户信息及过期时间等。 例如：{“id":"1","username":“Tom"}</p>
</li>
<li>
<p>第三部分：Signature(签名），作用：防止Token被篡改、确保安全性。 理解：计算出来的签名，一个字符串。</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="_pom_xml_新增依赖_jwt">pom.xml 新增依赖 JWT</h4>
<div class="paragraph">
<p>参考网址: <a href="https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt-api/0.12.6" class="bare">https://mvnrepository.com/artifact/io.jsonwebtoken/jjwt-api/0.12.6</a></p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">接口层</span><span class="tok-nd">:</span><span class="tok-w"> </span><span class="tok-nt">编译时需要</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">io</span><span class="tok-nc">.jsonwebtoken</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">jjwt-api</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span><span class="tok-nt">0</span><span class="tok-nc">.12.6</span><span class="tok-o">&lt;/</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>

<span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">实现层</span><span class="tok-nd">:</span><span class="tok-w"> </span><span class="tok-nt">运行时必需</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">io</span><span class="tok-nc">.jsonwebtoken</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">jjwt-impl</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span><span class="tok-nt">0</span><span class="tok-nc">.12.6</span><span class="tok-o">&lt;/</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">scope</span><span class="tok-o">&gt;</span><span class="tok-nt">runtime</span><span class="tok-o">&lt;/</span><span class="tok-nt">scope</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>

<span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">JSON</span><span class="tok-w"> </span><span class="tok-nt">序列化支持</span><span class="tok-nd">:</span><span class="tok-w"> </span><span class="tok-nt">运行时必需</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">io</span><span class="tok-nc">.jsonwebtoken</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">jjwt-jackson</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span><span class="tok-nt">0</span><span class="tok-nc">.12.6</span><span class="tok-o">&lt;/</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">scope</span><span class="tok-o">&gt;</span><span class="tok-nt">runtime</span><span class="tok-o">&lt;/</span><span class="tok-nt">scope</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_测试_jwt_的创建与解析">测试 JWT 的创建与解析</h4>
<div class="sect4">
<h5 id="_file_srctestjavacomtjisejwttest_java">file &#8594; src/test/java/com/tjise/JWTTest.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">JWTTest</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_generatejwt_测试创建_jwt">generateJwt() 测试创建 JWT</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">generateJwt</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 1. 准备自定义声明（要加入 jwt 的内容）</span>
<span class="tok-w">    </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">claims</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">HashMap</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-n">claims</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">1</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">claims</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;limuwan&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 2. 生成足够长度的密钥（≥256 bit），推荐盐为 32 字节</span>
<span class="tok-w">    </span><span class="tok-c1">//    32字节的密钥长度正好是256位，符合“≥256 bit”的安全要求</span>
<span class="tok-w">    </span><span class="tok-n">SecretKey</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Keys</span><span class="tok-p">.</span><span class="tok-na">hmacShaKeyFor</span><span class="tok-p">(</span><span class="tok-s">&quot;12345678901234567890123456789012&quot;</span><span class="tok-p">.</span><span class="tok-na">getBytes</span><span class="tok-p">());</span>

<span class="tok-w">    </span><span class="tok-c1">// 3. 构建并签名 JWT（0.12.x 写法）</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">builder</span><span class="tok-p">()</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">signWith</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">SIG</span><span class="tok-p">.</span><span class="tok-na">HS256</span><span class="tok-p">)</span><span class="tok-w">                    </span><span class="tok-c1">// 先密钥，再算法</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">claims</span><span class="tok-p">(</span><span class="tok-n">claims</span><span class="tok-p">)</span><span class="tok-w">                                   </span><span class="tok-c1">// 设置自定义数据</span>
<span class="tok-w">           </span><span class="tok-c1">// .expiration(new Date(System.currentTimeMillis() + 12 * 3600 * 1000)) // 12h 过期</span>
<span class="tok-w">           </span><span class="tok-c1">// .expiration(new Date(System.currentTimeMillis() - 1000)) // 负 1s 马上过期</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">expiration</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Date</span><span class="tok-p">(</span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-mi">60</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">1000</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-c1">// 1min 过期</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">compact</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 生成令牌</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_parsejwt_测试解析_jwt">parseJwt()    测试解析 JWT</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Test</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">parseJwt</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 1. 生成/准备好与签发端一致的密钥</span>
<span class="tok-w">    </span><span class="tok-n">SecretKey</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Keys</span><span class="tok-p">.</span><span class="tok-na">hmacShaKeyFor</span><span class="tok-p">(</span><span class="tok-s">&quot;12345678901234567890123456789012&quot;</span><span class="tok-p">.</span><span class="tok-na">getBytes</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 2. 创建线程安全的 JwtParser</span>
<span class="tok-w">        </span><span class="tok-n">JwtParser</span><span class="tok-w"> </span><span class="tok-n">parser</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">parser</span><span class="tok-p">()</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">verifyWith</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">)</span><span class="tok-w">   </span><span class="tok-c1">// 指定验证密钥</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">build</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-c1">// 3. 解析 generateJwt() 生成的 JWT 并返回载荷</span>
<span class="tok-w">        </span><span class="tok-n">Jws</span><span class="tok-o">&lt;</span><span class="tok-n">Claims</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">jws</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-na">parseSignedClaims</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-s">&quot;eyJhbGciOiJIUzI1NiJ9.eyJpZCI6MSwidXNlcm5hbWUiOiJsaW11d2FuIiwiZXhwIjoxNzU1MzM5OTczfQ.2uL_v-lYN_SpOxNTlQN8LRVrRtWgThsTZ2RaJFx7Dak&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">Claims</span><span class="tok-w"> </span><span class="tok-n">payload</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">jws</span><span class="tok-p">.</span><span class="tok-na">getPayload</span><span class="tok-p">();</span><span class="tok-c1">// 就是以前版本的 getBody() 方法</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-n">payload</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">ExpiredJwtException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">throw</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">RuntimeException</span><span class="tok-p">(</span><span class="tok-s">&quot;Token 已过期&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">MalformedJwtException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">throw</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">RuntimeException</span><span class="tok-p">(</span><span class="tok-s">&quot;Token 格式错误&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">JwtException</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">throw</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">RuntimeException</span><span class="tok-p">(</span><span class="tok-s">&quot;Token 验证失败&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_封装_jwt_类">封装 JWT 类</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseutilsjwtutils_java">file &#8594; src/main/java/com/tjise/utils/JwtUtils.java</h5>
<div class="sect5">
<h6 id="_public_class_jwtutils">public class JwtUtils</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">JwtUtils</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">SecretKey</span><span class="tok-w"> </span><span class="tok-n">key</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Keys</span><span class="tok-p">.</span><span class="tok-na">hmacShaKeyFor</span><span class="tok-p">(</span>
<span class="tok-w">            </span><span class="tok-s">&quot;12345678901234567890123456789012&quot;</span><span class="tok-p">.</span><span class="tok-na">getBytes</span><span class="tok-p">());</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">Long</span><span class="tok-w"> </span><span class="tok-n">expire</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-mi">1000L</span><span class="tok-w"> </span><span class="tok-o">*</span><span class="tok-w"> </span><span class="tok-mi">10</span><span class="tok-p">;</span><span class="tok-w">          </span><span class="tok-c1">// 10s , 测试用</span>
<span class="tok-w">    </span><span class="tok-c1">// public static Long expire = - 1000L           // 负 1s 马上过期</span>
<span class="tok-w">    </span><span class="tok-c1">// public static Long expire = 12 * 3600 * 1000L // 12h 过期</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_generatejwt_生成jwt令牌">generateJwt 生成JWT令牌</h6>
<div class="ulist">
<ul>
<li>
<p>@param claims JWT第二部分负载 payload 中存储的内容</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-nf">generateJwt</span><span class="tok-p">(</span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">claims</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">builder</span><span class="tok-p">()</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">signWith</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">SIG</span><span class="tok-p">.</span><span class="tok-na">HS256</span><span class="tok-p">)</span><span class="tok-w">                    </span><span class="tok-c1">// 先密钥，再算法</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">claims</span><span class="tok-p">(</span><span class="tok-n">claims</span><span class="tok-p">)</span><span class="tok-w">                                   </span><span class="tok-c1">// 设置自定义数据</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">expiration</span><span class="tok-p">(</span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Date</span><span class="tok-p">(</span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-o">+</span><span class="tok-w"> </span><span class="tok-n">expire</span><span class="tok-p">))</span>
<span class="tok-w">            </span><span class="tok-p">.</span><span class="tok-na">compact</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 生成令牌</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_parsejwt_解析jwt令牌">parseJWT 解析JWT令牌</h6>
<div class="ulist">
<ul>
<li>
<p>@param jwt JWT令牌</p>
</li>
<li>
<p>@return JWT第二部分负载 payload 中存储的内容</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-n">Claims</span><span class="tok-w"> </span><span class="tok-nf">parseJWT</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 创建线程安全的 JwtParser</span>
<span class="tok-w">    </span><span class="tok-n">JwtParser</span><span class="tok-w"> </span><span class="tok-n">parser</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Jwts</span><span class="tok-p">.</span><span class="tok-na">parser</span><span class="tok-p">().</span><span class="tok-na">verifyWith</span><span class="tok-p">(</span><span class="tok-n">key</span><span class="tok-p">).</span><span class="tok-na">build</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">parser</span><span class="tok-p">.</span><span class="tok-na">parseSignedClaims</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">).</span><span class="tok-na">getPayload</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-cm">/*</span>
<span class="tok-cm">    // 在实际开发中，这里不用 try catch，由业务来捕获异常。</span>
<span class="tok-cm">    // 因为这里捕获了，业务就看不到异常了，无法给前端提示了。</span>
<span class="tok-cm">    try {</span>
<span class="tok-cm">        // 创建线程安全的 JwtParser</span>
<span class="tok-cm">        JwtParser parser = Jwts.parser().verifyWith(key).build();</span>
<span class="tok-cm">        return parser.parseSignedClaims(jwt).getPayload();</span>
<span class="tok-cm">    } catch (ExpiredJwtException e) {</span>
<span class="tok-cm">        throw new RuntimeException(&quot;Token 已过期&quot;, e);</span>
<span class="tok-cm">    } catch (MalformedJwtException e) {</span>
<span class="tok-cm">        throw new RuntimeException(&quot;Token 格式错误&quot;, e);</span>
<span class="tok-cm">    } catch (JwtException | IllegalArgumentException e) {</span>
<span class="tok-cm">        throw new RuntimeException(&quot;Token 验证失败&quot;, e);</span>
<span class="tok-cm">    }</span>
<span class="tok-cm">    */</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_登录接口调用_jwt_类生成_token_返回给前端">登录接口调用 JWT 类生成 token 返回给前端</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerlogincontroller_java_2">file &#8594; src/main/java/com/tjise/controller/LoginController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/login&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 登录，去数据库验证用户名和密码</span>
<span class="tok-w">        </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// 登录失败返回 NOT_LOGIN 后前端会自动跳转到登录页面</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;NOT_LOGIN&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// 登录成功</span>
<span class="tok-w">            </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">HashMap</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getId</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getUsername</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">());</span>

<span class="tok-w">            </span><span class="tok-c1">// 生成令牌并返回给前端</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">generateJwt</span><span class="tok-p">(</span><span class="tok-n">map</span><span class="tok-p">);</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">使用 httpie 测试登录</dt>
<dd>
<p>http -v post <a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a> username=limuwan password=123456</p>
</dd>
</dl>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_18_统一拦截二选一">18. 统一拦截（二选一）</h3>
<div class="paragraph">
<p>统一拦截可以把对资源的请求拦截下来，从而实现一些特殊的处理。比如：登陆鉴权、统一编码处理、敏感字符处理等。</p>
</div>
<div class="imageblock">
<div class="content">
<img src="img/login_filter.png" alt="login" width="480">
</div>
<div class="title">Figure 4. 统一拦截流程图</div>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
因为要返回 json 给前端，所以需要安装依赖 fastjson2
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="_fastjson2_pom_xml_新增依赖">fastjson2 pom.xml 新增依赖</h4>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-cm">&lt;!-- https://mvnrepository.com/artifact/com.alibaba.fastjson2/fastjson2 --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>com.alibaba.fastjson2<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>fastjson2<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;version&gt;</span>2.0.57<span class="tok-nt">&lt;/version&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_过滤器_filter_介绍一下以后使用_interceptor">过滤器 Filter （介绍一下，以后使用 Interceptor）</h4>
<div class="paragraph">
<p>测试过滤器：（任何时候都可以测试）</p>
</div>
<div class="paragraph">
<p>http -v :8080/emps/20</p>
</div>
<div class="paragraph">
<p>http -v :8080/emps</p>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisefilterlogincheckedfilter_java">file &#8594; src/main/java/com/tjise/filter/LoginCheckedFilter.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-err">&gt;&gt;</span>

<span class="tok-c1">// 过滤器拦截资源</span>
<span class="tok-c1">//@WebFilter(urlPatterns = &quot;/emps/*&quot;)  // 拦截部分 api</span>
<span class="tok-c1">//@WebFilter(urlPatterns = {&quot;/emps/*&quot;, &quot;/users/*&quot;, &quot;/admin/*&quot;})  // 拦截多个路由怎么配置</span>
<span class="tok-nd">@WebFilter</span><span class="tok-p">(</span><span class="tok-n">urlPatterns</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-s">&quot;/*&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginCheckedFilter</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">Filter</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>拦截所有资源
<div class="paragraph">
<p>为了让 @WebFilter 生效，还需要在启动类增加 @ServletComponentScan，参后面代码。</p>
</div></td>
</tr>
</table>
</div>
<div class="sect5">
<h6 id="_import_3">&lt;&lt; import &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.filter</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.alibaba.fastjson2.JSONObject</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils.JwtUtils</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">javax.servlet.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">javax.servlet.annotation.WebFilter</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">javax.servlet.http.HttpServletRequest</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">javax.servlet.http.HttpServletResponse</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.io.IOException</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_public_void_dofilter">public void doFilter</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 过滤器，只要资源访问，就会执行该方法</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">doFilter</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-n">ServletRequest</span><span class="tok-w"> </span><span class="tok-n">servletRequest</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">ServletResponse</span><span class="tok-w"> </span><span class="tok-n">servletResponse</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">FilterChain</span><span class="tok-w"> </span><span class="tok-n">filterChain</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">ServletException</span>
<span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter LoginCheckedFilter.doFilter&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 将 Servlet 请求对象转换为 HTTP Servlet 请求对象，否则没有相应的调用方法</span>
<span class="tok-w">    </span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">HttpServletRequest</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">servletRequest</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">HttpServletResponse</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">servletResponse</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-c1">// 1. 获取请求路由</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getRequestURL</span><span class="tok-p">().</span><span class="tok-na">toString</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 2. 判断请求的路由是否包含 login</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">url</span><span class="tok-p">.</span><span class="tok-na">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 放行去访问 login api</span>
<span class="tok-w">        </span><span class="tok-n">filterChain</span><span class="tok-p">.</span><span class="tok-na">doFilter</span><span class="tok-p">(</span><span class="tok-n">servletRequest</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">servletResponse</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 3. 获取请求头中的令牌 token</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;token&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 返回登录页面</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 4. 解析令牌</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">parseJWT</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 这就是不能在 JwtUtils.parseJWT 中 catch 的原因</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 5. 令牌验证成功，放行去访问相应的 api</span>
<span class="tok-w">     </span><span class="tok-n">filterChain</span><span class="tok-p">.</span><span class="tok-na">doFilter</span><span class="tok-p">(</span><span class="tok-n">servletRequest</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">servletResponse</span><span class="tok-p">);</span>

<span class="tok-w">     </span><span class="tok-c1">// 6. api 执行完成后，还可以继续执行这里的代码</span>
<span class="tok-w">     </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;过滤器最后执行的代码&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_private_void_senderrorresponse">private void sendErrorResponse</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 抽取的自定义方法</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-n">notLogin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;NOT_LOGIN&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// return notLogin;  // 行不通，因为 doFilter 返回值只能是 void</span>
<span class="tok-w">    </span><span class="tok-c1">// 所以可以使用 response.getWriter().write() 给前端返回约定好的 json 格式的数据</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jsonString</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JSONObject</span><span class="tok-p">.</span><span class="tok-na">toJSONString</span><span class="tok-p">(</span><span class="tok-n">notLogin</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);  // 这个不要设置，会返回401，前端案例没处理</span>
<span class="tok-w">    </span><span class="tok-n">response</span><span class="tok-p">.</span><span class="tok-na">setContentType</span><span class="tok-p">(</span><span class="tok-s">&quot;application/json;charset=UTF-8&quot;</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// 防止乱码</span>
<span class="tok-w">    </span><span class="tok-n">response</span><span class="tok-p">.</span><span class="tok-na">getWriter</span><span class="tok-p">().</span><span class="tok-na">write</span><span class="tok-p">(</span><span class="tok-n">jsonString</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 对于不复杂场景，直接返回固定的 JSON 字符串更简单</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setContentType(&quot;application/json;charset=UTF-8&quot;);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.getWriter().write(&quot;{\&quot;code\&quot;: 401, \&quot;message\&quot;: \&quot;NOT_LOGIN\&quot;}&quot;)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisegeneralmanagerapplication_java">file &#8594; src/main/java/com/tjise/GeneralManagerApplication.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.SpringApplication</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.web.servlet.ServletComponentScan</span><span class="tok-p">;</span>

<span class="tok-nd">@ServletComponentScan</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@SpringBootApplication</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">GeneralManagerApplication</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">	</span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">		</span><span class="tok-n">SpringApplication</span><span class="tok-p">.</span><span class="tok-na">run</span><span class="tok-p">(</span><span class="tok-n">GeneralManagerApplication</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">);</span>
<span class="tok-w">	</span><span class="tok-p">}</span>

<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>新增：在引导类上只用 @ServletComponentScan 开启 Servlet 组件支持。其实就是让 WebFilter 生效</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_拦截器_interceptorspringboot_使用">拦截器 Interceptor（SpringBoot 使用）</h4>
<div class="paragraph">
<p>拦截器 Interceptor 是一种动态拦截方法调用的机制，类似于过滤器。在 Spring 中动态拦截控制器中方法的执行。</p>
</div>
<div class="paragraph">
<p>未登录测试拦截器</p>
</div>
<div class="ulist">
<ul>
<li>
<p>http -v :8080/emps/20</p>
</li>
<li>
<p>http -v :8080/emps</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>登录测试拦截器</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>命令行先保存 TOKEN</p>
<div class="paragraph">
<p>TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r '.data')</p>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
jq -r '.data': 从返回的 JSON 响应中提取 data 字段并以原始格式输出
</td>
</tr>
</table>
</div>
</li>
<li>
<p>再使用该 TOKEN 登录</p>
<div class="paragraph">
<p>http :8080/emps/20 "token: $TOKEN"</p>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>最后可以再用浏览器测试一下。</p>
</div>
<div class="sect4">
<h5 id="_如果_filter_打开了关闭_filter参里面具体更改">如果 Filter 打开了，关闭 Filter，参里面具体更改</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjisegeneralmanagerapplication_java_2">file &#8594; src/main/java/com/tjise/GeneralManagerApplication.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.SpringApplication</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.autoconfigure.SpringBootApplication</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.boot.web.servlet.ServletComponentScan</span><span class="tok-p">;</span>

<span class="tok-c1">// @ServletComponentScan  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@SpringBootApplication</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">GeneralManagerApplication</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">	</span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">static</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">main</span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-o">[]</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">		</span><span class="tok-n">SpringApplication</span><span class="tok-p">.</span><span class="tok-na">run</span><span class="tok-p">(</span><span class="tok-n">GeneralManagerApplication</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">);</span>
<span class="tok-w">	</span><span class="tok-p">}</span>

<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>在引导类上只用 @ServletComponentScan 开启 Servlet 组件支持。其实就是让 WebFilter 生效
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
我们要使用 Interceptor 了，不使用 Filter，则需注释此行即可。
</td>
</tr>
</table>
</div></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_定义拦截器">定义拦截器</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseinterceptorlogincheckedinterceptor_java">file &#8594; src/main/java/com/tjise/interceptor/LoginCheckedInterceptor.java</h6>

</div>
<div class="sect5">
<h6 id="_class_logincheckedinterceptor_前端请求_token_检查拦截器">class LoginCheckedInterceptor 前端请求 token 检查拦截器</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Component</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginCheckedInterceptor</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">HandlerInterceptor</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>实现接口 HandlerInterceptor</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_prehandle_目标_api_执行前执行_return_true_放行return_false_拦截">preHandle 目标 api 执行前执行: return true 放行，return false 拦截</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">boolean</span><span class="tok-w"> </span><span class="tok-nf">preHandle</span><span class="tok-p">(</span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">,</span>
<span class="tok-w">                         </span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-p">,</span>
<span class="tok-w">                         </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">handler</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter preHandle()&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 1. 获取请求路由</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getRequestURL</span><span class="tok-p">().</span><span class="tok-na">toString</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 2. 判断请求的路由是否包含 login</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">url</span><span class="tok-p">.</span><span class="tok-na">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 放行去访问 login api</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 3. 获取请求头中的令牌 token</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;token&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 返回登录页面</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 4. 解析令牌</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">parseJWT</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w">   </span><span class="tok-c1">// 放行去执行 api</span>
<span class="tok-w">    </span><span class="tok-c1">// return false;  // 拦截直接给客户端响应 200 结束</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_senderrorresponse_自定义发送错误响应方法">sendErrorResponse() 自定义发送错误响应方法</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 抽取的私有方法</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">IOException</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-n">notLogin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;NOT_LOGIN&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// return notLogin;  // 行不通，因为 preHandle 返回值只能是 boolean</span>
<span class="tok-w">    </span><span class="tok-c1">// 所以可以使用 response.getWriter().write() 给前端返回约定好的 json 格式的数据</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jsonString</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JSONObject</span><span class="tok-p">.</span><span class="tok-na">toJSONString</span><span class="tok-p">(</span><span class="tok-n">notLogin</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);  // 这个不要设置，会返回401，前端案例没处理</span>
<span class="tok-w">    </span><span class="tok-n">response</span><span class="tok-p">.</span><span class="tok-na">setContentType</span><span class="tok-p">(</span><span class="tok-s">&quot;application/json;charset=UTF-8&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 防止中文乱码</span>
<span class="tok-w">    </span><span class="tok-n">response</span><span class="tok-p">.</span><span class="tok-na">getWriter</span><span class="tok-p">().</span><span class="tok-na">write</span><span class="tok-p">(</span><span class="tok-n">jsonString</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 对于不复杂场景，直接返回固定的 JSON 字符串更简单</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setStatus(HttpServletResponse.SC_UNAUTHORIZED);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.setContentType(&quot;application/json;charset=UTF-8&quot;);</span>
<span class="tok-w">    </span><span class="tok-c1">// response.getWriter().write(&quot;{\&quot;code\&quot;: 401, \&quot;message\&quot;: \&quot;NOT_LOGIN\&quot;}&quot;)</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_注册拦截器">注册拦截器</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseinterceptorlogincheckedinterceptorconfig_java">file &#8594; src/main/java/com/tjise/interceptor/LoginCheckedInterceptorConfig.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.interceptor</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.context.annotation.Configuration</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.servlet.config.annotation.InterceptorRegistry</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.servlet.config.annotation.WebMvcConfigurer</span><span class="tok-p">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 登录检查拦截器配置类</span>
<span class="tok-cm"> * 用于配置 Spring MVC 的拦截器，实现对请求的统一拦截处理</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginCheckedInterceptorConfig</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">WebMvcConfigurer</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 自动注入登录检查拦截器实例</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LoginCheckedInterceptor</span><span class="tok-w"> </span><span class="tok-n">loginCheckedInterceptor</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-cm">/**</span>
<span class="tok-cm">     * 注册拦截器方法</span>
<span class="tok-cm">     * 实现WebMvcConfigurer接口的addInterceptors方法，用于添加自定义拦截器</span>
<span class="tok-cm">     * @param registry 拦截器注册器</span>
<span class="tok-cm">     */</span>
<span class="tok-w">    </span><span class="tok-nd">@Override</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">addInterceptors</span><span class="tok-p">(</span><span class="tok-n">InterceptorRegistry</span><span class="tok-w"> </span><span class="tok-n">registry</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">registry</span><span class="tok-p">.</span><span class="tok-na">addInterceptor</span><span class="tok-p">(</span><span class="tok-n">loginCheckedInterceptor</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-c1">// 添加拦截路径模式，/** 表示拦截所有请求</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">addPathPatterns</span><span class="tok-p">(</span><span class="tok-s">&quot;/**&quot;</span><span class="tok-p">);</span>
<span class="tok-w">                </span><span class="tok-c1">// 放开登录方法(代码中判断了，所以此处注释了)</span>
<span class="tok-w">                </span><span class="tok-c1">//.excludePathPatterns(&quot;/login&quot;);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>实际应用：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>用于实现用户登录状态检查，在用户未登录时跳转到登录页面</p>
</li>
<li>
<p>可以保护系统资源不被未授权用户访问</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_拦截器加允许_cors">拦截器加允许 CORS</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseinterceptorlogincheckedinterceptor_java_2">file &#8594; src/main/java/com/tjise/interceptor/LoginCheckedInterceptor.java</h6>

</div>
<div class="sect5">
<h6 id="_override_prehandle">override preHandle</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// 目标 api 执行前执行: return true 放行，return false 拦截</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">boolean</span><span class="tok-w"> </span><span class="tok-nf">preHandle</span><span class="tok-p">(</span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">handler</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter preHandle()&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 增加处理 CORS 预检请求，这个要加，不加会报错的</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-s">&quot;OPTIONS&quot;</span><span class="tok-p">.</span><span class="tok-na">equalsIgnoreCase</span><span class="tok-p">(</span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getMethod</span><span class="tok-p">()))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Handling OPTIONS request&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">response</span><span class="tok-p">.</span><span class="tok-na">setStatus</span><span class="tok-p">(</span><span class="tok-n">HttpServletResponse</span><span class="tok-p">.</span><span class="tok-na">SC_OK</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 其他拦截逻辑</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseinterceptorlogincheckedinterceptorconfig_java_2">file &#8594; src/main/java/com/tjise/interceptor/LoginCheckedInterceptorConfig.java</h6>

</div>
<div class="sect5">
<h6 id="_class_logincheckedinterceptorconfig">class LoginCheckedInterceptorConfig</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-cm">/**</span>
<span class="tok-cm"> * 注册拦截器</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@Configuration</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginCheckedInterceptorConfig</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">WebMvcConfigurer</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 其他代码</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>

<span class="tok-w">    </span><span class="tok-c1">// 增加允许 CORS</span>
<span class="tok-w">    </span><span class="tok-nd">@Override</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">addCorsMappings</span><span class="tok-p">(</span><span class="tok-n">CorsRegistry</span><span class="tok-w"> </span><span class="tok-n">registry</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter addCorsMappings()&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-n">registry</span><span class="tok-p">.</span><span class="tok-na">addMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/**&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 允许所有路由</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">allowedOriginPatterns</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">allowedMethods</span><span class="tok-p">(</span><span class="tok-s">&quot;GET&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;POST&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;PUT&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;DELETE&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;OPTIONS&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;HEAD&quot;</span><span class="tok-p">)</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">allowedHeaders</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">)</span><span class="tok-w">        </span><span class="tok-c1">// 允许所有头</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">allowCredentials</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">)</span><span class="tok-w">     </span><span class="tok-c1">// 允许携带 cookie</span>
<span class="tok-w">                </span><span class="tok-p">.</span><span class="tok-na">exposedHeaders</span><span class="tok-p">(</span><span class="tok-s">&quot;*&quot;</span><span class="tok-p">);</span><span class="tok-w">       </span><span class="tok-c1">// 暴露所有头</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_同时存在_filter_interceptor_的执行顺序">同时存在 Filter &amp; interceptor 的执行顺序</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>里面的虚线框是 Spring Boot</p>
</li>
<li>
<p>doFilter 走两次分别是放行前和放行后</p>
</li>
</ol>
</div>
<div class="imageblock">
<div class="content">
<img src="img/filterAndInterceptor.png" alt="filterAndInterceptor" width="900">
</div>
<div class="title">Figure 5. 共存流程</div>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Filter vs Interceptor</div>
<div class="ulist">
<ul>
<li>
<p>接口规范不同：过滤器需要实现 Filter 接口，而拦截器需要实现 HandlerInterceptor 接口。</p>
</li>
<li>
<p>拦截范围不同：过滤器 Filter 会拦截所有的资源，而 Interceptor 只会拦截 Spring 环境中的资源。</p>
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_19_异常处理">19. 异常处理</h3>
<div class="paragraph">
<p>目前代码中的异常都是向上抛出的，，如 mapper &#8594; service &#8594; controller，最后到了前端。
但是前端只认识固定的 Result 格式。所以我们要对异常进行处理。</p>
</div>
<div class="paragraph">
<p>引入有异常的问题：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>启动后端项目</p>
<div class="ulist">
<ul>
<li>
<p>选中 src/main/java/com/tjise/GeneralManagerApplication.java</p>
</li>
<li>
<p>点击鼠标右键 &#8594; Run 'GeneralManager&#8230;&#8203;.Main()'</p>
</li>
</ul>
</div>
</li>
<li>
<p>启动前端项目： pnpm run dev</p>
<div class="ulist">
<ul>
<li>
<p>node.js 使用的是 16 版本：<code>nvm use v16</code></p>
</li>
<li>
<p>确认指定版本成功：Now using node v16.20.2 (npm v8.19.4)</p>
</li>
<li>
<p>访问 <a href="http://localhost:9528" class="bare">http://localhost:9528</a></p>
</li>
</ul>
</div>
</li>
<li>
<p>测试异常</p>
<div class="ulist">
<ul>
<li>
<p>点击「部门管理」&#8594; 「新增部门」&#8594; 学工部 （已经存在的部门，应该有提醒反馈，实际上没有）</p>
</li>
<li>
<p>前端开发者调试模式会显示 <a href="http://localhost:9528/api/depts" class="bare">http://localhost:9528/api/depts</a> 500 服务器错</p>
</li>
<li>
<p>后端会显示 <code>Cause: java.sql.SQLIntegrityConstraintViolationException: Duplicate entry '学工部' for key 'dept.name'</code></p>
</li>
<li>
<p>原因是数据库中已经有了 name 为「学工部」的记录，且该 name 字段为 UNIQUE，即不允许有重复字段。</p>
</li>
<li>
<p>前端没有提醒反馈的原因，是前端只认识 Result 格式的消息。不认识 500 错误。</p>
</li>
</ul>
</div>
</li>
<li>
<p>处理异常的方式如下</p>
</li>
</ol>
</div>
<div class="sect3">
<h4 id="_方案一在_controller_方法中进行_trycatch_处理">方案一：在 Controller 方法中进行 try…catch 处理</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
项目中的每个 controller 都需要改代码，太麻烦了。
</td>
</tr>
</table>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_10">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_新增单个部门_insertdept_新增_try_catch">新增单个部门 insertDept &#8594; 新增 try catch</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@PostMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 打印异常信息</span>
<span class="tok-w">        </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">printStackTrace</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;部门已存在&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>使用 try catch 捕获异常后，返回 Result 数据，前端认识此格式。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>在浏览器中再进行测试新增部门「学工部」，前端会给出友好的提示「部门已存在」。</p>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_方案二全局异常处理器">方案二：全局异常处理器</h4>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>新增单个部门 insertDept &#8594; 移除 try catch 恢复原来代码</p>
</li>
<li>
<p>定义全局异常处理器，参下面代码。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_11">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_新增单个部门_insertdept_移除_try_catch_恢复原来代码">新增单个部门 insertDept &#8594; 移除 try catch 恢复原来代码</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@PostMapping</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseexceptionglobalexceptionhandler_java">file &#8594; src/main/java/com/tjise/exception/GlobalExceptionHandler.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.exception</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Result</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.ExceptionHandler</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.web.bind.annotation.RestControllerAdvice</span><span class="tok-p">;</span>

<span class="tok-cm">/**</span>
<span class="tok-cm"> * 全局异常处理器</span>
<span class="tok-cm"> */</span>
<span class="tok-nd">@RestControllerAdvice</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">GlobalExceptionHandler</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// @ExceptionHandler(value = {Exception.class})</span>
<span class="tok-w">    </span><span class="tok-nd">@ExceptionHandler</span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 简写形式，此方法可以捕获所有异常</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">handleException</span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 会把拦截的异常传递给此方法的参数 e</span>
<span class="tok-w">    </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">printStackTrace</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-c1">//return Result.error(e.getMessage());  // 如有需要可以自定义错误信息，本例子省略。</span>
<span class="tok-w">        </span><span class="tok-c1">// 上面信息太多字符了，用户看不懂，所以只返回一个通用的错误信息</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;处理异常，请稍后重试...&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Exception 异常分类</p>
</div>
<div class="ulist">
<ul>
<li>
<p>运行时异常 : RuntimeException , 编译时无需处理</p>
</li>
<li>
<p>编译时异常 : 非 RuntimeException , 编译时处理</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_20_事务管理">20. 事务管理</h3>
<div class="paragraph">
<p>事务是一组操作的集合，它是一个不可分割的工作单位，事务会把所有的操作作为一个整体一起向系统提交或撤销操作请求，即这些操作 要么同时成功，要么同时失败。</p>
</div>
<div class="paragraph">
<p>理解使用事务的条件：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>开启事务（一组操作开始前，开启事务）：<code>start transaction</code> / <code>begin</code>;</p>
</li>
<li>
<p>提交事务（这组操作全部成功后，提交事务）：<code>commit</code>;</p>
</li>
<li>
<p>回滚事务（中间任何一个操作出现异常，回滚事务）：<code>rollback</code>;</p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="ulist">
<ul>
<li>
<p>普通的 insert，update，delete 会默认执行 commit。</p>
</li>
<li>
<p><strong>Spring Boot 中使用 @Transactional 注解则会自动管理事务。</strong></p>
</li>
</ul>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>需要事务的案例：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>删除一个部门</p>
</li>
<li>
<p>同时删除该部门下的员工</p>
</li>
</ol>
</div>
<hr>
<div class="paragraph">
<p>开启事务日志：修改配置文件 <code>src/main/resources/application.yml</code> 增加事务日志功能</p>
</div>
<div class="literalblock">
<div class="title">后端事务日志显示</div>
<div class="content">
<pre>2025-08-24 11:17:49.601 DEBUG 92701 --- [nio-8080-exec-2] o.s.jdbc.support.JdbcTransactionManager  : Creating new transaction with name [com.tjise.service.impl.DeptServiceImpl.deleteDeptById]: PROPAGATION_REQUIRED,ISOLATION_DEFAULT

2025-08-24 11:17:49.621 DEBUG 92701 --- [nio-8080-exec-2] o.s.jdbc.support.JdbcTransactionManager  : Initiating transaction rollback</pre>
</div>
</div>
<div class="sect3">
<h4 id="_transactional">@Transactional</h4>
<div class="sect4">
<h5 id="_file_srcmainresourcesapplication_yml_2">file &#8594; src/main/resources/application.yml</h5>
<div class="sect5">
<h6 id="_开启事务日志_logging">开启事务日志 logging</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="yaml"><span></span><span class="tok-nt">logging</span><span class="tok-p">:</span>
<span class="tok-w">    </span><span class="tok-nt">level</span><span class="tok-p">:</span>
<span class="tok-w">        </span><span class="tok-c1"># noinspection undefined</span>
<span class="tok-w">        </span><span class="tok-nt">org.springframework.jdbc.support.JdbcTransactionManager</span><span class="tok-p">:</span><span class="tok-w"> </span><span class="tok-l tok-l-Scalar tok-l-Scalar-Plain">debug</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_8">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deptserviceimpl_新增_di_empservice">DeptServiceImpl &#8594; 新增 DI empService</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Service</span><span class="tok-w">  </span><span class="tok-c1">// 把该类的对象交给 IOC 容器管理</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">DeptServiceImpl</span><span class="tok-w"> </span><span class="tok-kd">implements</span><span class="tok-w"> </span><span class="tok-n">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// DI 注入 DeptMapper 实现类对象给变量 deptMapper</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">DeptMapper</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 新增</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门及其员工">deleteDeptById 删除单个部门及其员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Transactional</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 删除部门</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-o">/</span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-c1">// 把此部门的员工删除</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>如果有此运行时异常，则部门可以被删除，但是该部门员工无法被删除。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>增加此注解即可实现事务管理，解决 &lt;1&gt; 的问题。遇见异常可以回滚了。
<div class="ulist">
<ul>
<li>
<p>注解：@Transactional</p>
</li>
<li>
<p>位置：可放在业务（service）层的方法上、类上、接口上。<mark>实际开发中经常加在方法上。</mark></p>
</li>
<li>
<p>作用：将当前方法交给 spring 进行事务管理，方法执行前，开启事务；成功执行完毕，提交事务；出现异常，回滚事务。</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceempservice_java_7">file &#8594; src/main/java/com/tjise/service/EmpService.java</h5>
<div class="sect5">
<h6 id="_deleteempbydeptid_根据部门id删除员工_新增">deleteEmpByDeptId 根据部门id删除员工 &#8594; 新增</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_8">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deleteempbydeptid_根据部门id删除员工_新增_2">deleteEmpByDeptId 根据部门id删除员工 &#8594; 新增</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">deptId</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperempmapper_java_8">file &#8594; src/main/java/com/tjise/mapper/EmpMapper.java</h5>
<div class="sect5">
<h6 id="_deleteempbydeptid_根据部门id删除员工_新增_3">deleteEmpByDeptId 根据部门id删除员工 &#8594; 新增</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Delete</span><span class="tok-p">(</span><span class="tok-s">&quot;delete from emp where dept_id=#{deptId}&quot;</span><span class="tok-p">)</span>
<span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transactionalrollbackfor">@Transactional(rollbackFor)</h4>
<div class="paragraph">
<p>rollbackFor：控制出现何种异常类型，回滚事务。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>默认情况下，只有出现 RuntimeException 才回滚异常。</p>
</li>
<li>
<p>如果出现编译时异常，则不回滚。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_9">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门及其员工_2">deleteDeptById 删除单个部门及其员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// @Transactional  // 不会捕获编译时异常，所以不会回滚</span>
<span class="tok-nd">@Transactional</span><span class="tok-p">(</span><span class="tok-n">rollbackFor</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-w">    </span><span class="tok-c1">// 删除部门</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-p">(</span><span class="tok-kc">true</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// java 虚拟机不会检查 if 内的代码，所以可编译通过</span>
<span class="tok-w">        </span><span class="tok-k">throw</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">(</span><span class="tok-s">&quot;演示用异常&quot;</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 编译时异常例子  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 把此部门的员工删除</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>@Transactional 不会感知到编译时异常。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>增加此注解即可实现事务管理，解决 &lt;1&gt; 编译时异常不能回滚的问题。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>方法中声明一下 throws Exception，否则编译无法通过。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseservicedeptservice_java_8">file &#8594; src/main/java/com/tjise/service/DeptService.java</h5>
<div class="sect5">
<h6 id="_deptservice">DeptService</h6>
<div class="listingblock">
<div class="title">src/main/java/com/tjise/service/DeptService.java</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.service</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.Dept</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.List</span><span class="tok-p">;</span>

<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">DeptService</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">;</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">abstract</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>对应于 src/main/java/com/tjise/service/impl/DeptServiceImpl.java，方法中也要声明一下 throws Exception，否则编译无法通过。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerdeptcontroller_java_12">file &#8594; src/main/java/com/tjise/controller/DeptController.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门">deleteDeptById 删除单个部门</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@DeleteMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/{id}&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 路径参数</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-nd">@PathVariable</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-c1">// 调用 service 层去删除数据库记录</span>
<span class="tok-w">    </span><span class="tok-n">deptService</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">();</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>对应于 src/main/java/com/tjise/service/DeptService.java，方法中也要声明一下 throws Exception，否则编译无法通过。</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_transactionalpropagation">@Transactional(propagation)</h4>
<div class="paragraph">
<p><strong>propagation</strong>：事务传播行为，指的就是当一个事务方法被另一个事务方法调用时，这个事务方法应该如何进行事务控制。</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 20%;">
<col style="width: 40%;">
<col style="width: 40%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">属性值</th>
<th class="tableblock halign-left valign-top">含义</th>
<th class="tableblock halign-left valign-top">说明</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REQUIRED</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>【默认值】需要事务，有则加入，无则创建新事务</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>常用属性</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>REQUIRES_NEW</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>需要新事务，无论有无，总是创建新事务</strong></p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock"><strong>常用属性</strong></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SUPPORTS</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">支持事务，有则加入，无则在独立的连接中运行 SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">结合 Hibernate、JPA 时有用，配在查询方法上</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NOT_SUPPORTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">不支持事务，不加入，在独立的连接中运行 SQL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">MANDATORY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须有事务，否则抛异常</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NEVER</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">必须没事务，否则抛异常</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">-</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NESTED</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">嵌套事务</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">仅对 DataSourceTransactionManager 有效</p></td>
</tr>
</tbody>
</table>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
前两个属性常用
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>应用场景：</p>
</div>
<div class="ulist">
<ul>
<li>
<p>REQUIRED：大部分情况下都是用该传播行为即可。</p>
</li>
<li>
<p>REQUIRES_NEW：当我们不希望事务之间相互影响时可以使用该传播行为。比如：下订单前需要记录日志，不论订单保存成功与否，都需要保证日志记录能够记录成功。</p>
</li>
</ul>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_10">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门及其员工_3">deleteDeptById 删除单个部门及其员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Transactional</span><span class="tok-p">(</span><span class="tok-n">rollbackFor</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">)</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">     </span><span class="tok-c1">// 删除部门</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 把此部门的员工删除  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w">         </span><span class="tok-c1">// 运行时异常  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>当产生该运行时异常时，看 &lt;2&gt; 的回滚情况。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>deleteEmpByDeptId(id) 方法的注解 @Transactional(propagation) 取值不同，会影响 deleteEmpByDeptId(id) 是否回滚。
<div class="ulist">
<ul>
<li>
<p>@Transactional(propagation = Propagation.REQUIRED) 会回滚</p>
</li>
<li>
<p>@Transactional(propagation = Propagation.REQUIRES_NEW) 不会回滚</p>
</li>
<li>
<p>deleteEmpByDeptId(id) 不加 @Transactional 也会回滚，因为 deleteEmpByDeptId(id) 已经被 deleteDeptById() 的事务包含了。</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_9">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_deleteempbydeptid_根据部门id删除员工_required_vs_requires_new">deleteEmpByDeptId 根据部门id删除员工 &#8594; REQUIRED vs REQUIRES_NEW</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 此例子中不加 @Transactional 也会回滚，因为 deleteEmpByDeptId(id) 已经被 deleteDeptById() 的事务包含了。</span>

<span class="tok-c1">// @Transactional  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@Transactional</span><span class="tok-p">(</span><span class="tok-n">propagation</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Propagation</span><span class="tok-p">.</span><span class="tok-na">REQUIRED</span><span class="tok-p">)</span><span class="tok-w">  </span><span class="tok-c1">// 这是默认值，同上  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-c1">// @Transactional(propagation = Propagation.REQUIRES_NEW)  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">deptId</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="paragraph">
<p>删除员工也增加 @Transactional 进行事务管理。</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>【默认值】有事务则加入，无则创建新事务。
<div class="ulist">
<ul>
<li>
<p>与调用该方法的 deleteDeptById() 是同一个事务，当 deleteDeptById() 中有异常时该方法<mark>会回滚</mark>。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>无论有无，总是创建新事务。
<div class="ulist">
<ul>
<li>
<p>与调用该方法的 deleteDeptById() 不是同一个事务了，当 deleteDeptById() 中有异常时该方法<mark>不会回滚</mark>。</p>
</li>
</ul>
</div></td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
可以对比 Spring Boot 日志进行核实。
</td>
</tr>
</table>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
<div class="paragraph">
<p>在这里只是演示 propagation 取值的用法。</p>
</div>
<div class="paragraph">
<p>本例中该方法正确的逻辑应该是不写 @Transactional 或者使用 @Transactional(propagation = Propagation.REQUIRED)。因为删除部门不成功，应该回滚删除员工的操作。</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_21_面向切面_aop">21. 面向切面 AOP</h3>
<div class="sect3">
<h4 id="_引子_记录业务层方法的执行耗时并输出到控制台">引子 &#8594; 记录业务层方法的执行耗时，并输出到控制台</h4>
<div class="paragraph">
<p>拿出两个方法举例能说明问题即可。
从下面的代码更改中，可以发现每个方法中都存在重复的代码 &lt;1&gt; &lt;2&gt; &lt;3&gt;。
所以引出 AOP 的应用。</p>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_11">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_查询部门列表_计算执行耗时">查询部门列表 &#8594; 计算执行耗时</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-n">log</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;方法执行耗时: {} ms&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">end</span><span class="tok-o">-</span><span class="tok-n">begin</span><span class="tok-p">));</span><span class="tok-w">  </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>开始时间</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>结束时间</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>计算耗时</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
@Slf4j 来自于于 lombok 依赖，包含了记录日志的方法 log。
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_获取单个部门_计算执行耗时">获取单个部门 &#8594; 计算执行耗时</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">getDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-n">log</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;方法执行耗时: {} ms&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">end</span><span class="tok-o">-</span><span class="tok-n">begin</span><span class="tok-p">));</span><span class="tok-w">  </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>开始时间</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>结束时间</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>计算耗时</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_面向切面_aop_基础">面向切面 AOP 基础</h4>
<div class="paragraph">
<p>AOP：Aspect Oriented Programming（面向切面编程），它的核心思想是将重复的逻辑剥离出来，<mark>在不修改原始逻辑的基础上对原始功能进行增强</mark>。</p>
</div>
<div class="paragraph">
<p>优势：无侵入、减少重复代码、提高开发效率、维护方便。</p>
</div>
<div class="sect4">
<h5 id="_注释掉上节更改的代码_去掉多余打印">注释掉上节更改的代码 &#8594; 去掉多余打印</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_12">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h6>

</div>
<div class="sect5">
<h6 id="_查询部门列表_计算执行耗时_2">查询部门列表 &#8594; 计算执行耗时</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-nf">selectAllDept</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// long begin = System.currentTimeMillis();  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Dept</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">selectAllDept</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// long end = System.currentTimeMillis();  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-c1">// log.info(&quot;方法执行耗时: {} ms&quot;, (end-begin));  </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">deptList</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>开始时间</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>结束时间</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>计算耗时</td>
</tr>
</table>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
@Slf4j 来自于于 lombok 依赖，包含了记录日志的方法 log。
</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_获取单个部门_计算执行耗时_2">获取单个部门 &#8594; 计算执行耗时</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-nf">getDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// long begin = System.currentTimeMillis();  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">getDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// long end = System.currentTimeMillis();  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-c1">// log.info(&quot;方法执行耗时: {} ms&quot;, (end-begin));  </span><i class="conum" data-value="3"></i><b>(3)</b>

<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>开始时间</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>结束时间</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>计算耗时</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_导入_aop_起步依赖">导入 AOP 起步依赖</h5>
<div class="sect5">
<h6 id="_aop">&lt;&lt; aop &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_定义统计执行耗时操作的切面类">定义统计执行耗时操作的切面类</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaoptimeaspect_java">file &#8594; src/main/java/com/tjise/aop/TimeAspect.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-nd">@Aspect</span><span class="tok-w">     </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">TimeAspect</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>
<span class="tok-w">    </span><span class="tok-nd">@Around</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="3"></i><b>(3)</b>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-nf">getTime</span><span class="tok-p">(</span><span class="tok-n">ProceedingJoinPoint</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Throwable</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">     </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">        </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">proceed</span><span class="tok-p">();</span><span class="tok-w">            </span><i class="conum" data-value="4"></i><b>(4)</b>

<span class="tok-w">        </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">       </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">        </span><span class="tok-n">log</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;方法执行耗时: {} ms&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">end</span><span class="tok-o">-</span><span class="tok-n">begin</span><span class="tok-p">));</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-p">;</span><span class="tok-w">                                  </span><i class="conum" data-value="4"></i><b>(4)</b>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>抽取公共代码（统计执行耗时操作）。这些公共代码称为通知(Advice)。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>标识当前类是一个 AOP 类，并被 IOC 容器管理。</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>配置公共代码作用于哪些目标方法上。通过 execution 中的切入点表达式计算得到切入点，从而找到目标方法。
<div class="ulist">
<ul>
<li>
<p>Around 的名称叫通知。</p>
</li>
<li>
<p>第一个星号 * 表示匹配所有方法的返回值类型，即任何方法的返回值类型都能被匹配。</p>
</li>
<li>
<p>第二个星号 * 表示匹配所有方法。</p>
</li>
<li>
<p>.. 表示匹配任意多个参数。</p>
</li>
</ul>
</div></td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>执行目标方法并返回值。joinPoint 代表目标方法。</td>
</tr>
</table>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">execution 基本语法</div>
<div class="paragraph">
<p>execution(返回值类型 包名.类名.方法名(参数类型))</p>
</div>
<div class="ulist">
<ul>
<li>
<p>*：可以通配任意一个 返回值类型、包名、类名、方法名、或任意的一个参数类型</p>
</li>
<li>
<p>..：可以通配任意层级的包、或任意类型、任意个数的参数</p>
</li>
</ul>
</div>
</div>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试，查看后端日志中已经打印了方法执行耗时</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span>
<span class="tok-go">http :8080/depts/1 &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_面向切面_aop_进阶">面向切面 AOP 进阶</h4>
<div class="sect4">
<h5 id="_注释掉上节更改的代码_去掉多余打印_2">注释掉上节更改的代码 &#8594; 去掉多余打印</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaoptimeaspect_java_2">file &#8594; src/main/java/com/tjise/aop/TimeAspect.java</h6>

</div>
<div class="sect5">
<h6 id="_public_class_timeaspect">public class TimeAspect</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Slf4j</span>
<span class="tok-c1">// 注释下面两个注解，此切面类就失效了  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-c1">// @Component</span>
<span class="tok-c1">// @Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">TimeAspect</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>
<span class="tok-w">    </span><span class="tok-nd">@Around</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-nf">getTime</span><span class="tok-p">(</span><span class="tok-n">ProceedingJoinPoint</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Throwable</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">proceed</span><span class="tok-p">();</span>

<span class="tok-w">        </span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span>
<span class="tok-w">        </span><span class="tok-n">log</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;方法执行耗时: {} ms&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">end</span><span class="tok-o">-</span><span class="tok-n">begin</span><span class="tok-p">));</span>

<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_通知类型">通知类型</h5>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadvicetypeaspectdemo_java">file &#8594; src/main/java/com/tjise/aop/AdviceTypeAspectDemo.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceTypeAspectDemo</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_around_环绕通知_最常用">@Around 环绕通知 &#8594; 最常用</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Around</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-nf">getTime</span><span class="tok-p">(</span><span class="tok-n">ProceedingJoinPoint</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Throwable</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;around 前&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">proceed</span><span class="tok-p">();</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;around 后&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-p">;</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>此注解标注的通知方法在目标方法前、后都有执行代码。</p>
</li>
<li>
<p>此注解修饰的方法必须返回 Object。</p>
</li>
<li>
<p>@Around 需要自己调用 ProceedingJoinPoint.proceed() 来让目标方法执行，其他通知不需要考虑自己调用目标方法执行，因为会自动调用。</p>
</li>
</ul>
</div>
</div>
<div class="sect5">
<h6 id="_before_了解此注解标注的通知方法在目标方法前被执行">@Before &#8594; 了解：此注解标注的通知方法在目标方法前被执行</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_after_了解此注解标注的通知方法在目标方法后被执行无论是否有异常">@After  &#8594; 了解：此注解标注的通知方法在目标方法后被执行，无论是否有异常</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_afterreturning_了解此注解标注的通知方法在目标方法后被执行有异常不会执行">@AfterReturning &#8594; 了解：此注解标注的通知方法在目标方法后被执行，有异常不会执行</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@AfterReturning</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">afterReturning</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;afterReturning&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_afterthrowing_了解此注解标注的通知方法发生异常后执行">@AfterThrowing  &#8594; 了解：此注解标注的通知方法发生异常后执行</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@AfterThrowing</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">afterThrowing</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;afterThrowing&quot;</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_使用_httpie_测试">使用 httpie 测试</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">测试结果：只有 afterThrowing 没有打印，因为没有异常发生。</div>
<div class="content">
<pre>around 前
before
显示其他内容
afterReturning
after
around 后</pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">思考：加个运行时异常会怎么样呢？</dt>
<dd>
<p>比如在 DeptServiceImpl 类的 selectAllDept() 方法中加入 <code>System.out.println(3 / 0);</code></p>
</dd>
</dl>
</div>
<div class="literalblock">
<div class="title">测试结果：只有 afterReturning 没有打印，因为有异常发生了。</div>
<div class="content">
<pre>around 前
before
afterThrowing
after</pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_通知执行顺序">通知执行顺序</h5>
<div class="paragraph">
<p>当有多个切面的切点都匹配目标时，多个通知方法都会被执行。</p>
</div>
<div class="sect5">
<h6 id="_注释掉上节更改的代码_去掉多余打印_3">注释掉上节更改的代码 &#8594; 去掉多余打印</h6>

</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadvicetypeaspectdemo_java_2">file &#8594; src/main/java/com/tjise/aop/AdviceTypeAspectDemo.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-c1">// 注释下面两个注解，此切面类就失效了</span>
<span class="tok-c1">// @Component</span>
<span class="tok-c1">// @Aspect</span>
<span class="tok-nd">@Slf4j</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceTypeAspectDemo</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>
<span class="tok-w">    </span><span class="tok-nd">@others</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_方式一_默认按照切面类的名称字母排序">方式一 默认按照切面类的名称字母排序</h6>
<div class="ulist">
<ul>
<li>
<p>目标前的通知方法：字母排名靠前的先执行</p>
</li>
<li>
<p>目标后的通知方法：字母排名靠前的后执行</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试下面代码，符合上面结论</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">后端打印测试结果</div>
<div class="content">
<pre>before1 -&gt; 目标前的通知方法：字母排名靠前的先执行
before2
其他打印内容
after2
after1 -&gt; 目标后的通知方法：字母排名靠前的后执行</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadviceorderaspectdemo1_java">file &#8594; src/main/java/com/tjise/aop/AdviceOrderAspectDemo1.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceOrderAspectDemo1</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的通知方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before1&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// @After ：此注解标注的通知方法在目标方法后被执行，无论是否有异常。</span>
<span class="tok-w">    </span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after1&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>切面类名的字母排序靠前</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadviceorderaspectdemo2_java">file &#8594; src/main/java/com/tjise/aop/AdviceOrderAspectDemo2.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceOrderAspectDemo2</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的通知方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before2&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// @After ：此注解标注的通知方法在目标方法后被执行，无论是否有异常。</span>
<span class="tok-w">    </span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after2&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>切面类名的字母排序靠后</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_方式二_用_order数字_加在切面类上来控制顺序_常用方式">方式二 用 @Order(数字) 加在切面类上来控制顺序 &#8594; 常用方式</h6>
<div class="ulist">
<ul>
<li>
<p>目标前的通知方法：数字小的先执行</p>
</li>
<li>
<p>目标后的通知方法：数字小的后执行</p>
</li>
</ul>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试下面代码，符合上面结论</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
<div class="literalblock">
<div class="title">后端打印测试结果</div>
<div class="content">
<pre>before4 -&gt; @Order(66)
before3 -&gt; @Order(99)
其他打印代码
after3 -&gt; @Order(99)
after4 -&gt; @Order(66)</pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadviceorderaspectdemo3_java">file &#8594; src/main/java/com/tjise/aop/AdviceOrderAspectDemo3.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.After</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Before</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.core.annotation.Order</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-nd">@Order</span><span class="tok-p">(</span><span class="tok-mi">99</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceOrderAspectDemo3</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的通知方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before3&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// @After：此注解标注的通知方法在目标方法后被执行，无论是否有异常。</span>
<span class="tok-w">    </span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after3&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>用大数字注解类名</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopadviceorderaspectdemo4_java">file &#8594; src/main/java/com/tjise/aop/AdviceOrderAspectDemo4.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.After</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Before</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.core.annotation.Order</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-nd">@Order</span><span class="tok-p">(</span><span class="tok-mi">66</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AdviceOrderAspectDemo4</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 切面类</span>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的通知方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before4&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// @After：此注解标注的通知方法在目标方法后被执行，无论是否有异常。</span>
<span class="tok-w">    </span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after4&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>用小数字注解类名</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_切点表达式_annotation">切点表达式 @annotation()</h5>
<div class="paragraph">
<p>除了使用 execution() 切点表达式，
还可以使用 @annotation() 切点表达式来根据目标方法是否有注解来进行匹配。</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopannotationaspectdemo_java">file &#8594; src/main/java/com/tjise/aop/AnnotationAspectDemo.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Before</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">AnnotationAspectDemo</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;@annotation(com.tjise.annotation.Log)&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>使用 @annotation() 切点表达式来根据目标方法是否有注解来进行匹配。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseannotationlog_java">file &#8594; src/main/java/com/tjise/annotation/Log.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.annotation</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.lang.annotation.ElementType</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.lang.annotation.Retention</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.lang.annotation.RetentionPolicy</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.lang.annotation.Target</span><span class="tok-p">;</span>

<span class="tok-nd">@Target</span><span class="tok-p">(</span><span class="tok-n">ElementType</span><span class="tok-p">.</span><span class="tok-na">METHOD</span><span class="tok-p">)</span>
<span class="tok-nd">@Retention</span><span class="tok-p">(</span><span class="tok-n">RetentionPolicy</span><span class="tok-p">.</span><span class="tok-na">RUNTIME</span><span class="tok-p">)</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-nd">@interface</span><span class="tok-w"> </span><span class="tok-n">Log</span><span class="tok-w"> </span><span class="tok-p">{}</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>自定义标记性注解，用于记录日志。</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>这两个元注解不是必须的，但通常建议添加。让我解释一下它们的作用：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p><strong><code>@Target(ElementType.METHOD)</code></strong></p>
<div class="ulist">
<ul>
<li>
<p>指定注解可以应用的目标元素类型</p>
</li>
<li>
<p><code>ElementType.METHOD</code> 表示该注解只能用于方法上</p>
</li>
<li>
<p>如果不写，注解默认可以用于任何元素类型</p>
</li>
</ul>
</div>
</li>
<li>
<p><strong><code>@Retention(RetentionPolicy.RUNTIME)</code></strong></p>
<div class="ulist">
<ul>
<li>
<p>指定注解的保留策略</p>
</li>
<li>
<p><code>RetentionPolicy.RUNTIME</code> 表示注解在运行时仍然可用，可以通过反射获取</p>
</li>
<li>
<p>如果不写，默认是 <code>CLASS</code> 策略，运行时无法通过反射获取</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>在 AOP 场景中，@Before、@After 等注解都需要在运行时被 Spring AOP 框架通过反射读取，所以必须使用 RetentionPolicy.RUNTIME 策略。</p>
</div>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_13">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h6>

</div>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门及其员工_4">deleteDeptById 删除单个部门及其员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span>
<span class="normal">9</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Transactional</span><span class="tok-p">(</span><span class="tok-n">rollbackFor</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">)</span>
<span class="tok-nd">@Override</span>
<span class="tok-nd">@Log</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">     </span><span class="tok-c1">// 删除部门</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 把此部门的员工删除</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-mi">3</span><span class="tok-w"> </span><span class="tok-o">/</span><span class="tok-w"> </span><span class="tok-mi">0</span><span class="tok-p">);</span><span class="tok-w">         </span><span class="tok-c1">// 运行时异常</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试，查看后端日志中已经打印了方法执行耗时</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http DELETE :8080/depts/1 &quot;token: $TOKEN&quot;  # 会打印 before</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;    # 不会打印 before</span>
<span class="tok-go">http :8080/depts/1 &quot;token: $TOKEN&quot;  # 不会打印 before</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_切点表达式_pointcut">切点表达式 @PointCut</h5>
<div class="paragraph">
<p>该注解的作用是将公共的切点表达式抽取出来，需要用到时引用该切点表达式即可。</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaoppointcutaspectdemo_java">file &#8594; src/main/java/com/tjise/aop/PointcutAspectDemo.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.*</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">PointcutAspectDemo</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Pointcut</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">pt</span><span class="tok-p">(){}</span>

<span class="tok-w">    </span><span class="tok-c1">// @Before：此注解标注的通知方法在目标方法前被执行。</span>
<span class="tok-w">    </span><span class="tok-nd">@Before</span><span class="tok-p">(</span><span class="tok-s">&quot;pt()&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">before</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;before&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// @After ：此注解标注的通知方法在目标方法后被执行，无论是否有异常。</span>
<span class="tok-w">    </span><span class="tok-nd">@After</span><span class="tok-p">(</span><span class="tok-s">&quot;pt()&quot;</span><span class="tok-p">)</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">after</span><span class="tok-p">()</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;after&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>使用 @Pointcut 注解抽取公共的切点表达式为一个方法。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>引用抽取的方法即可。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试，查看后端日志中已经打印了方法执行耗时</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;    # 会打印 before 和 after</span>
<span class="tok-go">http :8080/depts/1 &quot;token: $TOKEN&quot;  # 会打印 before 和 after</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_连接点_joinpoint">连接点 JoinPoint</h5>
<div class="paragraph">
<p>连接点简单理解就是 目标方法，在 Spring 中用 JoinPoint 抽象了连接点，用它可以获得方法执行时的相关信息，如方法名、方法参数类型、方法实际参数等等。</p>
</div>
<div class="ulist">
<ul>
<li>
<p>对于 @Around 通知，获取连接点信息只能使用 ProceedingJoinPoint。</p>
</li>
<li>
<p>对于其他四种通知，获取连接点信息只能使用 JoinPoint，它是 ProceedingJoinPoint 的父类型。</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>下面我们举个使用 @Around 通知中 ProceedingJoinPoint 的例子。</p>
</div>
<div class="sect5">
<h6 id="_file_srcmainjavacomtjiseaopjoinpointaspect_java">file &#8594; src/main/java/com/tjise/aop/JoinPointAspect.java</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal"> 1</span>
<span class="normal"> 2</span>
<span class="normal"> 3</span>
<span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.extern.slf4j.Slf4j</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.Arrays</span><span class="tok-p">;</span>

<span class="tok-nd">@Slf4j</span>
<span class="tok-nd">@Component</span>
<span class="tok-nd">@Aspect</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">JoinPointAspect</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-nd">@Around</span><span class="tok-p">(</span><span class="tok-s">&quot;execution(* com.tjise.service.impl.DeptServiceImpl.*(..))&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-nf">getTime</span><span class="tok-p">(</span><span class="tok-n">ProceedingJoinPoint</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Throwable</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>

<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">className</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getTarget</span><span class="tok-p">().</span><span class="tok-na">getClass</span><span class="tok-p">().</span><span class="tok-na">getName</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 获取类名</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">methodName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getSignature</span><span class="tok-p">().</span><span class="tok-na">getName</span><span class="tok-p">();</span><span class="tok-w">   </span><span class="tok-c1">// 获取方法名</span>
<span class="tok-w">        </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Arrays</span><span class="tok-p">.</span><span class="tok-na">toString</span><span class="tok-p">(</span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getArgs</span><span class="tok-p">());</span><span class="tok-w">  </span><span class="tok-c1">// 获取方法参数值</span>
<span class="tok-w">        </span><span class="tok-n">log</span><span class="tok-p">.</span><span class="tok-na">info</span><span class="tok-p">(</span><span class="tok-s">&quot;类名：{}，方法名：{}，参数：{}&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">className</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">methodName</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">args</span><span class="tok-p">);</span><span class="tok-w">  </span><i class="conum" data-value="2"></i><b>(2)</b>

<span class="tok-w">        </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">proceed</span><span class="tok-p">();</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">obj</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>joinPoint 连接点代表方法对象。</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>在后端打印获取到的内容。</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试，查看后端日志中打印结果</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span>
<span class="tok-go">http :8080/depts/1 &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_面向切面_aop_案例">面向切面 AOP 案例</h4>
<div class="paragraph">
<p>将前面的部门和员工管理案例中对业务类（service）中的 增、删、改 方法的操作日志保存到数据库（MySQL）中。</p>
</div>
<div class="paragraph">
<p>思路分析：</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>需要对所有业务类中的增、删、改 方法添加统一功能，使用 AOP 技术最为方便，因为不用更改原业务代码。</p>
</li>
<li>
<p>由于增、删、改 方法名没有规律，所以用 execution 不合适，但是可以用 @annotation 注解配合自定义 @Log 注解完成目标方法选取。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_检查是否在_pom_xml_文件中导入了_aop_依赖">检查是否在 pom.xml 文件中导入了 AOP 依赖</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-aop<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_创建数据库操作日志表_operate_log">创建数据库操作日志表 operate_log</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="sql"><span></span><span class="tok-k">create</span><span class="tok-w"> </span><span class="tok-k">table</span><span class="tok-w"> </span><span class="tok-n">operate_log</span><span class="tok-p">(</span>
<span class="tok-w">    </span><span class="tok-n">id</span><span class="tok-w"> </span><span class="tok-nb">int</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">primary</span><span class="tok-w"> </span><span class="tok-k">key</span><span class="tok-w"> </span><span class="tok-n">auto_increment</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;ID&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">operate_user</span><span class="tok-w"> </span><span class="tok-nb">int</span><span class="tok-w"> </span><span class="tok-n">unsigned</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;操作人&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">operate_time</span><span class="tok-w"> </span><span class="tok-n">datetime</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;操作时间&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">class_name</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;操作的类名&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">method_name</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">100</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;操作的方法名&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">method_params</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">1000</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;方法参数&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">return_value</span><span class="tok-w"> </span><span class="tok-nb">varchar</span><span class="tok-p">(</span><span class="tok-mi">2000</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;返回值&#39;</span><span class="tok-p">,</span>
<span class="tok-w">    </span><span class="tok-n">cost_time</span><span class="tok-w"> </span><span class="tok-nb">bigint</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;方法执行耗时, 单位:ms&#39;</span>
<span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-k">comment</span><span class="tok-w"> </span><span class="tok-s1">&#39;操作日志表&#39;</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisepojooperatelog_java">file &#8594; src/main/java/com/tjise/pojo/OperateLog.java</h5>
<div class="listingblock">
<div class="title">定义操作日志表对应的实体类</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.AllArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.Data</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">lombok.NoArgsConstructor</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>

<span class="tok-nd">@Data</span>
<span class="tok-nd">@NoArgsConstructor</span>
<span class="tok-nd">@AllArgsConstructor</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">OperateLog</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//ID</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">operateUser</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作人</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">operateTime</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作时间</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">className</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作类名</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">methodName</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作方法名</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">methodParams</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作方法参数</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">returnValue</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作方法返回值</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">Long</span><span class="tok-w"> </span><span class="tok-n">costTime</span><span class="tok-p">;</span><span class="tok-w"> </span><span class="tok-c1">//操作耗时</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisemapperoperatelogmapper_java">file &#8594; src/main/java/com/tjise/mapper/OperateLogMapper.java</h5>
<div class="listingblock">
<div class="title">定义操作日志表对应的 insert mapper</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.OperateLog</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Insert</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.apache.ibatis.annotations.Mapper</span><span class="tok-p">;</span>

<span class="tok-nd">@Mapper</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">interface</span> <span class="tok-nc">OperateLogMapper</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">//插入日志数据</span>
<span class="tok-w">    </span><span class="tok-nd">@Insert</span><span class="tok-p">(</span><span class="tok-s">&quot;insert into operate_log (operate_user, operate_time, class_name, method_name, method_params, return_value, cost_time) &quot;</span><span class="tok-w"> </span><span class="tok-o">+</span>
<span class="tok-w">            </span><span class="tok-s">&quot;values (#{operateUser}, #{operateTime}, #{className}, #{methodName}, #{methodParams}, #{returnValue}, #{costTime});&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insert</span><span class="tok-p">(</span><span class="tok-n">OperateLog</span><span class="tok-w"> </span><span class="tok-n">log</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimpldeptserviceimpl_java_14">file &#8594; src/main/java/com/tjise/service/impl/DeptServiceImpl.java</h5>
<div class="sect5">
<h6 id="_insertdept_新增部门_增加_log">insertDept 新增部门 &#8594; 增加 @Log</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-nd">@Log</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 指定 createTime &amp; updateTime</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setCreateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-c1">// 方法调用不用写类型 Dept</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">insertDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_updatedept_修改部门_增加_log">updateDept 修改部门 &#8594; 增加 @Log</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-nd">@Log</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateDept</span><span class="tok-p">(</span><span class="tok-n">Dept</span><span class="tok-w"> </span><span class="tok-n">dept</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 补全属性</span>
<span class="tok-w">    </span><span class="tok-n">dept</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">updateDept</span><span class="tok-p">(</span><span class="tok-n">dept</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_deletedeptbyid_删除单个部门及其员工_增加_log">deleteDeptById 删除单个部门及其员工 &#8594; 增加 @Log</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Transactional</span><span class="tok-p">(</span><span class="tok-n">rollbackFor</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-p">.</span><span class="tok-na">class</span><span class="tok-p">)</span>
<span class="tok-nd">@Override</span>
<span class="tok-nd">@Log</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">id</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-n">deptMapper</span><span class="tok-p">.</span><span class="tok-na">deleteDeptById</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">     </span><span class="tok-c1">// 删除部门</span>
<span class="tok-w">    </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">id</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// 把此部门的员工删除</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseserviceimplempserviceimpl_java_10">file &#8594; src/main/java/com/tjise/service/impl/EmpServiceImpl.java</h5>
<div class="sect5">
<h6 id="_insertemp_新增员工">insertEmp 新增员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span>
<span class="normal">7</span>
<span class="normal">8</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Log</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">insertEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">){</span>
<span class="tok-w">    </span><span class="tok-c1">// 补全属性</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setCreateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">insertEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_updateemp_修改单个员工">updateEmp 修改单个员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-c1">// emp 封装了要修改的数据</span>
<span class="tok-nd">@Log</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">updateEmp</span><span class="tok-p">(</span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-c1">// 在前端提交的表单中没有更新时间，所以需要后台来补充此属性</span>
<span class="tok-w">    </span><span class="tok-n">emp</span><span class="tok-p">.</span><span class="tok-na">setUpdateTime</span><span class="tok-p">(</span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">());</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">updateEmp</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_deleteempbyids_删除员工">deleteEmpByIds 删除员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Log</span>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">List</span><span class="tok-o">&lt;</span><span class="tok-n">Integer</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">ids</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByIds</span><span class="tok-p">(</span><span class="tok-n">ids</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
<div class="sect5">
<h6 id="_deleteempbydeptid_根据部门id删除员工">deleteEmpByDeptId 根据部门id删除员工</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><div class="lineno"><table class="linenotable"><tr><td class="linenos"><div class="linenodiv"><pre><span class="normal">1</span>
<span class="normal">2</span>
<span class="normal">3</span>
<span class="normal">4</span>
<span class="normal">5</span>
<span class="normal">6</span></pre></div></td><td class="code"><div><pre><span></span><span class="tok-nd">@Transactional</span>
<span class="tok-nd">@Log</span><span class="tok-w">  </span><i class="conum" data-value="1"></i><b>(1)</b>
<span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">void</span><span class="tok-w"> </span><span class="tok-nf">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">deptId</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">empMapper</span><span class="tok-p">.</span><span class="tok-na">deleteEmpByDeptId</span><span class="tok-p">(</span><span class="tok-n">deptId</span><span class="tok-p">);</span>
<span class="tok-p">}</span>
</pre></div></td></tr></table></div></code></pre>
</div>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>给方法增加自定义注解，让 @annotation() 切点表达式可以找到该方法。</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseaoplogaspect_java">file &#8594; src/main/java/com/tjise/aop/LogAspect.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kn">package</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.aop</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.alibaba.fastjson2.JSONObject</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.mapper.OperateLogMapper</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.utils.JwtUtils</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">com.tjise.pojo.OperateLog</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.ProceedingJoinPoint</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Around</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.aspectj.lang.annotation.Aspect</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.beans.factory.annotation.Autowired</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">org.springframework.stereotype.Component</span><span class="tok-p">;</span>

<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">javax.servlet.http.HttpServletRequest</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.time.LocalDateTime</span><span class="tok-p">;</span>
<span class="tok-kn">import</span><span class="tok-w"> </span><span class="tok-nn">java.util.Arrays</span><span class="tok-p">;</span>

<span class="tok-nd">@Aspect</span>
<span class="tok-nd">@Component</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LogAspect</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-c1">// 含有用户上传的参数，其中有 token 可以解出登录的用户信息，如 id</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-c1">// 把 OperateLogMapper 接口的实现类对象注入</span>
<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">OperateLogMapper</span><span class="tok-w"> </span><span class="tok-n">operateLogMapper</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-nd">@Around</span><span class="tok-p">(</span><span class="tok-s">&quot;@annotation(com.tjise.annotation.Log)&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-nf">logServiceCURD</span><span class="tok-p">(</span><span class="tok-n">ProceedingJoinPoint</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Throwable</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-nd">@others</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_1_获取操作人_operateuser">1 获取操作人 operateUser</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;token&quot;</span><span class="tok-p">);</span>
<span class="tok-n">Integer</span><span class="tok-w"> </span><span class="tok-n">operateUser</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Integer</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">parseJWT</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">).</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_2_获取操作时间_operatetime">2 获取操作时间 operateTime</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">LocalDateTime</span><span class="tok-w"> </span><span class="tok-n">operateTime</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">LocalDateTime</span><span class="tok-p">.</span><span class="tok-na">now</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_3_获取操作方法的类名">3 获取操作方法的类名</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">className</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getTarget</span><span class="tok-p">().</span><span class="tok-na">getClass</span><span class="tok-p">().</span><span class="tok-na">getName</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_4_获取操作的方法名">4 获取操作的方法名</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">methodName</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getSignature</span><span class="tok-p">().</span><span class="tok-na">getName</span><span class="tok-p">();</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_5_获取操作的方法参数">5 获取操作的方法参数</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">methodParams</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">Arrays</span><span class="tok-p">.</span><span class="tok-na">toString</span><span class="tok-p">(</span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">getArgs</span><span class="tok-p">());</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_6_获取操作方法的返回值">6 获取操作方法的返回值</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">  </span><span class="tok-c1">// 操作方法执行开始时间</span>
<span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">joinPoint</span><span class="tok-p">.</span><span class="tok-na">proceed</span><span class="tok-p">();</span><span class="tok-w">      </span><span class="tok-c1">// 有异常就抛出</span>
<span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">currentTimeMillis</span><span class="tok-p">();</span><span class="tok-w">    </span><span class="tok-c1">// 操作方法执行结束时间</span>
<span class="tok-c1">// 对象转字符串</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">returnValue</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JSONObject</span><span class="tok-p">.</span><span class="tok-na">toJSONString</span><span class="tok-p">(</span><span class="tok-n">result</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_7_获取操作方法执行耗时">7 获取操作方法执行耗时</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-kt">long</span><span class="tok-w"> </span><span class="tok-n">costTime</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">end</span><span class="tok-w"> </span><span class="tok-o">-</span><span class="tok-w"> </span><span class="tok-n">begin</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_8_获取的数据封装成_operatelog_对象">8 获取的数据封装成 OperateLog 对象</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">OperateLog</span><span class="tok-w"> </span><span class="tok-n">operateLog</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">OperateLog</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-kc">null</span><span class="tok-p">,</span><span class="tok-w">  </span><span class="tok-c1">// id 由数据库自动生成</span>
<span class="tok-w">        </span><span class="tok-n">operateUser</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">operateTime</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">className</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">methodName</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">methodParams</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">returnValue</span><span class="tok-p">,</span>
<span class="tok-w">        </span><span class="tok-n">costTime</span>
<span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_9_将封装的_operatelog_对象插入数据库表_operate_log_中">9 将封装的 OperateLog 对象插入数据库表 operate_log 中</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">operateLogMapper</span><span class="tok-p">.</span><span class="tok-na">insert</span><span class="tok-p">(</span><span class="tok-n">operateLog</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_10_返回操作方法执行的结果">10 返回操作方法执行的结果</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">result</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_22_redis_数据库应用">22. Redis 数据库应用</h3>
<div class="sect3">
<h4 id="_了解知识点_jedis">了解知识点 jedis</h4>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
我们在 Spring Boot 中使用 <code>Spring Boot Starter Data Redis</code>，下面直接使用 jedis 的知识点作为了解即可。
</td>
</tr>
</table>
</div>
<div class="listingblock">
<div class="title">直接使用依赖 jedis</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">https</span><span class="tok-nd">:</span><span class="tok-o">//</span><span class="tok-nt">mvnrepository</span><span class="tok-nc">.com</span><span class="tok-o">/</span><span class="tok-nt">artifact</span><span class="tok-o">/</span><span class="tok-nt">redis</span><span class="tok-nc">.clients</span><span class="tok-o">/</span><span class="tok-nt">jedis</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">redis</span><span class="tok-nc">.clients</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">jedis</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-w">    </span><span class="tok-o">&lt;</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span><span class="tok-nt">5</span><span class="tok-nc">.2.0</span><span class="tok-o">&lt;/</span><span class="tok-nt">version</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">测试代码</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">Jedis</span><span class="tok-w"> </span><span class="tok-n">jedis</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">Jedis</span><span class="tok-p">(</span><span class="tok-s">&quot;127.0.0.1&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-mi">6379</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// SSL 为 false</span>
<span class="tok-c1">// jedis.auth(&quot;123456&quot;);  // 没有密码则不用写</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">pong</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">jedis</span><span class="tok-p">.</span><span class="tok-na">ping</span><span class="tok-p">();</span>
<span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-n">pong</span><span class="tok-p">);</span><span class="tok-w">   </span><span class="tok-c1">// PONG 表示连接成功</span>

<span class="tok-c1">// 测试一下字符串设置</span>
<span class="tok-n">jedis</span><span class="tok-p">.</span><span class="tok-na">set</span><span class="tok-p">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-s">&quot;swot&quot;</span><span class="tok-p">);</span>
<span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">foo</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">jedis</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">);</span>
<span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-n">foo</span><span class="tok-p">);</span><span class="tok-w">  </span><span class="tok-c1">// swot</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
其他类型的例子省略。
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p><strong>以上作为了解知识点，下面我们使用 <code>Spring Boot Starter Data Redis</code> 依赖，它的驱动库是 lettuce。</strong></p>
</div>
<div class="sidebarblock">
<div class="content">
<div class="title">Spring Boot Starter Data Redis 如何使用 jedis 驱动库</div>
<div class="paragraph">
<p>如果你想使用 jedis 驱动库，也是可以配合 Spring Boot Starter Data Redis 的，下面是实现的方式（参考资料）。</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="xml"><span></span><span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>org.springframework.boot<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>spring-boot-starter-data-redis<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-w">    </span><span class="tok-cm">&lt;!-- 不使用 lettuce 驱动库了 --&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;exclusions&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;exclusion&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;groupId&gt;</span>io.lettuce<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">            </span><span class="tok-nt">&lt;artifactId&gt;</span>lettuce-core<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-w">        </span><span class="tok-nt">&lt;/exclusion&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;/exclusions&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span>

<span class="tok-cm">&lt;!-- 再显式引入 Jedis 驱动库 --&gt;</span>
<span class="tok-nt">&lt;dependency&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;groupId&gt;</span>redis.clients<span class="tok-nt">&lt;/groupId&gt;</span>
<span class="tok-w">    </span><span class="tok-nt">&lt;artifactId&gt;</span>jedis<span class="tok-nt">&lt;/artifactId&gt;</span>
<span class="tok-nt">&lt;/dependency&gt;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_登录时将_token_放入_redis_数据库">登录时将 token 放入 Redis 数据库</h4>
<div class="paragraph">
<p>为什么要将 token 放入 redis 数据库中？</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>过期时间记录在 token 中，后端无法将用户踢下线。</p>
</li>
<li>
<p>将 token 存入关系型数据库中，太慢了。</p>
</li>
</ol>
</div>
<div class="sect4">
<h5 id="_file_pom_xml_3">file &#8594; pom.xml</h5>
<div class="sect5">
<h6 id="_redis">redis</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="scss"><span></span><span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">https</span><span class="tok-nd">:</span><span class="tok-o">//</span><span class="tok-nt">mvnrepository</span><span class="tok-nc">.com</span><span class="tok-o">/</span><span class="tok-nt">artifact</span><span class="tok-o">/</span><span class="tok-nt">org</span><span class="tok-nc">.springframework.boot</span><span class="tok-o">/</span><span class="tok-nt">spring-boot-starter-data-redis</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;!</span><span class="tok-nt">--</span><span class="tok-w"> </span><span class="tok-nt">spring-boot-starter-parent</span><span class="tok-w"> </span><span class="tok-nt">中已经指定了相应可用的版本</span><span class="tok-w"> </span><span class="tok-nt">--</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span>
<span class="tok-w">   </span><span class="tok-o">&lt;</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span><span class="tok-nt">org</span><span class="tok-nc">.springframework.boot</span><span class="tok-o">&lt;/</span><span class="tok-nt">groupId</span><span class="tok-o">&gt;</span>
<span class="tok-w">   </span><span class="tok-o">&lt;</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span><span class="tok-nt">spring-boot-starter-data-redis</span><span class="tok-o">&lt;/</span><span class="tok-nt">artifactId</span><span class="tok-o">&gt;</span>
<span class="tok-o">&lt;/</span><span class="tok-nt">dependency</span><span class="tok-o">&gt;</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainresourcesapplication_yml_3">file &#8594; src/main/resources/application.yml</h5>
<div class="sect5">
<h6 id="_spring_新增配置_redis">spring 新增配置 redis</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="python"><span></span><span class="tok-n">spring</span><span class="tok-p">:</span>
    <span class="tok-n">application</span><span class="tok-p">:</span>
        <span class="tok-n">name</span><span class="tok-p">:</span> <span class="tok-n">mybatis_quickstart</span><span class="tok-o">-</span><span class="tok-n">crud</span>
    <span class="tok-n">datasource</span><span class="tok-p">:</span>
        <span class="tok-n">driver</span><span class="tok-o">-</span><span class="tok-n">class</span><span class="tok-o">-</span><span class="tok-n">name</span><span class="tok-p">:</span> <span class="tok-n">com</span><span class="tok-o">.</span><span class="tok-n">mysql</span><span class="tok-o">.</span><span class="tok-n">cj</span><span class="tok-o">.</span><span class="tok-n">jdbc</span><span class="tok-o">.</span><span class="tok-n">Driver</span>
        <span class="tok-n">url</span><span class="tok-p">:</span> <span class="tok-n">jdbc</span><span class="tok-p">:</span><span class="tok-n">mysql</span><span class="tok-p">:</span><span class="tok-o">//</span><span class="tok-n">localhost</span><span class="tok-p">:</span><span class="tok-mi">3307</span><span class="tok-o">/</span><span class="tok-n">tjise</span>
        <span class="tok-n">username</span><span class="tok-p">:</span> <span class="tok-n">root</span>
        <span class="tok-n">password</span><span class="tok-p">:</span> <span class="tok-n">root</span>
    <span class="tok-n">servlet</span><span class="tok-p">:</span>
        <span class="tok-n">multipart</span><span class="tok-p">:</span>                  <span class="tok-c1"># 上传文件</span>
            <span class="tok-nb">max</span><span class="tok-o">-</span><span class="tok-n">file</span><span class="tok-o">-</span><span class="tok-n">size</span><span class="tok-p">:</span> <span class="tok-mi">10</span><span class="tok-n">MB</span>     <span class="tok-c1"># 指定单个文件上传的大小</span>
            <span class="tok-nb">max</span><span class="tok-o">-</span><span class="tok-n">request</span><span class="tok-o">-</span><span class="tok-n">size</span><span class="tok-p">:</span> <span class="tok-mi">100</span><span class="tok-n">MB</span>  <span class="tok-c1"># 指定单次请求上传文件的总大小</span>
    <span class="tok-c1"># 新增配置 redis</span>
    <span class="tok-n">redis</span><span class="tok-p">:</span>
        <span class="tok-n">database</span><span class="tok-p">:</span> <span class="tok-mi">0</span>
        <span class="tok-n">host</span><span class="tok-p">:</span> <span class="tok-mf">127.0.0.1</span>
        <span class="tok-n">port</span><span class="tok-p">:</span> <span class="tok-mi">6379</span>
        <span class="tok-c1"># password: 未设置</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjisecontrollerlogincontroller_java_3">file &#8594; src/main/java/com/tjise/controller/LoginController.java</h5>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@RestController</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kd">class</span> <span class="tok-nc">LoginController</span><span class="tok-w"> </span><span class="tok-p">{</span>

<span class="tok-w">    </span><span class="tok-nd">@Autowired</span>
<span class="tok-w">    </span><span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">EmpService</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">;</span>

<span class="tok-w">    </span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-n">注入</span><span class="tok-w"> </span><span class="tok-n">redis</span><span class="tok-w"> </span><span class="tok-n">对象</span><span class="tok-w"> </span><span class="tok-o">&gt;&gt;</span>

<span class="tok-w">    </span><span class="tok-nd">@PostMapping</span><span class="tok-p">(</span><span class="tok-s">&quot;/login&quot;</span><span class="tok-p">)</span>
<span class="tok-w">    </span><span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-w"> </span><span class="tok-nf">login</span><span class="tok-p">(</span><span class="tok-nd">@RequestBody</span><span class="tok-w"> </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">emp</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-c1">// 登录，去数据库验证用户名和密码</span>
<span class="tok-w">        </span><span class="tok-n">Emp</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">empService</span><span class="tok-p">.</span><span class="tok-na">login</span><span class="tok-p">(</span><span class="tok-n">emp</span><span class="tok-p">);</span>

<span class="tok-w">        </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">e</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// 登录失败返回 NOT_LOGIN 后前端会自动跳转到登录页面</span>
<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">error</span><span class="tok-p">(</span><span class="tok-s">&quot;NOT_LOGIN&quot;</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">else</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">            </span><span class="tok-c1">// 登录成功</span>
<span class="tok-w">            </span><span class="tok-n">Map</span><span class="tok-o">&lt;</span><span class="tok-n">String</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">Object</span><span class="tok-o">&gt;</span><span class="tok-w"> </span><span class="tok-n">map</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-k">new</span><span class="tok-w"> </span><span class="tok-n">HashMap</span><span class="tok-o">&lt;&gt;</span><span class="tok-p">();</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;id&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getId</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getUsername</span><span class="tok-p">());</span>
<span class="tok-w">            </span><span class="tok-n">map</span><span class="tok-p">.</span><span class="tok-na">put</span><span class="tok-p">(</span><span class="tok-s">&quot;name&quot;</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getName</span><span class="tok-p">());</span>

<span class="tok-w">            </span><span class="tok-c1">// 生成令牌并返回给前端</span>
<span class="tok-w">            </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">generateJwt</span><span class="tok-p">(</span><span class="tok-n">map</span><span class="tok-p">);</span>

<span class="tok-w">            </span><span class="tok-o">&lt;&lt;</span><span class="tok-w"> </span><span class="tok-n">将</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-n">token</span><span class="tok-w"> </span><span class="tok-n">存入</span><span class="tok-w"> </span><span class="tok-n">redis</span><span class="tok-w"> </span><span class="tok-n">数据库</span><span class="tok-w"> </span><span class="tok-o">&gt;&gt;</span>

<span class="tok-w">            </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-n">Result</span><span class="tok-p">.</span><span class="tok-na">success</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="sect5">
<h6 id="_注入_redis_对象">&lt;&lt; 注入 redis 对象 &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Autowired</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">StringRedisTemplate</span><span class="tok-w"> </span><span class="tok-n">stringRedisTemplate</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_将_jwt_token_存入_redis_数据库">&lt;&lt; 将 jwt token 存入 redis 数据库 &gt;&gt;</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-n">stringRedisTemplate</span><span class="tok-p">.</span><span class="tok-na">opsForValue</span><span class="tok-p">().</span><span class="tok-na">set</span><span class="tok-p">(</span>
<span class="tok-w">        </span><span class="tok-n">e</span><span class="tok-p">.</span><span class="tok-na">getUsername</span><span class="tok-p">(),</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-p">,</span><span class="tok-w">   </span><span class="tok-c1">// 将用户名存入 redis</span>
<span class="tok-w">        </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">expire</span><span class="tok-p">,</span><span class="tok-w"> </span><span class="tok-n">TimeUnit</span><span class="tok-p">.</span><span class="tok-na">MILLISECONDS</span><span class="tok-p">);</span></code></pre>
</div>
</div>
</div>
</div>
<div class="sect4">
<h5 id="_api_测试登录查看_redis">api 测试登录查看 redis</h5>
<div class="dlist">
<dl>
<dt class="hdlist1">使用 httpie 测试登录</dt>
<dd>
<p>http -v post <a href="http://localhost:8080/login" class="bare">http://localhost:8080/login</a> username=limuwan password=123456</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>进入 redis 查看是否有以用户名 limuwan 为 key 的值。</p>
</div>
</div>
</div>
<div class="sect3">
<h4 id="_前端请求进行_token_对比">前端请求进行 token 对比</h4>
<div class="sect4">
<h5 id="_file_srcmainjavacomtjiseinterceptorlogincheckedinterceptor_java_3">file &#8594; src/main/java/com/tjise/interceptor/LoginCheckedInterceptor.java</h5>
<div class="sect5">
<h6 id="_注入_redis_对象_2">注入 redis 对象</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Autowired</span>
<span class="tok-kd">private</span><span class="tok-w"> </span><span class="tok-n">StringRedisTemplate</span><span class="tok-w"> </span><span class="tok-n">stringRedisTemplate</span><span class="tok-p">;</span></code></pre>
</div>
</div>
</div>
<div class="sect5">
<h6 id="_prehandle_目标_api_执行前执行_return_true_放行return_false_拦截_2">preHandle 目标 api 执行前执行: return true 放行，return false 拦截</h6>
<div class="listingblock">
<div class="content">
<pre class="pygments highlight"><code data-lang="java"><span></span><span class="tok-nd">@Override</span>
<span class="tok-kd">public</span><span class="tok-w"> </span><span class="tok-kt">boolean</span><span class="tok-w"> </span><span class="tok-nf">preHandle</span><span class="tok-p">(</span><span class="tok-n">HttpServletRequest</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">,</span>
<span class="tok-w">                         </span><span class="tok-n">HttpServletResponse</span><span class="tok-w"> </span><span class="tok-n">response</span><span class="tok-p">,</span>
<span class="tok-w">                         </span><span class="tok-n">Object</span><span class="tok-w"> </span><span class="tok-n">handler</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-kd">throws</span><span class="tok-w"> </span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">    </span><span class="tok-n">System</span><span class="tok-p">.</span><span class="tok-na">out</span><span class="tok-p">.</span><span class="tok-na">println</span><span class="tok-p">(</span><span class="tok-s">&quot;Enter preHandle()&quot;</span><span class="tok-p">);</span>

<span class="tok-w">    </span><span class="tok-c1">// 1. 获取请求路由</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">url</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getRequestURL</span><span class="tok-p">().</span><span class="tok-na">toString</span><span class="tok-p">();</span>

<span class="tok-w">    </span><span class="tok-c1">// 2. 判断请求的路由是否包含 login</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">url</span><span class="tok-p">.</span><span class="tok-na">contains</span><span class="tok-p">(</span><span class="tok-s">&quot;login&quot;</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 放行去访问 login api</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 3. 获取请求头中的令牌 token</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">request</span><span class="tok-p">.</span><span class="tok-na">getHeader</span><span class="tok-p">(</span><span class="tok-s">&quot;token&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span><span class="tok-w">  </span><span class="tok-c1">// 返回登录页面</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span><span class="tok-w">  </span><span class="tok-c1">// 拦截直接给客户端响应 200 结束</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-c1">// ---------- 更新代码开始 ------</span>
<span class="tok-w">    </span><span class="tok-c1">// 4. 解析令牌</span>
<span class="tok-w">    </span><span class="tok-n">Claims</span><span class="tok-w"> </span><span class="tok-n">payload</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-k">try</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">payload</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">JwtUtils</span><span class="tok-p">.</span><span class="tok-na">parseJWT</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-p">}</span><span class="tok-w"> </span><span class="tok-k">catch</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">Exception</span><span class="tok-w"> </span><span class="tok-n">e</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>

<span class="tok-w">    </span><span class="tok-c1">// 5. 对比 redis 数据库中的值</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">username</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">String</span><span class="tok-p">)</span><span class="tok-w"> </span><span class="tok-n">payload</span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-s">&quot;username&quot;</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-n">String</span><span class="tok-w"> </span><span class="tok-n">tokenFromRedis</span><span class="tok-w"> </span><span class="tok-o">=</span><span class="tok-w"> </span><span class="tok-n">stringRedisTemplate</span><span class="tok-p">.</span><span class="tok-na">opsForValue</span><span class="tok-p">()</span>
<span class="tok-w">                                               </span><span class="tok-p">.</span><span class="tok-na">get</span><span class="tok-p">(</span><span class="tok-n">username</span><span class="tok-p">);</span>
<span class="tok-w">    </span><span class="tok-k">if</span><span class="tok-w"> </span><span class="tok-p">(</span><span class="tok-n">tokenFromRedis</span><span class="tok-w"> </span><span class="tok-o">==</span><span class="tok-w"> </span><span class="tok-kc">null</span><span class="tok-w"> </span><span class="tok-o">||</span><span class="tok-w"> </span><span class="tok-o">!</span><span class="tok-n">tokenFromRedis</span><span class="tok-p">.</span><span class="tok-na">equals</span><span class="tok-p">(</span><span class="tok-n">jwt</span><span class="tok-p">))</span><span class="tok-w"> </span><span class="tok-p">{</span>
<span class="tok-w">        </span><span class="tok-n">sendErrorResponse</span><span class="tok-p">(</span><span class="tok-n">response</span><span class="tok-p">);</span>
<span class="tok-w">        </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">false</span><span class="tok-p">;</span>
<span class="tok-w">    </span><span class="tok-p">}</span>
<span class="tok-w">    </span><span class="tok-c1">// ---------- 更新代码结束 ------</span>
<span class="tok-w">    </span><span class="tok-k">return</span><span class="tok-w"> </span><span class="tok-kc">true</span><span class="tok-p">;</span><span class="tok-w">   </span><span class="tok-c1">// 放行去执行 api</span>
<span class="tok-p">}</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">使用 httpie 测试，查看后端日志中打印结果</div>
<div class="content">
<pre class="pygments highlight"><code data-lang="console"><span></span><span class="tok-go">TOKEN=$(http POST :8080/login username=limuwan password=123456 | jq -r &#39;.data&#39;)</span>
<span class="tok-go">http :8080/depts &quot;token: $TOKEN&quot;</span>
<span class="tok-go">http :8080/depts/1 &quot;token: $TOKEN&quot;</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2025-09-24 07:30:50 +0800
</div>
</div>
</body>
</html>