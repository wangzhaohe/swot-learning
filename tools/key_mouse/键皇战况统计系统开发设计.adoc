:source-highlighter: pygments
:icons: font
:scripts: cjk
:stem: latexmath
:toc:
:toc: right
:toc-title: ç›®å½•
:toclevels: 3
:tip-caption: âš¡
:note-caption: â•
:important-caption: â—
:warning-caption: â€¼ï¸
:caution-caption: âš ï¸

= é”®çš‡æˆ˜å†µç»Ÿè®¡ç³»ç»Ÿå¼€å‘è®¾è®¡

++++
<button id="toggleButton">ç›®å½•å¼€å…³</button>
<script>
    // è·å–æŒ‰é’®å’Œ div å…ƒç´ 
    const toggleButton = document.getElementById('toggleButton');
    const contentDiv = document.getElementById('toc');
    contentDiv.style.display = 'none';

    // æ·»åŠ ç‚¹å‡»äº‹ä»¶ç›‘å¬å™¨
    toggleButton.addEventListener('click', () => {
        // åˆ‡æ¢ div çš„æ˜¾ç¤ºçŠ¶æ€
        // if (contentDiv.style.display === 'none' || contentDiv.style.display === '') {
        if (contentDiv.style.display === 'none') {
            contentDiv.style.display = 'block';
        } else {
            contentDiv.style.display = 'none';
        }
    });
</script>
++++

== 1. é¡¹ç›®æ¦‚è¿°
æœ¬é¡¹ç›®åä¸ºâ€œé”®çš‡æˆ˜å†µç»Ÿè®¡ç³»ç»Ÿâ€ï¼ˆKeystroke Dashboardï¼‰ï¼Œæ—¨åœ¨é€šè¿‡åå°é™é»˜ç›‘å¬é”®ç›˜ä¸é¼ æ ‡åŠ¨ä½œï¼Œå®æ—¶åˆ†æç”¨æˆ·çš„ç”Ÿäº§åŠ›çŠ¶æ€ã€‚ç³»ç»Ÿä¸ä»…ç»Ÿè®¡ç‚¹å‡»æ€»æ•°ï¼Œè¿˜é€šè¿‡â€œå¿ƒè·³ç®—æ³•â€ä¼°ç®—ç”¨æˆ·çš„**ä»Šæ—¥ä¸“æ³¨æ—¶é•¿**ï¼Œå¹¶ä»¥å¯è§†åŒ–å¤§å±çš„æ–¹å¼è¿›è¡Œå±•ç¤ºã€‚

é¡¹ç›®é‡‡ç”¨ **Leo Editor** è¿›è¡Œæ–‡å­¦åŒ–ç¼–ç¨‹ï¼ˆLiterate Programmingï¼‰ï¼Œä»£ç ç»„ç»‡ç»“æ„æ¸…æ™°ï¼Œé€»è¾‘ä¸æ–‡æ¡£é«˜åº¦ç»Ÿä¸€ã€‚

== 2. å¼€å‘ç¯å¢ƒä¸å·¥å…·
* **ç¼–è¾‘å™¨**:
  ** Leo Editor æ–‡å­¦åŒ–ç¼–ç¨‹æ ¸å¿ƒå·¥å…·ç®¡ç†å¤§çº²
  ** LazyVim ä»£ç å¼€å‘

* **åç«¯è¯­è¨€**: Python 3.x (ç›‘å¬å¼•æ“)

* **å‰ç«¯æ¡†æ¶**: Vue 3 (æ¸è¿›å¼è§†å›¾å±‚)

* **å›¾è¡¨åº“**: Apache ECharts (æ•°æ®å¯è§†åŒ–)

* **æ ¸å¿ƒåº“**: `pynput` (è¾“å…¥è®¾å¤‡ç›‘å¬)

== 3. æ ¸å¿ƒæ¶æ„è®¾è®¡ï¼šPython ç›‘å¬å¼•æ“
ç›‘å¬å¼•æ“ä½äº `@file key_mouse.py` èŠ‚ç‚¹ä¸‹ã€‚
å®ƒè´Ÿè´£æ•°æ®çš„é‡‡é›†ã€è¿‡æ»¤ã€æŒä¹…åŒ–ä»¥åŠä¸“æ³¨æ—¶é•¿çš„è®¡ç®—ã€‚

=== 3.1 ä¸“æ³¨æ—¶é•¿ç®—æ³•
å¿ƒè·³æ£€æµ‹ (Active Time Heartbeat)ï¼Œç³»ç»Ÿå¼•å…¥äº† `HEARTBEAT_THRESHOLD`ï¼ˆ300ç§’ï¼‰æ¦‚å¿µã€‚
è¯¥ç®—æ³•çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

- **ä¸“æ³¨æ€»æ—¶é•¿ = æ‰€æœ‰ï¼ˆé—´éš” < 5åˆ†é’Ÿï¼‰çš„æ—¶é—´æ®µä¹‹å’Œ**ã€‚
- è‹¥ä¸¤æ¬¡æ“ä½œé—´éš”è¶…è¿‡5åˆ†é’Ÿï¼Œç³»ç»Ÿå°†åˆ¤å®šç”¨æˆ·å¤„äºé—²ç½®çŠ¶æ€ï¼Œä¸è®¡å…¥æ—¶é•¿ã€‚


.ä¸“æ³¨æ—¶é•¿æ ¸å¿ƒç®—æ³•ï¼šå¿ƒè·³ä¼°ç®—æ³• (Active Time Heartbeat) åŸç†å­¦ä¹ 
[sidebar]
--
æœ¬ç³»ç»Ÿé‡‡ç”¨ä¸€ç§å¯å‘å¼çš„â€œå¿ƒè·³â€é€»è¾‘æ¥ä¼°ç®—ä¸“æ³¨æ—¶é•¿ï¼Œè€Œéç®€å•çš„è®¡æ—¶å™¨ã€‚

[discrete]
==== 1. ç®—æ³•é€»è¾‘è¯´æ˜
ç³»ç»Ÿå°†æ¯ä¸€æ¬¡é”®ç›˜æ•²å‡»æˆ–é¼ æ ‡ç‚¹å‡»è§†ä¸ºä¸€æ¬¡**å¿ƒè·³ (Heartbeat)**ã€‚ç³»ç»Ÿæ ¹æ®è¿ç»­ä¸¤æ¬¡å¿ƒè·³ä¹‹é—´çš„æ—¶é—´å·® stem:[\Delta t] æ¥å†³å®šè¿™æ®µæ—¶é—´æ˜¯å¦ä¸ºâ€œä¸“æ³¨è´¡çŒ®å€¼â€ã€‚

* **æ‰“ç‚¹ (Heartbeat)**: è¯æ˜ç”¨æˆ·å½“å‰å¤„äºæ´»è·ƒçŠ¶æ€ã€‚
* **é˜ˆå€¼ (Threshold)**: ç³»ç»Ÿè®¾å®š `HEARTBEAT_THRESHOLD = 300`ï¼ˆ5åˆ†é’Ÿï¼‰ã€‚è‹¥ä¸¤æ¬¡æ“ä½œé—´éš”è¶…è¿‡æ­¤å€¼ï¼Œç³»ç»Ÿè®¤ä¸ºç”¨æˆ·è¿›å…¥äº†â€œéå·¥ä½œçŠ¶æ€â€ã€‚

[discrete]
==== 2. æ•°å­¦æ¨¡å‹å¯¹æ¯”ï¼šä»£ç å®ç° vs. ç†æƒ³å…¬å¼

åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åŒºåˆ†**ç¡¬æˆªæ–­**ä¸**é¥±å’Œæˆªæ–­**ä¸¤ç§ä¸åŒçš„ç»Ÿè®¡é€»è¾‘ï¼š

[discrete]
===== A. æœ€å¼€å§‹æœ¬ç³»ç»Ÿé‡‡ç”¨çš„ï¼šç¡¬æˆªæ–­ (Hard Cutoff)
è¿™æ˜¯ `key_mouse.py` ä¸­å®é™…è¿è¡Œçš„é€»è¾‘ã€‚åªè¦é—´éš”è¶…è¿‡é˜ˆå€¼ï¼Œæ•´æ®µé—´éš”æ—¶é—´å½’é›¶ã€‚

.@file key_mouse.py-->class TrackerEngine-->def log_event
[source,python]
----
delta = now_ts - self.last_event_time

if delta < HEARTBEAT_THRESHOLD:
    # åªæœ‰è·ç¦»ä¸Šæ¬¡æ“ä½œå°äº 5 åˆ†é’Ÿï¼Œæ‰è®¤ä¸ºæ˜¯è¿è´¯å·¥ä½œ
    self.daily_data["focus_seconds"] = (
        self.daily_data.get("focus_seconds", 0) + delta
    )

self.last_event_time = now_ts  # é‡ç½®ä¸Šæ¬¡äº‹ä»¶æ—¶é—´

# å‘å‰ç«¯æš´éœ²æœ€åæ“ä½œçš„ç¡®åˆ‡æ—¶é—´æˆ³
self.daily_data["last_event_timestamp"] = now_ts

----

å…¶æ•°å­¦å¯¹åº”å…³ç³»ä¸ºå¸¦**æŒ‡ç¤ºå‡½æ•°**çš„æ±‚å’Œï¼š

[stem]
++++
FocusTime = \sum_{n=1}^{N} (\Delta t_n \cdot \mathbb{1}_{\{\Delta t_n < Threshold\}})
++++

* è®¡ç®—è¡Œä¸ºï¼šå®ƒå°±åƒä¸€ä¸ªé€»è¾‘å¼€å…³ã€‚å¦‚æœä¸¤æ¬¡æ“ä½œé—´éš” stem:[\Delta t_n] å°äºè®¾å®šçš„é˜ˆå€¼ï¼Œè¯¥å‡½æ•°è¾“å‡ºä¸º 1ï¼ˆæ—¶é•¿è¢«å…¨é¢è®¡å…¥ï¼‰ã€‚ä¸€æ—¦é—´éš”å¤§äºæˆ–ç­‰äºé˜ˆå€¼ï¼Œå‡½æ•°è¾“å‡ºç¬é—´çªå˜ä¸º 0ã€‚æ­¤æ—¶ stem:[\Delta t_n] ä¹˜ä»¥ 0 ç­‰äº 0ï¼Œè¿™æ®µé—´éš”æ—¶é—´è¢«å½»åº•å½’é›¶ã€‚
* **ç‰¹ç‚¹**: æå…¶ä¸¥æ ¼ã€‚å¦‚æœä½ ç¦»å¼€ç”µè„‘ 5 åˆ† 1 ç§’ï¼Œç³»ç»Ÿä¼šåˆ¤å®šä½ è¿™ 5 åˆ†é’Ÿå®Œå…¨æ²¡åœ¨å·¥ä½œã€‚


[discrete]
===== B. ç°åœ¨æœ¬ç³»ç»Ÿä½¿ç”¨äº†**é€šç”¨çš„ç†æƒ³æ¨¡å‹**ï¼šé¥±å’Œæˆªæ–­ (Saturation)
å•†ä¸šç»Ÿè®¡è½¯ä»¶ï¼ˆå¦‚ Togglï¼‰å¸¸é‡‡ç”¨ stem:[\min] å‡½æ•°é€»è¾‘ï¼š

.@file key_mouse.py-->class TrackerEngine-->def log_event
[source,python]
----
delta = now_ts - self.last_event_time

# æ— è®ºé—´éš”å¤šä¹…ï¼Œæœ€å¤šç´¯åŠ  HEARTBEAT_THRESHOLDï¼ˆä¾‹å¦‚5åˆ†é’Ÿï¼‰
self.daily_data["focus_seconds"] = self.daily_data.get(
    "focus_seconds", 0
) + min(delta, HEARTBEAT_THRESHOLD)

self.last_event_time = now_ts  # é‡ç½®ä¸Šæ¬¡äº‹ä»¶æ—¶é—´

# å‘å‰ç«¯æš´éœ²æœ€åæ“ä½œçš„ç¡®åˆ‡æ—¶é—´æˆ³
self.daily_data["last_event_timestamp"] = now_ts

----

[stem]
++++
FocusTime = \sum_{n=1}^{N} \min(\Delta t_n, Threshold)
++++

* è®¡ç®—è¡Œä¸ºï¼šå®ƒæ˜¯ä¸€ç§å¹³æ»‘çš„æˆªæ–­æœºåˆ¶ã€‚ç³»ç»Ÿä¼šæ¯”è¾ƒå®é™…é—´éš”æ—¶é—´ $\Delta t_n$ å’Œè®¾å®šçš„é˜ˆå€¼ï¼Œå–ä¸¤è€…ä¸­è¾ƒå°çš„ä¸€ä¸ªç´¯åŠ è¿›å»ã€‚è¿™æ„å‘³ç€å³ä¾¿ç”¨æˆ·çš„é—´éš”æ—¶é—´æå…¶æ¼«é•¿ï¼Œç³»ç»Ÿä¾ç„¶ä¼šæˆªå–ç›¸å½“äºâ€œé˜ˆå€¼â€çš„æ—¶é•¿ï¼Œç®—ä½œæœ‰æ•ˆä¸“æ³¨æ—¶é—´ã€‚
* **ç‰¹ç‚¹**: ç›¸å¯¹æ…·æ…¨ã€‚å³ä½¿ä½ ç¦»å¼€ç”µè„‘ 30 åˆ†é’Ÿï¼Œç³»ç»Ÿä¾ç„¶ä¼šâ€œä¿åº•â€ä¸ºä½ è®¡å…¥å‰ 5 åˆ†é’Ÿçš„ä¸“æ³¨æ—¶é•¿ï¼Œè®¤ä¸ºé‚£æ˜¯ä½ ç¦»å¼€å‰çš„æ€è€ƒæ—¶é—´ã€‚


[discrete]
==== 3. ç®—æ³•ä¼˜ç¼ºç‚¹åˆ†æ

[cols="1,3", options="header"]
|===
|ç»´åº¦ | ç‰¹æ€§æè¿°
|**éšç§æ€§** | æä½³ã€‚æ— éœ€æˆªå±æˆ–è®¿é—®æ‘„åƒå¤´ï¼Œä»…è®°å½•æ“ä½œé—´éš”ã€‚
|**æ€§èƒ½** | æä½ã€‚ä»…åœ¨è¾“å…¥äº‹ä»¶è§¦å‘æ—¶è¿›è¡Œä¸€æ¬¡å‡æ³•è¿ç®—ï¼Œä¸å ç”¨ç³»ç»Ÿèµ„æºã€‚
|**å‡†ç¡®æ€§** | å­˜åœ¨ä¼°ç®—è¯¯å·®ã€‚é˜…è¯»é•¿æ–‡æ¡£æˆ–è§‚çœ‹è§†é¢‘è€Œä¸æ“ä½œæ—¶ï¼Œä¼šè¢«è¯¯åˆ¤ä¸ºç¦»çº¿ã€‚
|===

[discrete]
==== å…³é”®å®ç°èŠ‚ç‚¹å‚è€ƒ (Leo Editor Nodes)

åœ¨ Leo Editor ä¸­ï¼Œä¸Šè¿°ç®—æ³•ä¸»è¦åœ¨ä»¥ä¸‹èŠ‚ç‚¹ä¸­å®ç°ï¼š

. **`def log_event`**: æ ¸å¿ƒé€»è¾‘å…¥å£ï¼Œè®¡ç®— stem:[\Delta t] å¹¶è¿›è¡Œè·¨å¤©æ£€æµ‹ã€‚
. **`formatDuration(seconds)`**: å‰ç«¯ Vue èŠ‚ç‚¹ï¼Œè´Ÿè´£å°†ç§’æ•°è½¬åŒ–ä¸º `1h 20m` çš„å¯è¯»æ ¼å¼ã€‚
. **`fetchData()`**: å‰ç«¯å¼‚æ­¥èŠ‚ç‚¹ï¼Œæ¯ 60 ç§’ä»åç«¯ç”Ÿæˆçš„ JSON æ–‡ä»¶ä¸­æ‹‰å–æœ€æ–°çš„ä¸“æ³¨ç§’æ•°ã€‚
--

=== 3.2 æ•°æ®åŸå­åŒ–æŒä¹…åŒ–
ä¸ºäº†é˜²æ­¢æ„å¤–åœæœºå¯¼è‡´ JSON æŸåï¼Œç³»ç»Ÿåœ¨ `_atomic_save` èŠ‚ç‚¹ä¸­å®ç°äº†åŸå­åŒ–å†™å…¥ï¼š

[source,python]
----
# ä»£ç ç‰‡æ®µæ¥è‡ªèŠ‚ç‚¹ï¼š*3* def _atomic_save
def _atomic_save(self, data, target_path):
    tmp_path = target_path.with_suffix('.tmp')
    try:
        with open(tmp_path, "w", encoding="utf-8") as f:
            json.dump(data, f, indent=4, ensure_ascii=False)
        os.replace(tmp_path, target_path) # åŸå­æ›¿æ¢
    except Exception as e:
        print(f"ä¿å­˜å¤±è´¥: {e}")
----

== 4. å‰ç«¯å¤§å±è®¾è®¡ï¼šVue + ECharts
å¤§å±å±•ç¤ºä½äº `@file index.html` èŠ‚ç‚¹ã€‚

=== 4.1 å¤´éƒ¨æ ‡é¢˜
å¯¹å¤´éƒ¨æ ‡é¢˜è¿›è¡Œæè¿°

.å¤´éƒ¨ç»“æ„
[source,html]
----
<div class="header">
    <h1>HP GT87 Ultra æˆ˜å†µå¤§å±</h1>
    <p>å®æ—¶è¯»å–æœ¬åœ°ç»Ÿè®¡æ•°æ®ï¼Œæ¯ 60 ç§’è‡ªåŠ¨åˆ·æ–°</p>
</div>
----

.å¤´éƒ¨æ ·å¼
[source,scss]
----
.header { text-align: center; margin-bottom: 3rem; }
.header h1 { font-size: 2.5rem; letter-spacing: 2px; color: var(--accent); }
.header p { color: var(--text-muted); margin-top: 0.5rem; }
----

=== 4.2 å“åº”å¼æ•°æ®å¡ç‰‡
å‰ç«¯é‡‡ç”¨ 4 åˆ—ç½‘æ ¼å¸ƒå±€ï¼Œç›´è§‚å±•ç¤º:

.å¡ç‰‡ç»“æ„
[source,html]
----
<div class="stats-grid">
    <div class="stat-card">
        <div class="stat-title">ä»Šæ—¥ä¸“æ³¨æ—¶é•¿</div>
        <div class="stat-value focus">{{ formatDuration(liveFocusSeconds) }}</div>
        <div :class="['status-badge', isDormant ? 'status-dormant' : 'status-active pulse']">
            {{ isDormant ? 'ğŸ’¤ ç³»ç»Ÿä¼‘çœ ä¸­' : 'ğŸ”¥ ä¸“æ³¨æ‰“ç ä¸­' }}
        </div>
    </div>

    <div class="stat-card">
        <div class="stat-title">å†å²æ€»ç‚¹å‡» (Total)</div>
        <div class="stat-value">{{ formatNumber(globalStats.total) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">æ€»é”®ç›˜æ•²å‡» (Key)</div>
        <div class="stat-value keyboard">{{ formatNumber(globalStats.keyboard) }}</div>
    </div>
    <div class="stat-card">
        <div class="stat-title">æ€»é¼ æ ‡ç‚¹å‡» (Mouse)</div>
        <div class="stat-value mouse">{{ formatNumber(globalStats.mouse) }}</div>
    </div>
</div>
----

.è°ƒç”¨å‡½æ•°
[source,javascript]
----
const formatNumber = (num) => 
    new Intl.NumberFormat('en-US').format(num || 0);
// å°†ç§’æ•°è½¬æ¢ä¸ºå‹å¥½æ ¼å¼ (å¦‚ 3h 45m 19s)
const formatDuration = (seconds) => {
    if (!seconds) return '0h 0m 0s';
    const h = Math.floor(seconds / 3600);
    const m = Math.floor((seconds % 3600) / 60);
    const s = Math.floor(seconds % 60);  // ç®—å‡ºä½™ä¸‹çš„ç§’æ•°

    // è¡¥é½ä¸¤ä½æ•°ï¼Œè®©è·³åŠ¨æ›´æ•´é½ç¾è§‚ï¼ˆä¾‹å¦‚ 05sï¼‰
    const formattedS = s.toString().padStart(2, '0');

    if (h > 0) return `${h}h ${m}m ${formattedS}s`;
    return `${m}m ${formattedS}s`;
};
----

.å¡ç‰‡æ ·å¼
[source,css]
----
.stats-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
}
.stat-card {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 12px;
    text-align: center;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    transition: all 0.5s ease; /* å”¤é†’æ—¶æ¢å¤é€Ÿåº¦ç¨å¿«ï¼Œæ›´çµæ• */
}
.stat-card:hover {
    transform: translateY(-5px);
}
.stat-title {
    font-size: 1rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
    text-transform: uppercase;
    letter-spacing: 1px;
}
.stat-value {
  font-size: 2.3rem;
  font-weight: bold;
  color: var(--text-main);
}
.stat-value.keyboard {
    color: var(--success);
}
.stat-value.mouse {
    color: var(--purple);
}
.stat-value.focus {
    color: var(--focus);
}
----

=== 4.3 å¯è§†åŒ–åˆ†æç»´åº¦
ç³»ç»Ÿæä¾›å››ä¸ªç»´åº¦çš„å›¾è¡¨åˆ†æï¼š

1. **æ‘¸é±¼æ£€æµ‹å™¨ (ä»Šæ—¥æ—¶æ®µåˆ†å¸ƒ)**ï¼š24å°æ—¶çƒ­åº¦åˆ†æã€‚
2. **é”®çš‡äº‰éœ¸èµ› (ä»Šæ—¥ Top 10)**ï¼šç»Ÿè®¡æœ€é«˜é¢‘ä½¿ç”¨çš„é”®ä½ã€‚
3. **äº§å‡ºè¶‹åŠ¿ (è¿‘ 7 å¤©)**ï¼šæŠ˜çº¿å›¾å±•ç¤ºè¿‘æœŸæ´»è·ƒåº¦ã€‚
4. **å…¨æ˜æ˜Ÿæˆ˜ç»© (å†å² Top 10)**ï¼šå±•ç¤ºè‡ªç³»ç»Ÿå¯åŠ¨ä»¥æ¥çš„æœ€å¼ºé”®ä½ã€‚

.ä»Šæ—¥å’Œæ€»ä½“åˆ†æå±•ç¤º
[source,html]
----
<!-- ä»Šæ—¥å±•ç¤º -->
<div class="charts-row-split">
    <div class="chart-container">
        <div id="hourlyChart" class="chart"></div>
    </div>
    <div class="chart-container">
        <div id="topKeysChart" class="chart"></div>
    </div>
</div>
<!-- æ€»ä½“å±•ç¤º -->
<div class="charts-row-split">
    <div class="chart-container">
        <div id="trendChart" class="chart"></div>
    </div>
    <div class="chart-container">
        <div id="allTimeTopKeysChart" class="chart"></div>
    </div>
</div>
----

.ä»Šæ—¥å’Œæ€»ä½“åˆ†æå±•ç¤ºæ ·å¼
[source,css]
----
.charts-row-split {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 2rem;
    flex: 1; /* å…³é”®ï¼šè‡ªåŠ¨å æ® first-screen å‰©ä¸‹çš„æ‰€æœ‰é«˜åº¦ */
    margin-bottom: 0; /* ç§»é™¤åŸæ¥çš„åº•éƒ¨è¾¹è· */
}
.chart-container {
    background: var(--card-bg);
    padding: 1.5rem;
    border-radius: 12px;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    display: flex;  /* å›¾è¡¨å®¹å™¨ä½¿ç”¨ flexï¼Œæ–¹ä¾¿å†…éƒ¨çš„å›¾è¡¨ 100% æ’‘å¼€ */
    flex-direction: column;
}
.chart {
    width: 100%;
    height: 100%;
    flex: 1;
}

----

== 5. é¡¹ç›®å¯åŠ¨è®¾è®¡


=== 5.1 æœåŠ¡ä¸ç›‘æ§ç½‘é¡µåˆ†ç¦»è®¾è®¡é—®é¢˜
å‰æœŸ key_mouse.py é¡¹ç›®çš„å¯åŠ¨å’Œç½‘é¡µç›‘æ§ index.html æ˜¯æ²¡æœ‰å…³ç³»çš„ã€‚å¯åŠ¨æ­¥éª¤ä¸ºï¼š

[upperalpha]
. å¯åŠ¨ keymouse.py æ”¶é›†é”®ç›˜å’Œé¼ æ ‡ç‚¹å‡»æ•°æ®
+
[source,console]
----
source ~/venv/leoqt6/bin/activate
cd key_mouse
python key_mouse.py
----

. å¯åŠ¨é™æ€ http æœåŠ¡å™¨
+
[source,console]
----
python -m http.server 8098
----
+
[NOTE]
====
[loweralpha]
. è®©æµè§ˆå™¨å¯ä»¥è®¿é—® index.html
. è®© index.html å¯ä»¥è®¿é—® key_mouse.py ç”Ÿæˆçš„ json æ•°æ®æ–‡ä»¶
====

å­˜åœ¨é—®é¢˜ï¼š

* A æ­¥éª¤æ‰§è¡Œçš„è¿›ç¨‹é€€å‡ºåï¼ŒB æ­¥éª¤æ‰§è¡Œçš„è¿›ç¨‹ä¾ç„¶å­˜åœ¨ï¼Œéœ€è¦æ‰‹å·¥å»åœæ­¢ã€‚
* éå¼€å‘è€…ç”¨æˆ·ä¸ä¼šå¯åŠ¨ B æ­¥éª¤ã€‚
* ç”¨æˆ·åœ¨å¯åŠ¨ B æ­¥éª¤æ—¶ï¼Œå¯ä»¥å·¥ä½œè·¯å¾„ä¸æ˜¯åœ¨é¡¹ç›®ç›®å½•ä¸‹ï¼Œå¯¼è‡´æ— æ³•æ‰“å¼€ç½‘é¡µæŠ¥ 404ã€‚

=== 5.2 ç›‘å¬å¼•æ“é›†æˆ http server
ä¸ºäº†è®©ç›‘å¬å¼•æ“åœ¨åå°è®°å½•é”®é¼ æ“ä½œçš„åŒæ—¶ï¼Œè¿˜èƒ½é€šè¿‡ HTTP æœåŠ¡å™¨å¯¹å¤–æä¾›æ•°æ®æ¥å£ï¼ˆä¾›å‰ç«¯é¡µé¢è¯»å– JSON æ•°æ®ï¼‰ï¼Œæˆ‘ä»¬ä¸èƒ½è®© `http.server` é˜»å¡ä¸»çº¿ç¨‹ã€‚

æœ€å¥½çš„åšæ³•æ˜¯**å¼€è¾Ÿä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼ˆDaemon Threadï¼‰æ¥è¿è¡Œ HTTP æœåŠ¡å™¨**ã€‚è¿™æ ·å®ƒèƒ½å’Œç›‘å¬å™¨åŒæ—¶å·¥ä½œï¼Œå¹¶ä¸”åœ¨ä½ æŒ‰ä¸‹ `Ctrl+C` é€€å‡ºè„šæœ¬æ—¶è‡ªåŠ¨å…³é—­ï¼Œä¸ä¼šç•™ä¸‹åƒµå°¸è¿›ç¨‹ã€‚

.å¯¼å…¥æœåŠ¡æ¨¡å—: key_mouse.py
[source,python]
----
import http.server
import socketserver
import webbrowser

----

.å®šä¹‰å¼€å¯æœåŠ¡å‡½æ•° key_mouse.py
[source,python]
----
def start_server(port=8099):
    # åˆ‡æ¢åˆ°è„šæœ¬æ‰€åœ¨ç›®å½•
    os.chdir(SCRIPT_DIR)
    Handler = http.server.SimpleHTTPRequestHandler

    try:
        # å…è®¸ç«¯å£åˆ©ç”¨ï¼Œé˜²æ­¢é¢‘ç¹é‡å¯è„šæœ¬æ—¶å‡ºç° "Address already in use" é”™è¯¯
        socketserver.TCPServer.allow_reuse_address = True
        with socketserver.TCPServer(("", port), Handler) as httpd:
            print(f"æœ¬åœ°æœåŠ¡å™¨å·²å¯åŠ¨: http://localhost:{port}/")
            httpd.serve_forever()
    except Exception as e:
        print(f"HTTP æœåŠ¡å™¨å¯åŠ¨å¤±è´¥: {e}")


----

NOTE: **è‡ªåŠ¨åŒ–è·¯å¾„é”å®š**: ä»£ç ä¸­ä½¿ç”¨äº† `os.chdir(SCRIPT_DIR)`ï¼Œç¡®ä¿äº†æ— è®ºç”¨æˆ·åœ¨å“ªä¸ªç›®å½•ä¸‹æ‰§è¡Œè„šæœ¬ï¼ŒæœåŠ¡å™¨éƒ½èƒ½å‡†ç¡®åœ°æ‰¾åˆ° `key_stats` æ–‡ä»¶å¤¹ã€‚

.åœ¨ä¸»ç¨‹åºå…¥å£å¤„ (if __name__ == "__main__":) æ·»åŠ äº†å¯åŠ¨è¯¥æœåŠ¡çš„å®ˆæŠ¤çº¿ç¨‹ä»£ç ã€‚
[source,python]
----
server_thread = threading.Thread(target=start_server, args=(8099,), daemon=True)
server_thread.start()
webbrowser.open("http://localhost:8099")
----

NOTE: **ä¸€é”®å¯åœï¼š**: å½“ä½ å…³é—­ Python è„šæœ¬æ—¶ï¼Œç”±äºæˆ‘ä»¬è®¾ç½®äº† daemon=Trueï¼ŒHTTP æœåŠ¡å™¨ä¼šéšä¹‹è‡ªåŠ¨å…³é—­ï¼Œä¸ä¼šåƒå‘½ä»¤è¡Œç‰ˆé‚£æ ·å¯èƒ½è¢«é—å¿˜åœ¨åå°å ç”¨ç«¯å£ã€‚

== 6. æ€»ç»“
é€šè¿‡ Leo Editor çš„æ–‡å­¦åŒ–ç¼–ç¨‹ï¼Œæˆ‘ä»¬å°†å¤æ‚çš„ç›‘å¬é€»è¾‘ä¸ç›´è§‚çš„ Web UI å®Œç¾ç»“åˆã€‚
ç³»ç»Ÿçš„â€œå¿ƒè·³ç®—æ³•â€ä¸ºç”¨æˆ·æä¾›äº†çœŸå®çš„ç”Ÿäº§åŠ›åé¦ˆï¼Œè€ŒåŸå­åŒ–ä¿å­˜åˆ™ç¡®ä¿äº†æ•°æ®çš„ç»å¯¹å®‰å…¨ã€‚

